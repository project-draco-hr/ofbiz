{
  boolean includeUserLogin=!"false".equals(methodContext.expandString(includeUserLoginStr));
  boolean breakOnError=!"false".equals(methodContext.expandString(breakOnErrorStr));
  String serviceName=methodContext.expandString(this.serviceName);
  String errorCode=methodContext.expandString(this.errorCode);
  String successCode=methodContext.expandString(this.successCode);
  Map<String,Object> inMap=null;
  if (inMapAcsr.isEmpty()) {
    inMap=FastMap.newInstance();
  }
 else {
    inMap=inMapAcsr.get(methodContext);
    if (inMap == null) {
      inMap=FastMap.newInstance();
      inMapAcsr.put(methodContext,inMap);
    }
  }
  if (methodContext.getMethodType() == MethodContext.EVENT) {
    methodContext.removeEnv(simpleMethod.getEventErrorMessageName());
    methodContext.removeEnv(simpleMethod.getEventEventMessageName());
    methodContext.removeEnv(simpleMethod.getEventResponseCodeName());
  }
 else   if (methodContext.getMethodType() == MethodContext.SERVICE) {
    methodContext.removeEnv(simpleMethod.getServiceErrorMessageName());
    methodContext.removeEnv(simpleMethod.getServiceSuccessMessageName());
    methodContext.removeEnv(simpleMethod.getServiceResponseMessageName());
  }
  Map<String,Object> result=null;
  if (includeUserLogin) {
    GenericValue userLogin=methodContext.getUserLogin();
    if (userLogin != null && inMap.get("userLogin") == null) {
      inMap.put("userLogin",userLogin);
    }
  }
  Locale locale=methodContext.getLocale();
  if (locale != null) {
    inMap.put("locale",locale);
  }
  try {
    if (UtilValidate.isEmpty(this.requireNewTransactionStr) && this.transactionTimeout < 0) {
      result=methodContext.getDispatcher().runSync(serviceName,inMap);
    }
 else {
      ModelService modelService=methodContext.getDispatcher().getDispatchContext().getModelService(serviceName);
      boolean requireNewTransaction=modelService.requireNewTransaction;
      int timeout=modelService.transactionTimeout;
      if (UtilValidate.isNotEmpty(this.requireNewTransactionStr)) {
        requireNewTransaction="true".equalsIgnoreCase(this.requireNewTransactionStr) ? true : false;
      }
      if (this.transactionTimeout >= 0) {
        timeout=this.transactionTimeout;
      }
      result=methodContext.getDispatcher().runSync(serviceName,inMap,timeout,requireNewTransaction);
    }
  }
 catch (  GenericServiceException e) {
    String errMsg="ERROR: Could not complete the " + simpleMethod.getShortDescription() + " process [problem invoking the ["+ serviceName+ "] service with the map named ["+ inMapAcsr+ "] containing ["+ inMap+ "]: "+ e.getMessage()+ "]";
    Debug.logError(e,errMsg,module);
    if (breakOnError) {
      if (methodContext.getMethodType() == MethodContext.EVENT) {
        methodContext.putEnv(simpleMethod.getEventErrorMessageName(),errMsg);
        methodContext.putEnv(simpleMethod.getEventResponseCodeName(),errorCode);
      }
 else       if (methodContext.getMethodType() == MethodContext.SERVICE) {
        methodContext.putEnv(simpleMethod.getServiceErrorMessageName(),errMsg);
        methodContext.putEnv(simpleMethod.getServiceResponseMessageName(),errorCode);
      }
      return false;
    }
 else {
      return true;
    }
  }
  if (resultsToMap.size() > 0) {
    for (    String mapName : resultsToMap) {
      methodContext.putEnv(mapName,UtilMisc.makeMapWritable(result));
    }
  }
  if (resultToField.size() > 0) {
    for (    ResultToFieldDef rtfDef : resultToField) {
      if (!rtfDef.mapAcsr.isEmpty()) {
        Map<String,Object> tempMap=rtfDef.mapAcsr.get(methodContext);
        if (tempMap == null) {
          tempMap=FastMap.newInstance();
          rtfDef.mapAcsr.put(methodContext,tempMap);
        }
        rtfDef.fieldAcsr.put(tempMap,result.get(rtfDef.resultName),methodContext);
      }
 else {
        rtfDef.fieldAcsr.put(methodContext,result.get(rtfDef.resultName));
      }
    }
  }
  if (methodContext.getMethodType() == MethodContext.EVENT) {
    if (resultToRequest.size() > 0) {
      for (      Map.Entry<FlexibleServletAccessor<Object>,ContextAccessor<Object>> entry : resultToRequest.entrySet()) {
        FlexibleServletAccessor<Object> requestAcsr=entry.getKey();
        ContextAccessor<Object> resultAcsr=entry.getValue();
        requestAcsr.put(methodContext.getRequest(),resultAcsr.get(result,methodContext),methodContext.getEnvMap());
      }
    }
    if (resultToSession.size() > 0) {
      for (      Map.Entry<FlexibleServletAccessor<Object>,ContextAccessor<Object>> entry : resultToSession.entrySet()) {
        FlexibleServletAccessor<Object> sessionAcsr=entry.getKey();
        ContextAccessor<Object> resultAcsr=entry.getValue();
        sessionAcsr.put(methodContext.getRequest().getSession(),resultAcsr.get(result,methodContext),methodContext.getEnvMap());
      }
    }
  }
  if (methodContext.getMethodType() == MethodContext.SERVICE) {
    if (resultToResult.size() > 0) {
      for (      Map.Entry<ContextAccessor<Object>,ContextAccessor<Object>> entry : resultToResult.entrySet()) {
        ContextAccessor<Object> targetResultAcsr=entry.getKey();
        ContextAccessor<Object> resultAcsr=entry.getValue();
        targetResultAcsr.put(methodContext.getResults(),resultAcsr.get(result,methodContext),methodContext);
      }
    }
  }
  String errorPrefixStr=errorPrefix.getMessage(methodContext.getLoader(),methodContext);
  String errorSuffixStr=errorSuffix.getMessage(methodContext.getLoader(),methodContext);
  String successPrefixStr=successPrefix.getMessage(methodContext.getLoader(),methodContext);
  String successSuffixStr=successSuffix.getMessage(methodContext.getLoader(),methodContext);
  String messagePrefixStr=messagePrefix.getMessage(methodContext.getLoader(),methodContext);
  String messageSuffixStr=messageSuffix.getMessage(methodContext.getLoader(),methodContext);
  String errorMessage=null;
  List<String> errorMessageList=null;
  if (result.containsKey(ModelService.ERROR_MESSAGE)) {
    errorMessage=ServiceUtil.makeErrorMessage(result,messagePrefixStr,messageSuffixStr,errorPrefixStr,errorSuffixStr);
  }
 else   if (result.containsKey(ModelService.ERROR_MESSAGE_LIST)) {
    errorMessageList=UtilGenerics.checkList(result.get(ModelService.ERROR_MESSAGE_LIST));
  }
  if ((UtilValidate.isNotEmpty(errorMessage) || UtilValidate.isNotEmpty(errorMessageList)) && breakOnError) {
    if (methodContext.getMethodType() == MethodContext.EVENT) {
      if (UtilValidate.isNotEmpty(errorMessage)) {
        if (Debug.verboseOn()) {
          errorMessage+=UtilProperties.getMessage(resource,"simpleMethod.error_show_service_name",UtilMisc.toMap("serviceName",serviceName,"methodName",simpleMethod.getMethodName()),locale);
        }
        methodContext.putEnv(simpleMethod.getEventErrorMessageName(),errorMessage);
      }
 else {
        if (Debug.verboseOn()) {
          errorMessageList.add(UtilProperties.getMessage(resource,"simpleMethod.error_show_service_name",UtilMisc.toMap("serviceName",serviceName,"methodName",simpleMethod.getMethodName()),locale));
        }
        methodContext.putEnv(simpleMethod.getEventErrorMessageListName(),errorMessageList);
      }
    }
 else     if (methodContext.getMethodType() == MethodContext.SERVICE) {
      ServiceUtil.addErrors(UtilMisc.<String,String>getListFromMap(methodContext.getEnvMap(),this.simpleMethod.getServiceErrorMessageListName()),UtilMisc.<String,String,Object>getMapFromMap(methodContext.getEnvMap(),this.simpleMethod.getServiceErrorMessageMapName()),result);
      Debug.logError(new Exception(errorMessage),module);
    }
  }
  String successMessage=ServiceUtil.makeSuccessMessage(result,messagePrefixStr,messageSuffixStr,successPrefixStr,successSuffixStr);
  if (UtilValidate.isNotEmpty(successMessage)) {
    if (methodContext.getMethodType() == MethodContext.EVENT) {
      methodContext.putEnv(simpleMethod.getEventEventMessageName(),successMessage);
    }
 else     if (methodContext.getMethodType() == MethodContext.SERVICE) {
      methodContext.putEnv(simpleMethod.getServiceSuccessMessageName(),successMessage);
    }
  }
  String defaultMessageStr=defaultMessage.getMessage(methodContext.getLoader(),methodContext);
  if (UtilValidate.isEmpty(errorMessage) && UtilValidate.isEmpty(errorMessageList) && UtilValidate.isEmpty(successMessage)&& UtilValidate.isNotEmpty(defaultMessageStr)) {
    if (methodContext.getMethodType() == MethodContext.EVENT) {
      methodContext.putEnv(simpleMethod.getEventEventMessageName(),defaultMessageStr);
    }
 else     if (methodContext.getMethodType() == MethodContext.SERVICE) {
      methodContext.putEnv(simpleMethod.getServiceSuccessMessageName(),defaultMessageStr);
    }
  }
  String responseCode=result.containsKey(ModelService.RESPONSE_MESSAGE) ? (String)result.get(ModelService.RESPONSE_MESSAGE) : successCode;
  if (errorCode.equals(responseCode)) {
    if (breakOnError) {
      if (methodContext.getMethodType() == MethodContext.EVENT) {
        methodContext.putEnv(simpleMethod.getEventResponseCodeName(),responseCode);
      }
 else       if (methodContext.getMethodType() == MethodContext.SERVICE) {
        methodContext.putEnv(simpleMethod.getServiceResponseMessageName(),responseCode);
      }
      return false;
    }
 else {
      return true;
    }
  }
 else {
    if (methodContext.getMethodType() == MethodContext.EVENT) {
      methodContext.putEnv(simpleMethod.getEventResponseCodeName(),responseCode);
    }
 else     if (methodContext.getMethodType() == MethodContext.SERVICE) {
      methodContext.putEnv(simpleMethod.getServiceResponseMessageName(),responseCode);
    }
    return true;
  }
}
