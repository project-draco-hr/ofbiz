{
  Map result=new HashMap();
  Delegator delegator=ctx.getDelegator();
  String workEffortId=(String)context.get("workEffortId");
  try {
    GenericValue workEffort=delegator.findByPrimaryKey("WorkEffort",UtilMisc.toMap("workEffortId",workEffortId));
    if (workEffort == null) {
      return ServiceUtil.returnError("Cannot find work effort [" + workEffortId + "]");
    }
    List costComponents=EntityUtil.filterByDate(delegator.findByAnd("CostComponent",UtilMisc.toMap("workEffortId",workEffortId)));
    result.put("costComponents",costComponents);
    Iterator costComponentsIt=costComponents.iterator();
    BigDecimal totalCost=ZERO;
    BigDecimal totalCostNoMaterials=ZERO;
    while (costComponentsIt.hasNext()) {
      GenericValue costComponent=(GenericValue)costComponentsIt.next();
      BigDecimal cost=costComponent.getBigDecimal("cost");
      totalCost=totalCost.add(cost);
      if (!"ACTUAL_MAT_COST".equals(costComponent.getString("costComponentTypeId"))) {
        totalCostNoMaterials=totalCostNoMaterials.add(cost);
      }
    }
    result.put("totalCost",totalCost);
    result.put("totalCostNoMaterials",totalCostNoMaterials);
  }
 catch (  GenericEntityException gee) {
    return ServiceUtil.returnError("Cannot retrieve costs for work effort [" + workEffortId + "]: "+ gee.getMessage());
  }
  return result;
}
