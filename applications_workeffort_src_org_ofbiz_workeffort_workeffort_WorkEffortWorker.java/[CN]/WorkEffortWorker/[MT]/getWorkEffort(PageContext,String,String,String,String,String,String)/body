{
  GenericDelegator delegator=(GenericDelegator)pageContext.getRequest().getAttribute("delegator");
  Security security=(Security)pageContext.getRequest().getAttribute("security");
  GenericValue userLogin=(GenericValue)pageContext.getSession().getAttribute("userLogin");
  String workEffortId=pageContext.getRequest().getParameter("workEffortId");
  if (workEffortId == null)   workEffortId=(String)pageContext.getRequest().getAttribute("workEffortId");
  GenericValue workEffort=null;
  try {
    workEffort=delegator.findByPrimaryKey("WorkEffort",UtilMisc.toMap("workEffortId",workEffortId));
  }
 catch (  GenericEntityException e) {
    Debug.logWarning(e,module);
  }
  Boolean canView=null;
  Collection workEffortPartyAssignments=null;
  Boolean tryEntity=null;
  GenericValue currentStatus=null;
  if (workEffort == null) {
    tryEntity=Boolean.FALSE;
    canView=Boolean.TRUE;
    String statusId=pageContext.getRequest().getParameter("currentStatusId");
    if (statusId != null && statusId.length() > 0) {
      try {
        currentStatus=delegator.findByPrimaryKeyCache("StatusItem",UtilMisc.toMap("statusId",statusId));
      }
 catch (      GenericEntityException e) {
        Debug.logWarning(e,module);
      }
    }
  }
 else {
    if (userLogin != null && userLogin.get("partyId") != null && workEffortId != null) {
      try {
        workEffortPartyAssignments=delegator.findByAnd("WorkEffortPartyAssignment",UtilMisc.toMap("workEffortId",workEffortId,"partyId",userLogin.get("partyId")));
      }
 catch (      GenericEntityException e) {
        Debug.logWarning(e,module);
      }
    }
    canView=(workEffortPartyAssignments != null && workEffortPartyAssignments.size() > 0) ? Boolean.TRUE : Boolean.FALSE;
    if (!canView.booleanValue() && security.hasEntityPermission("WORKEFFORTMGR","_VIEW",pageContext.getSession())) {
      canView=Boolean.TRUE;
    }
    tryEntity=Boolean.TRUE;
    if (workEffort.get("currentStatusId") != null) {
      try {
        currentStatus=delegator.findByPrimaryKeyCache("StatusItem",UtilMisc.toMap("statusId",workEffort.get("currentStatusId")));
      }
 catch (      GenericEntityException e) {
        Debug.logWarning(e,module);
      }
    }
  }
  if (pageContext.getRequest().getAttribute("_ERROR_MESSAGE_") != null) {
    tryEntity=Boolean.FALSE;
  }
  if (workEffortId != null)   pageContext.setAttribute(workEffortIdAttrName,workEffortId);
  if (workEffort != null)   pageContext.setAttribute(workEffortAttrName,workEffort);
  if (canView != null)   pageContext.setAttribute(canViewAttrName,canView);
  if (workEffortPartyAssignments != null)   pageContext.setAttribute(partyAssignsAttrName,workEffortPartyAssignments);
  if (tryEntity != null)   pageContext.setAttribute(tryEntityAttrName,tryEntity);
  if (currentStatus != null)   pageContext.setAttribute(currentStatusAttrName,currentStatus);
}
