{
  if (modelEntity == null) {
    return null;
  }
  if (findOptions == null)   findOptions=new EntityFindOptions();
  boolean verboseOn=Debug.verboseOn();
  if (verboseOn) {
    Debug.logVerbose("Doing selectListIteratorByCondition with whereEntityCondition: " + whereEntityCondition,module);
  }
  List selectFields=FastList.newInstance();
  if (fieldsToSelect != null && fieldsToSelect.size() > 0) {
    Set tempKeys=FastSet.newInstance();
    tempKeys.addAll(fieldsToSelect);
    Iterator fieldIter=modelEntity.getFieldsIterator();
    while (fieldIter.hasNext()) {
      ModelField curField=(ModelField)fieldIter.next();
      if (tempKeys.contains(curField.getName())) {
        selectFields.add(curField);
        tempKeys.remove(curField.getName());
      }
    }
    if (tempKeys.size() > 0) {
      throw new GenericModelException("In selectListIteratorByCondition invalid field names specified: " + tempKeys.toString());
    }
  }
 else {
    selectFields=modelEntity.getFieldsCopy();
  }
  StringBuilder sqlBuffer=new StringBuilder("SELECT ");
  if (findOptions.getDistinct()) {
    sqlBuffer.append("DISTINCT ");
  }
  if (selectFields.size() > 0) {
    sqlBuffer.append(modelEntity.colNameString(selectFields,", ","",datasourceInfo.aliasViews));
  }
 else {
    sqlBuffer.append("*");
  }
  sqlBuffer.append(SqlJdbcUtil.makeFromClause(modelEntity,datasourceInfo));
  StringBuilder whereString=new StringBuilder();
  String entityCondWhereString="";
  List whereEntityConditionParams=FastList.newInstance();
  if (whereEntityCondition != null) {
    entityCondWhereString=whereEntityCondition.makeWhereString(modelEntity,whereEntityConditionParams,this.datasourceInfo);
  }
  String viewClause=SqlJdbcUtil.makeViewWhereClause(modelEntity,datasourceInfo.joinStyle);
  if (viewClause.length() > 0) {
    if (entityCondWhereString.length() > 0) {
      whereString.append("(");
      whereString.append(entityCondWhereString);
      whereString.append(") AND ");
    }
    whereString.append(viewClause);
  }
 else {
    whereString.append(entityCondWhereString);
  }
  if (whereString.length() > 0) {
    sqlBuffer.append(" WHERE ");
    sqlBuffer.append(whereString.toString());
  }
  if (modelEntity instanceof ModelViewEntity) {
    ModelViewEntity modelViewEntity=(ModelViewEntity)modelEntity;
    String groupByString=modelViewEntity.colNameString(modelViewEntity.getGroupBysCopy(selectFields),", ","",false);
    if (UtilValidate.isNotEmpty(groupByString)) {
      sqlBuffer.append(" GROUP BY ");
      sqlBuffer.append(groupByString);
    }
  }
  String entityCondHavingString="";
  List havingEntityConditionParams=FastList.newInstance();
  if (havingEntityCondition != null) {
    entityCondHavingString=havingEntityCondition.makeWhereString(modelEntity,havingEntityConditionParams,this.datasourceInfo);
  }
  if (entityCondHavingString.length() > 0) {
    sqlBuffer.append(" HAVING ");
    sqlBuffer.append(entityCondHavingString);
  }
  sqlBuffer.append(SqlJdbcUtil.makeOrderByClause(modelEntity,orderBy,datasourceInfo));
  String sql=sqlBuffer.toString();
  SQLProcessor sqlP=new SQLProcessor(helperName);
  sqlP.prepareStatement(sql,findOptions.getSpecifyTypeAndConcur(),findOptions.getResultSetType(),findOptions.getResultSetConcurrency(),findOptions.getFetchSize(),findOptions.getMaxRows());
  if (verboseOn) {
    Debug.logVerbose("Setting the whereEntityConditionParams: " + whereEntityConditionParams,module);
  }
  Iterator whereEntityConditionParamsIter=whereEntityConditionParams.iterator();
  while (whereEntityConditionParamsIter.hasNext()) {
    EntityConditionParam whereEntityConditionParam=(EntityConditionParam)whereEntityConditionParamsIter.next();
    SqlJdbcUtil.setValue(sqlP,whereEntityConditionParam.getModelField(),modelEntity.getEntityName(),whereEntityConditionParam.getFieldValue(),modelFieldTypeReader);
  }
  if (verboseOn) {
    Debug.logVerbose("Setting the havingEntityConditionParams: " + havingEntityConditionParams,module);
  }
  Iterator havingEntityConditionParamsIter=havingEntityConditionParams.iterator();
  while (havingEntityConditionParamsIter.hasNext()) {
    EntityConditionParam havingEntityConditionParam=(EntityConditionParam)havingEntityConditionParamsIter.next();
    SqlJdbcUtil.setValue(sqlP,havingEntityConditionParam.getModelField(),modelEntity.getEntityName(),havingEntityConditionParam.getFieldValue(),modelFieldTypeReader);
  }
  long queryStartTime=0;
  if (Debug.timingOn()) {
    queryStartTime=System.currentTimeMillis();
  }
  sqlP.executeQuery();
  if (Debug.timingOn()) {
    long queryEndTime=System.currentTimeMillis();
    long queryTotalTime=queryEndTime - queryStartTime;
    if (queryTotalTime > 150) {
      Debug.logTiming("Ran query in " + queryTotalTime + " milli-seconds: "+ sql,module);
    }
  }
  return new EntityListIterator(sqlP,modelEntity,selectFields,modelFieldTypeReader);
}
