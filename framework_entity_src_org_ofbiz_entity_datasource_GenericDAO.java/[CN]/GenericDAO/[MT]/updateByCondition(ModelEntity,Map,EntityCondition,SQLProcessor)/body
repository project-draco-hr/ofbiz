{
  if (modelEntity == null || fieldsToSet == null || condition == null)   return 0;
  if (modelEntity instanceof ModelViewEntity) {
    throw new org.ofbiz.entity.GenericNotImplementedException("Operation updateByCondition not supported yet for view entities");
  }
  String sql="UPDATE " + modelEntity.getTableName(datasourceInfo);
  sql+=" SET ";
  Iterator i=fieldsToSet.keySet().iterator();
  List fieldList=new LinkedList();
  boolean firstField=true;
  while (i.hasNext()) {
    String name=(String)i.next();
    ModelField field=modelEntity.getField(name);
    if (field != null) {
      if (!firstField) {
        sql+=", ";
      }
 else {
        firstField=false;
      }
      sql+=field.getColName() + " = ?";
      fieldList.add(field);
    }
  }
  sql+=" WHERE " + condition.makeWhereString(modelEntity,null);
  try {
    sqlP.prepareStatement(sql);
    Iterator fi=fieldList.iterator();
    while (fi.hasNext()) {
      ModelField field=(ModelField)fi.next();
      Object value=fieldsToSet.get(field.getName());
      SqlJdbcUtil.setValue(sqlP,field,modelEntity.getEntityName(),value,modelFieldTypeReader);
    }
    return sqlP.executeUpdate();
  }
  finally {
    sqlP.close();
  }
}
