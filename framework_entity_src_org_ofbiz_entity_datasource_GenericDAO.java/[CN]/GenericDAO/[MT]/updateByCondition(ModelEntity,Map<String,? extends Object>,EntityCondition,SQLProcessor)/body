{
  if (modelEntity == null || fieldsToSet == null || condition == null)   return 0;
  if (modelEntity instanceof ModelViewEntity) {
    throw new org.ofbiz.entity.GenericNotImplementedException("Operation updateByCondition not supported yet for view entities");
  }
  String sql="UPDATE " + modelEntity.getTableName(datasourceInfo);
  sql+=" SET ";
  List<ModelField> fieldList=new LinkedList<ModelField>();
  boolean firstField=true;
  for (  String name : fieldsToSet.keySet()) {
    ModelField field=modelEntity.getField(name);
    if (field != null) {
      if (!firstField) {
        sql+=", ";
      }
 else {
        firstField=false;
      }
      sql+=field.getColName() + " = ?";
      fieldList.add(field);
    }
  }
  sql+=" WHERE " + condition.makeWhereString(modelEntity,null,this.datasourceInfo);
  try {
    sqlP.prepareStatement(sql);
    for (    ModelField field : fieldList) {
      Object value=fieldsToSet.get(field.getName());
      SqlJdbcUtil.setValue(sqlP,field,modelEntity.getEntityName(),value,modelFieldTypeReader);
    }
    return sqlP.executeUpdate();
  }
  finally {
    sqlP.close();
  }
}
