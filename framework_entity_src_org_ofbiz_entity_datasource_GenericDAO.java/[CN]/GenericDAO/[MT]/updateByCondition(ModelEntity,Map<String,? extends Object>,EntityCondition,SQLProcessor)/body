{
  if (modelEntity == null || fieldsToSet == null || condition == null)   return 0;
  if (modelEntity instanceof ModelViewEntity) {
    throw new org.ofbiz.entity.GenericNotImplementedException("Operation updateByCondition not supported yet for view entities");
  }
  StringBuilder sql=new StringBuilder("UPDATE ").append(modelEntity.getTableName(datasourceInfo));
  sql.append(" SET ");
  List<ModelField> fieldList=new LinkedList<ModelField>();
  boolean firstField=true;
  for (  String name : fieldsToSet.keySet()) {
    ModelField field=modelEntity.getField(name);
    if (field != null) {
      if (!firstField) {
        sql.append(", ");
      }
 else {
        firstField=false;
      }
      sql.append(field.getColName()).append(" = ?");
      fieldList.add(field);
    }
  }
  sql.append(" WHERE ").append(condition.makeWhereString(modelEntity,null,this.datasourceInfo));
  try {
    sqlP.prepareStatement(sql.toString());
    for (    ModelField field : fieldList) {
      Object value=fieldsToSet.get(field.getName());
      SqlJdbcUtil.setValue(sqlP,field,modelEntity.getEntityName(),value,modelFieldTypeReader);
    }
    return sqlP.executeUpdate();
  }
  finally {
    sqlP.close();
  }
}
