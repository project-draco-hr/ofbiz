{
  if (field == null || entityAttr == null || pageContext == null) {
    throw new RuntimeException("Required parameter (field or entityAttr or pageContext) missing");
  }
  if (defaultStr == null)   defaultStr="";
  String inputValue=null;
  boolean tryEntity=true;
  boolean fullattrs=false;
  String paramName=param;
  if (UtilValidate.isEmpty(paramName))   paramName=field;
  Boolean tempBool=null;
  if (tryEntityAttr != null)   tempBool=(Boolean)pageContext.findAttribute(tryEntityAttr);
  if (tempBool != null)   tryEntity=tempBool.booleanValue();
  fullattrs="true".equals(fullattrsStr);
  if (tryEntity) {
    Object entTemp=pageContext.findAttribute(entityAttr);
    if (entTemp != null) {
      if (entTemp instanceof GenericValue) {
        GenericValue entity=(GenericValue)entTemp;
        Object fieldVal=entity.get(field);
        if (fieldVal != null)         inputValue=fieldVal.toString();
      }
 else       if (entTemp instanceof Map<?,?>) {
        Map<String,?> map=UtilGenerics.cast(entTemp);
        Object fieldVal=map.get(field);
        if (fieldVal != null)         inputValue=fieldVal.toString();
      }
    }
  }
 else {
    inputValue=pageContext.getRequest().getParameter(paramName);
  }
  if (UtilValidate.isEmpty(inputValue))   inputValue=defaultStr;
  if (fullattrs) {
    inputValue=UtilFormatOut.replaceString(inputValue,"\"","&quot;");
    pageContext.getOut().print("name=\"" + paramName + "\" value=\""+ inputValue+ "\"");
  }
 else {
    pageContext.getOut().print(inputValue);
  }
}
