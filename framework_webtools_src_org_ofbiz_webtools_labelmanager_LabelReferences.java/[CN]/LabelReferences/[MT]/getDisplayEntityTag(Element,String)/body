{
  String entityName=UtilFormatOut.checkNull(element.getAttribute("entity-name"));
  String description=UtilFormatOut.checkNull(element.getAttribute("description"));
  Set<String> fields=new TreeSet<String>();
  Set<String> pkFields=new TreeSet<String>();
  try {
    if (UtilValidate.isNotEmpty(entityName)) {
      GenericDelegator delegator=LabelManagerFactory.getDelegator();
      ModelEntity entity=delegator.getModelEntity(entityName);
      if (UtilValidate.isNotEmpty(entity) && UtilValidate.isNotEmpty(entity.getDefaultResourceName())) {
        int pos=0;
        while (pos >= 0) {
          pos=description.indexOf(startExpression,pos);
          if (pos >= 0) {
            int endLabel=description.indexOf(endExpression,pos);
            if (endLabel >= 0) {
              String fieldName=description.substring(pos + startExpression.length(),endLabel);
              if (!fieldName.startsWith(uiLabelMapInLayoutSettings)) {
                for (                Map.Entry<String,LabelInfo> e : LabelManagerFactory.getLabels().entrySet()) {
                  String keyToSearch=entityName + "." + fieldName;
                  if (e.getKey().startsWith(keyToSearch)) {
                    fields.add(fieldName);
                  }
                }
              }
              pos=endLabel;
            }
 else {
              pos=pos + startExpression.length();
            }
          }
        }
        Iterator<ModelField> iter=entity.getPksIterator();
        while (iter != null && iter.hasNext()) {
          ModelField curField=iter.next();
          pkFields.add(curField.getName());
        }
        Iterator<String> fieldsIt=fields.iterator();
        while (fieldsIt != null && fieldsIt.hasNext()) {
          String fieldName=fieldsIt.next();
          StringBuilder keyBuffer=new StringBuilder();
          keyBuffer.append(entityName);
          keyBuffer.append('.');
          keyBuffer.append(fieldName);
          List<GenericValue> entityRecords=delegator.findList(entityName,null,pkFields,null,null,false);
          for (          GenericValue entityRecord : entityRecords) {
            boolean pkFound=false;
            StringBuilder pkBuffer=new StringBuilder(keyBuffer.toString());
            Iterator<String> itPkFields=pkFields.iterator();
            while (itPkFields != null && itPkFields.hasNext()) {
              String pkField=itPkFields.next();
              Object pkFieldValue=entityRecord.get(pkField);
              if (UtilValidate.isNotEmpty(pkFieldValue)) {
                pkBuffer.append('.');
                pkBuffer.append(pkFieldValue);
                pkFound=true;
              }
            }
            if (pkFound) {
              setLabelReference(pkBuffer.toString(),fileNameURI);
            }
          }
        }
      }
    }
  }
 catch (  GenericEntityException e) {
    Debug.logError(e,"Problem getting records from " + entityName,module);
  }
}
