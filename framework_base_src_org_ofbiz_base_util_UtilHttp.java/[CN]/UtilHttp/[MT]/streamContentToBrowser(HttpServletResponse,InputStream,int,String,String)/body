{
  setResponseBrowserProxyNoCache(response);
  response.setContentLength(length);
  if (contentType != null) {
    response.setContentType(contentType);
  }
  if (fileName != null) {
    response.setHeader("Content-Disposition","attachment;filename=" + fileName);
  }
  OutputStream out=response.getOutputStream();
  try {
    streamContent(out,in,length);
  }
 catch (  IOException e) {
    out.close();
    throw e;
  }
  out.flush();
  out.close();
}
