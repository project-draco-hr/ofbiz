{
  Set<K> keysToRemove=FastSet.newInstance();
  for (  Map.Entry<K,V> mapEntry : map.entrySet()) {
    Object entryValue=mapEntry.getValue();
    if (entryValue != null && !(entryValue instanceof Serializable)) {
      keysToRemove.add(mapEntry.getKey());
    }
    if (entryValue != null && !(entryValue instanceof ServletContext)) {
      keysToRemove.add(mapEntry.getKey());
    }
  }
  for (  K keyToRemove : keysToRemove) {
    map.remove(keyToRemove);
  }
}
