{
  GenericValue orderHeader=null;
  try {
    orderHeader=dispatcher.getDelegator().findByPrimaryKey("OrderHeader",UtilMisc.toMap("orderId",orderId));
  }
 catch (  GenericEntityException e) {
    Debug.logError(e,module);
  }
  if (orderHeader != null) {
    OrderReadHelper orh=new OrderReadHelper(orderHeader);
    List items=orh.getOrderItems();
    Map serviceParam=UtilMisc.toMap("orderId",orderId,"billItems",items,"userLogin",userLogin);
    Map serviceRes=dispatcher.runSync("createInvoiceForOrder",serviceParam);
    if (ServiceUtil.isError(serviceRes)) {
      throw new GenericServiceException(ServiceUtil.getErrorMessage(serviceRes));
    }
  }
}
