{
  Map result=new HashMap();
  GenericDelegator delegator=dctx.getDelegator();
  LocalDispatcher dispatcher=dctx.getDispatcher();
  GenericValue userLogin=(GenericValue)context.get("userLogin");
  String productId=(String)context.get("productId");
  String fromDateStr=(String)context.get("fromDate");
  String bomType=(String)context.get("bomType");
  Integer type=(Integer)context.get("type");
  Double quantity=(Double)context.get("quantity");
  Double amount=(Double)context.get("amount");
  if (type == null) {
    type=new Integer(0);
  }
  Date fromDate=null;
  if (UtilValidate.isNotEmpty(fromDateStr)) {
    try {
      fromDate=Timestamp.valueOf(fromDateStr);
    }
 catch (    Exception e) {
    }
  }
  if (fromDate == null) {
    fromDate=new Date();
  }
  BOMTree tree=null;
  try {
    tree=new BOMTree(productId,bomType,fromDate,type.intValue(),delegator,dispatcher,userLogin);
  }
 catch (  GenericEntityException gee) {
    return ServiceUtil.returnError("Error creating bill of materials tree: " + gee.getMessage());
  }
  if (tree != null && quantity != null) {
    tree.setRootQuantity(quantity.doubleValue());
  }
  if (tree != null && amount != null) {
    tree.setRootAmount(amount.doubleValue());
  }
  result.put("tree",tree);
  return result;
}
