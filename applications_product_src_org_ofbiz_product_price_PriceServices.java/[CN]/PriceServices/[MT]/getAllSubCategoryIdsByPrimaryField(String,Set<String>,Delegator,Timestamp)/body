{
  if (nowTimestamp == null) {
    nowTimestamp=UtilDateTime.nowTimestamp();
  }
  productCategoryIdSet.add(productCategoryId);
  try {
    List<GenericValue> productCategoryList=delegator.findByAndCache("ProductCategory",UtilMisc.toMap("primaryParentCategoryId",productCategoryId));
    for (    GenericValue productCategory : productCategoryList) {
      String subProductCategoryId=productCategory.getString("productCategoryId");
      if (productCategoryIdSet.contains(subProductCategoryId)) {
        continue;
      }
      getAllSubCategoryIdsByPrimaryField(subProductCategoryId,productCategoryIdSet,delegator,nowTimestamp);
    }
  }
 catch (  GenericEntityException e) {
    Debug.logError(e,"Error finding sub-categories for product search",module);
  }
}
