{
  int numOfCells=innerDisplayHyperlinkFieldsBegin.size() + innerDisplayHyperlinkFieldsEnd.size() + (innerFormFields.size() > 0 ? 1 : 0);
  int numOfColumnsToSpan=numOfColumns - numOfCells + 1;
  if (numOfColumnsToSpan < 1) {
    numOfColumnsToSpan=1;
  }
  formStringRenderer.renderFormatItemRowOpen(writer,localContext,this);
  Iterator<ModelFormField> innerDisplayHyperlinkFieldsBeginIter=innerDisplayHyperlinkFieldsBegin.iterator();
  Map<String,Integer> fieldCount=FastMap.newInstance();
  while (innerDisplayHyperlinkFieldsBeginIter.hasNext()) {
    ModelFormField modelFormField=innerDisplayHyperlinkFieldsBeginIter.next();
    if (fieldCount.containsKey(modelFormField.getFieldName())) {
      fieldCount.put(modelFormField.getFieldName(),fieldCount.get(modelFormField.getFieldName()) + 1);
    }
 else {
      fieldCount.put(modelFormField.getFieldName(),1);
    }
  }
  if (this.groupColumns) {
    Iterator<ModelFormField> innerDisplayHyperlinkFieldIter=innerDisplayHyperlinkFieldsBegin.iterator();
    while (innerDisplayHyperlinkFieldIter.hasNext()) {
      boolean cellOpen=false;
      ModelFormField modelFormField=innerDisplayHyperlinkFieldIter.next();
      if (fieldCount.get(modelFormField.getName()) < 2) {
        if ((innerDisplayHyperlinkFieldIter.hasNext() || numOfCells > innerDisplayHyperlinkFieldsBegin.size())) {
          formStringRenderer.renderFormatItemRowCellOpen(writer,localContext,this,modelFormField,1);
        }
 else {
          formStringRenderer.renderFormatItemRowCellOpen(writer,localContext,this,modelFormField,numOfColumnsToSpan);
        }
        cellOpen=true;
      }
      if ((!"list".equals(this.getType()) && !"multi".equals(this.getType())) || modelFormField.shouldUse(localContext)) {
        if ((fieldCount.get(modelFormField.getName()) > 1)) {
          if ((innerDisplayHyperlinkFieldIter.hasNext() || numOfCells > innerDisplayHyperlinkFieldsBegin.size())) {
            formStringRenderer.renderFormatItemRowCellOpen(writer,localContext,this,modelFormField,1);
          }
 else {
            formStringRenderer.renderFormatItemRowCellOpen(writer,localContext,this,modelFormField,numOfColumnsToSpan);
          }
          cellOpen=true;
        }
        modelFormField.renderFieldString(writer,localContext,formStringRenderer);
      }
      if (cellOpen) {
        formStringRenderer.renderFormatItemRowCellClose(writer,localContext,this,modelFormField);
      }
    }
    if (innerFormFields.size() > 0) {
      formStringRenderer.renderFormatItemRowFormCellOpen(writer,localContext,this);
      if (formPerItem) {
        formStringRenderer.renderFormOpen(writer,localContext,this);
      }
      this.renderHiddenIgnoredFields(writer,localContext,formStringRenderer,hiddenIgnoredFieldList);
      Iterator<ModelFormField> innerFormFieldIter=innerFormFields.iterator();
      while (innerFormFieldIter.hasNext()) {
        ModelFormField modelFormField=innerFormFieldIter.next();
        if (separateColumns || modelFormField.getSeparateColumn()) {
          formStringRenderer.renderFormatItemRowCellOpen(writer,localContext,this,modelFormField,1);
        }
        if ((!"list".equals(this.getType()) && !"multi".equals(this.getType())) || modelFormField.shouldUse(localContext)) {
          modelFormField.renderFieldString(writer,localContext,formStringRenderer);
        }
        if (separateColumns || modelFormField.getSeparateColumn()) {
          formStringRenderer.renderFormatItemRowCellClose(writer,localContext,this,modelFormField);
        }
      }
      if (formPerItem) {
        formStringRenderer.renderFormClose(writer,localContext,this);
      }
      formStringRenderer.renderFormatItemRowFormCellClose(writer,localContext,this);
    }
    innerDisplayHyperlinkFieldIter=innerDisplayHyperlinkFieldsEnd.iterator();
    while (innerDisplayHyperlinkFieldIter.hasNext()) {
      ModelFormField modelFormField=innerDisplayHyperlinkFieldIter.next();
      if (innerDisplayHyperlinkFieldIter.hasNext()) {
        formStringRenderer.renderFormatItemRowCellOpen(writer,localContext,this,modelFormField,1);
      }
 else {
        formStringRenderer.renderFormatItemRowCellOpen(writer,localContext,this,modelFormField,numOfColumnsToSpan);
      }
      if ((!"list".equals(this.getType()) && !"multi".equals(this.getType())) || modelFormField.shouldUse(localContext)) {
        modelFormField.renderFieldString(writer,localContext,formStringRenderer);
      }
      formStringRenderer.renderFormatItemRowCellClose(writer,localContext,this,modelFormField);
    }
  }
 else {
    this.renderHiddenIgnoredFields(writer,localContext,formStringRenderer,hiddenIgnoredFieldList);
    Iterator<ModelFormField> mainFieldIter=mainFieldList.iterator();
    while (mainFieldIter.hasNext()) {
      ModelFormField modelFormField=mainFieldIter.next();
      ModelFormField.FieldInfo fieldInfo=modelFormField.getFieldInfo();
      if (fieldInfo.getFieldType() == ModelFormField.FieldInfo.HIDDEN || fieldInfo.getFieldType() == ModelFormField.FieldInfo.IGNORED) {
        continue;
      }
      if (mainFieldIter.hasNext()) {
        formStringRenderer.renderFormatItemRowCellOpen(writer,localContext,this,modelFormField,1);
      }
 else {
        formStringRenderer.renderFormatItemRowCellOpen(writer,localContext,this,modelFormField,numOfColumnsToSpan);
      }
      if ((!"list".equals(this.getType()) && !"multi".equals(this.getType())) || modelFormField.shouldUse(localContext)) {
        modelFormField.renderFieldString(writer,localContext,formStringRenderer);
      }
      formStringRenderer.renderFormatItemRowCellClose(writer,localContext,this,modelFormField);
    }
  }
  formStringRenderer.renderFormatItemRowClose(writer,localContext,this);
}
