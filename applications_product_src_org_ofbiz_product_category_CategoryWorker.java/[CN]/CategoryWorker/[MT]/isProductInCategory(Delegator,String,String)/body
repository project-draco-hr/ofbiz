{
  if (productCategoryId == null)   return false;
  if (UtilValidate.isEmpty(productId))   return false;
  List<GenericValue> productCategoryMembers=EntityUtil.filterByDate(delegator.findByAnd("ProductCategoryMember",UtilMisc.toMap("productCategoryId",productCategoryId,"productId",productId),null,true),true);
  if (UtilValidate.isEmpty(productCategoryMembers)) {
    GenericValue product=EntityQuery.use(delegator).from("Product").where("productId",productId).cache().queryOne();
    List<GenericValue> productAssocs=ProductWorker.getVariantVirtualAssocs(product);
    if (productAssocs != null) {
      for (      GenericValue productAssoc : productAssocs) {
        if (isProductInCategory(delegator,productAssoc.getString("productId"),productCategoryId)) {
          return true;
        }
      }
    }
    return false;
  }
 else {
    return true;
  }
}
