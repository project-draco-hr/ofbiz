{
  if (productCategoryId == null)   return false;
  if (productId == null || productId.length() == 0)   return false;
  List<GenericValue> productCategoryMembers=EntityUtil.filterByDate(delegator.findByAndCache("ProductCategoryMember",UtilMisc.toMap("productCategoryId",productCategoryId,"productId",productId)),true);
  if (UtilValidate.isEmpty(productCategoryMembers)) {
    GenericValue product=delegator.findByPrimaryKeyCache("Product",UtilMisc.toMap("productId",productId));
    List<GenericValue> productAssocs=ProductWorker.getVariantVirtualAssocs(product);
    if (UtilValidate.isNotEmpty(productAssocs)) {
      for (      GenericValue productAssoc : productAssocs) {
        if (isProductInCategory(delegator,productAssoc.getString("productId"),productCategoryId)) {
          return true;
        }
      }
    }
    return false;
  }
 else {
    return true;
  }
}
