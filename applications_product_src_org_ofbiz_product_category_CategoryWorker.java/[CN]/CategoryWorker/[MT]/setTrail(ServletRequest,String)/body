{
  Map requestParameters=UtilHttp.getParameterMap((HttpServletRequest)request);
  String previousCategory=(String)requestParameters.get("pcategory");
  if (Debug.verboseOn())   Debug.logVerbose("[CategoryWorker.setTrail] Start: previousCategory=" + previousCategory + " currentCategory="+ currentCategory,module);
  if (currentCategory == null || currentCategory.length() <= 0)   return;
  List crumb=getTrail(request);
  if (crumb == null) {
    crumb=FastList.newInstance();
  }
  if (previousCategory == null || previousCategory.length() <= 0) {
    if (crumb.contains(currentCategory)) {
      int cindex=crumb.lastIndexOf(currentCategory);
      if (cindex < (crumb.size() - 1)) {
        for (int i=crumb.size() - 1; i > cindex; i--) {
          String deadCat=(String)crumb.remove(i);
          if (Debug.infoOn())           Debug.logInfo("[CategoryWorker.setTrail] Removed after current category index: " + i + " catname: "+ deadCat,module);
        }
      }
      return;
    }
 else {
      crumb.clear();
      crumb.add("TOP");
      if (UtilValidate.isNotEmpty(previousCategory)) {
        crumb.add(previousCategory);
      }
      if (Debug.infoOn())       Debug.logInfo("[CategoryWorker.setTrail] Starting new list, added TOP and previousCategory: " + previousCategory,module);
    }
  }
  if (!crumb.contains(previousCategory)) {
    if (Debug.infoOn())     Debug.logInfo("[CategoryWorker.setTrail] ERROR: previousCategory (" + previousCategory + ") was not in the crumb list, position is lost, starting over with TOP",module);
    crumb.clear();
    crumb.add("TOP");
    if (UtilValidate.isNotEmpty(previousCategory)) {
      crumb.add(previousCategory);
    }
  }
 else {
    int index=crumb.indexOf(previousCategory);
    if (index < (crumb.size() - 1)) {
      for (int i=crumb.size() - 1; i > index; i--) {
        String deadCat=(String)crumb.remove(i);
        if (Debug.infoOn())         Debug.logInfo("[CategoryWorker.setTrail] Removed after previous category index: " + i + " catname: "+ deadCat,module);
      }
    }
  }
  crumb.add(currentCategory);
  if (Debug.verboseOn())   Debug.logVerbose("[CategoryWorker.setTrail] Continuing list: Added currentCategory: " + currentCategory,module);
  setTrail(request,crumb);
}
