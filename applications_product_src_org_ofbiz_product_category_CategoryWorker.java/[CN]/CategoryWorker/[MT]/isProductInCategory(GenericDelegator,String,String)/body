{
  if (productCategoryId == null)   return false;
  if (productId == null || productId.length() == 0)   return false;
  List productCategoryMembers=EntityUtil.filterByDate(delegator.findByAndCache("ProductCategoryMember",UtilMisc.toMap("productCategoryId",productCategoryId,"productId",productId)),true);
  if (productCategoryMembers == null || productCategoryMembers.size() == 0) {
    GenericValue product=delegator.findByPrimaryKeyCache("Product",UtilMisc.toMap("productId",productId));
    List productAssocs=ProductWorker.getVariantVirtualAssocs(product);
    if (productAssocs != null && productAssocs.size() > 0) {
      Iterator pasIter=productAssocs.iterator();
      while (pasIter.hasNext()) {
        GenericValue productAssoc=(GenericValue)pasIter.next();
        if (isProductInCategory(delegator,productAssoc.getString("productId"),productCategoryId)) {
          return true;
        }
      }
    }
    return false;
  }
 else {
    return true;
  }
}
