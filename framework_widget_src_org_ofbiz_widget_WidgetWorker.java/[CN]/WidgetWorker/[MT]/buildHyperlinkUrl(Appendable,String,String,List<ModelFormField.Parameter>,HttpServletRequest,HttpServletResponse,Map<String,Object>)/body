{
  String localRequestName=UtilHttp.encodeAmpersands(target);
  Appendable localWriter=new StringWriter();
  if ("intra-app".equals(targetType)) {
    appendOfbizUrl(localWriter,"/" + localRequestName,request,response);
  }
 else   if ("inter-app".equals(targetType)) {
    String fullTarget=localRequestName;
    localWriter.append(fullTarget);
    String externalLoginKey=(String)request.getAttribute("externalLoginKey");
    if (UtilValidate.isNotEmpty(externalLoginKey)) {
      if (fullTarget.indexOf('?') == -1) {
        localWriter.append('?');
      }
 else {
        localWriter.append("&amp;");
      }
      localWriter.append("externalLoginKey=");
      localWriter.append(externalLoginKey);
    }
  }
 else   if ("content".equals(targetType)) {
    appendContentUrl(localWriter,localRequestName,request);
  }
 else   if ("plain".equals(targetType)) {
    localWriter.append(localRequestName);
  }
 else {
    localWriter.append(localRequestName);
  }
  if (parameterList != null && parameterList.size() > 0) {
    String localUrl=localWriter.toString();
    externalWriter.append(localUrl);
    boolean needsAmp=true;
    if (localUrl.indexOf('?') == -1) {
      externalWriter.append('?');
      needsAmp=false;
    }
    for (    ModelFormField.Parameter parameter : parameterList) {
      if (needsAmp) {
        externalWriter.append("&amp;");
      }
 else {
        needsAmp=true;
      }
      externalWriter.append(parameter.getName());
      externalWriter.append('=');
      StringUtil.SimpleEncoder simpleEncoder=(StringUtil.SimpleEncoder)context.get("simpleEncoder");
      if (simpleEncoder != null) {
        externalWriter.append(simpleEncoder.encode(parameter.getValue(context)));
      }
 else {
        externalWriter.append(parameter.getValue(context));
      }
    }
  }
 else {
    externalWriter.append(localWriter.toString());
  }
}
