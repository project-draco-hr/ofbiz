{
  Map<String,TreeSet<String>> entitiesByPackage=FastMap.newInstance();
  Iterator<String> ecIter=this.getEntityNames().iterator();
  while (ecIter.hasNext()) {
    String entityName=(String)ecIter.next();
    ModelEntity entity=this.getModelEntity(entityName);
    String packageName=entity.getPackageName();
    if (UtilValidate.isNotEmpty(packageFilterSet)) {
      boolean skipThis=false;
      for (      String packageFilter : packageFilterSet) {
        boolean foundMatch=false;
        if (packageName.contains(packageFilter)) {
          foundMatch=true;
        }
        if (!foundMatch) {
          skipThis=true;
        }
      }
      if (skipThis)       continue;
    }
    if (UtilValidate.isNotEmpty(entityFilterSet) && !entityFilterSet.contains(entityName)) {
      continue;
    }
    TreeSet<String> entities=entitiesByPackage.get(entity.getPackageName());
    if (entities == null) {
      entities=new TreeSet<String>();
      entitiesByPackage.put(entity.getPackageName(),entities);
    }
    entities.add(entityName);
  }
  return entitiesByPackage;
}
