{
  pos.setWaitCursor();
  PosTransaction trans=PosTransaction.getCurrentTx(pos.getSession());
  PosScreen.currentScreen.getOutput().print(UtilProperties.getMessage("pos","Processing",Locale.getDefault()));
  if (trans.isEmpty()) {
    PosScreen newPos=pos.showPage("pospanel");
    newPos.showDialog("dialog/error/noitems");
  }
 else   if (trans.getTotalDue() > 0) {
    pos.showDialog("dialog/error/notenoughfunds");
  }
 else {
    pos.getInput().setLock(true);
    pos.getButtons().setLock(true);
    pos.refresh(false);
    try {
      trans.processSale(pos.getOutput());
      pos.getInput().setFunction("PAID");
    }
 catch (    GeneralException e) {
      Debug.logError(e,e.getMessage(),module);
      pos.getInput().setLock(false);
      pos.getButtons().setLock(false);
      pos.showDialog("dialog/error/exception",e.getMessage());
    }
    clearInputPaymentFunctions(pos);
    pos.setNormalCursor();
  }
}
