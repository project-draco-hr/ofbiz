{
  Input input=pos.getInput();
  if (input.isFunctionSet("TOTAL")) {
    String amtStr=amountStr != null ? amountStr : input.value();
    BigDecimal amount;
    if (UtilValidate.isNotEmpty(amtStr)) {
      try {
        amount=new BigDecimal(amtStr);
      }
 catch (      NumberFormatException e) {
        Debug.logError("Invalid number for amount : " + amtStr,module);
        pos.getOutput().print("Invalid Amount!");
        input.clearInput();
        throw new GeneralException();
      }
      amount=amount.movePointLeft(2);
      Debug.log("Set amount / 100 : " + amount,module);
    }
 else {
      Debug.log("Amount is empty; assumption is full amount : " + trans.getTotalDue(),module);
      amount=trans.getTotalDue();
      if (amount.compareTo(BigDecimal.ZERO) <= 0) {
        throw new GeneralException();
      }
    }
    return amount;
  }
 else {
    Debug.log("TOTAL function NOT set",module);
    throw new GeneralException();
  }
}
