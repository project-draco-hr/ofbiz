{
  PosTransaction trans=PosTransaction.getCurrentTx(pos.getSession());
  Input input=pos.getInput();
  String[] gcInfo=input.getFunction("GIFTCARD");
  int paymentCheck=trans.checkPaymentMethodType("GIFT_CARD");
  if (paymentCheck == PosTransaction.NO_PAYMENT) {
    processNoPayment(pos,"GIFT_CARD");
    return;
  }
 else   if (paymentCheck == PosTransaction.EXTERNAL_PAYMENT) {
    if (gcInfo == null) {
      input.setFunction("GIFTCARD");
      pos.getOutput().print(UtilProperties.getMessage(resource,"REFNUM",Locale.getDefault()));
      clearInputPaymentFunctions(pos);
      return;
    }
 else {
      processExternalPayment(pos,"GIFT_CARD",gcInfo[1]);
      return;
    }
  }
  pos.showDialog("dialog/error/notyetsupported");
  clearInputPaymentFunctions(pos);
}
