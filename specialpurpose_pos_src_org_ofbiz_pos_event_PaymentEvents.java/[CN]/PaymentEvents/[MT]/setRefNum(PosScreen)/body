{
  PosTransaction trans=PosTransaction.getCurrentTx(pos.getSession());
  Journal journal=pos.getJournal();
  String sku=journal.getSelectedSku();
  String idx=journal.getSelectedIdx();
  if (UtilValidate.isNotEmpty(idx) && UtilValidate.isEmpty(sku)) {
    String refNum=pos.getInput().value();
    if (UtilValidate.isEmpty(refNum)) {
      pos.getOutput().print(UtilProperties.getMessage(resource,"REFNUM",Locale.getDefault()));
      pos.getInput().setFunction("REFNUM");
    }
 else {
      int index=-1;
      try {
        index=Integer.parseInt(idx);
      }
 catch (      Exception e) {
      }
      if (index > -1) {
        trans.setPaymentRefNum(index,refNum,refNum);
        pos.refresh();
      }
    }
  }
 else {
    pos.refresh();
  }
  clearInputPaymentFunctions(pos);
}
