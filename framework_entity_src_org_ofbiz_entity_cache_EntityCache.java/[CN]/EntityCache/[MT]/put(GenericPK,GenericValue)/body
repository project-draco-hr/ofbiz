{
  if (pk.getModelEntity().getNeverCache()) {
    Debug.logWarning("Tried to put a value of the " + pk.getEntityName() + " entity in the BY PRIMARY KEY cache but this entity has never-cache set to true, not caching.",module);
    return null;
  }
  pk.setImmutable();
  if (entity == null) {
    entity=GenericValue.NULL_VALUE;
  }
 else {
    entity.setImmutable();
  }
  try {
    if (TransactionUtil.getStatus() == TransactionUtil.STATUS_ACTIVE) {
      UserTransaction tx=TransactionFactoryLoader.getInstance().getUserTransaction();
      Map<GenericPK,GenericValue> tempCache=txCacheMap.get(tx);
      if (tempCache != null) {
        return tempCache.put(pk,entity);
      }
    }
  }
 catch (  GenericTransactionException e) {
    Debug.logWarning(e,"Exception thrown while getting transaction status: ",module);
  }
  UtilCache<GenericPK,GenericValue> entityCache=getOrCreateCache(pk.getEntityName());
  return entityCache.put(pk,entity);
}
