{
  Node node=null;
  List<Map<String,String>> nodeList=FastList.newInstance();
  if (UtilValidate.isEmpty(startNodePath)) {
    node=session.getRootNode();
  }
 else {
    node=session.getNode(startNodePath);
  }
  NodeIterator nodeIterator=node.getNodes();
  Map<String,String> nodeEntry=null;
  while (nodeIterator.hasNext()) {
    Node n=nodeIterator.nextNode();
    if (n.getNodes().hasNext()) {
      nodeList.addAll(getRepositoryNodes(session,n.getPath()));
    }
    nodeEntry=FastMap.newInstance();
    if (n.getPath().startsWith("/jcr:system")) {
      continue;
    }
    nodeEntry.put("path",n.getPath());
    nodeEntry.put("primaryNodeType",n.getPrimaryNodeType().getName());
    nodeList.add(nodeEntry);
  }
  return nodeList;
}
