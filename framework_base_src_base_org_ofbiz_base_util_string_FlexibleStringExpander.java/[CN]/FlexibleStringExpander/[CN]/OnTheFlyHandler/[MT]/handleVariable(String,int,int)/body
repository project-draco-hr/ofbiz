{
  String envName=original.substring(start,end);
  localizeCurrency=false;
  int currencyPos=envName.indexOf("?currency(");
  if (currencyPos != -1) {
    int closeBracket=envName.indexOf(")",currencyPos + 10);
    currencyCode=envName.substring(currencyPos + 10,closeBracket);
    localizeCurrency=true;
    envName=envName.substring(0,currencyPos);
  }
  FlexibleMapAccessor fma=new FlexibleMapAccessor(envName);
  Object envVal=fma.get(context,locale);
  if (envVal != null) {
    if (localizeCurrency) {
      targetBuffer.append(UtilFormatOut.formatCurrency(new Double(envVal.toString()),currencyCode,locale));
    }
 else {
      try {
        targetBuffer.append(ObjectType.simpleTypeConvert(envVal,"String",null,timeZone,locale,true));
      }
 catch (      Exception e) {
        targetBuffer.append(envVal);
      }
    }
  }
 else   if (envName.equals("ofbiz.home")) {
    String ofbizHome=System.getProperty("ofbiz.home");
    if (UtilValidate.isNotEmpty(ofbizHome)) {
      targetBuffer.append(ofbizHome);
    }
  }
 else {
    Debug.logWarning("Could not find value in environment for the name [" + envName + "], inserting nothing.",module);
  }
}
