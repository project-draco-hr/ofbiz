{
  JSONObject json=null;
  List<JSONObject> jsonList=new ArrayList<JSONObject>();
  if (list != null) {
    for (    Map<String,Object> val : list) {
      json=new JSONObject();
      for (      String rowKey : val.keySet()) {
        json.put(rowKey,val.get(rowKey));
      }
      jsonList.add(json);
    }
    String jsonStr=jsonList.toString();
    if (jsonStr == null) {
      throw new EventHandlerException("JSON Object was empty; fatal error!");
    }
    response.setContentType("application/json");
    try {
      response.setContentLength(jsonStr.getBytes("UTF8").length);
    }
 catch (    UnsupportedEncodingException e) {
      throw new EventHandlerException("Problems with Json encoding",e);
    }
    Writer out;
    try {
      out=response.getWriter();
      out.write(jsonStr);
      out.flush();
    }
 catch (    IOException e) {
      throw new EventHandlerException("Unable to get response writer",e);
    }
  }
}
