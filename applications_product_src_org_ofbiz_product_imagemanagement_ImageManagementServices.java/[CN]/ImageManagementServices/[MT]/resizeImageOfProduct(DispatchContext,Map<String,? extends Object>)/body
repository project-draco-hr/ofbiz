{
  LocalDispatcher dispatcher=dctx.getDispatcher();
  Delegator delegator=dctx.getDelegator();
  GenericValue userLogin=(GenericValue)context.get("userLogin");
  String imageServerPath=FlexibleStringExpander.expandString(UtilProperties.getPropertyValue("catalog","image.management.path"),context);
  String imageServerUrl=FlexibleStringExpander.expandString(UtilProperties.getPropertyValue("catalog","image.management.url"),context);
  String productId=(String)context.get("productId");
  String contentId=(String)context.get("contentId");
  String dataResourceName=(String)context.get("dataResourceName");
  String drObjectInfo=(String)context.get("drObjectInfo");
  String width=(String)context.get("resizeWidth");
  int resizeWidth=Integer.parseInt(width);
  int resizeHeight=resizeWidth;
  try {
    BufferedImage bufImg=ImageIO.read(new File(imageServerPath + "/" + productId+ "/"+ dataResourceName));
    double imgHeight=bufImg.getHeight();
    double imgWidth=bufImg.getWidth();
    String filenameToUse=dataResourceName.substring(0,dataResourceName.length() - 4) + "-" + resizeWidth+ ".jpg";
    if (dataResourceName.length() > 3) {
      String mimeType=dataResourceName.substring(dataResourceName.length() - 3,dataResourceName.length());
      if (mimeType.equals("jpg")) {
        Map<String,Object> resultResize=ImageManagementServices.resizeImage(bufImg,imgHeight,imgWidth,resizeHeight,resizeWidth);
        ImageIO.write((RenderedImage)resultResize.get("bufferedImage"),mimeType,new File(imageServerPath + "/" + productId+ "/"+ filenameToUse));
        Map<String,Object> contentThumb=FastMap.newInstance();
        contentThumb.put("contentTypeId","DOCUMENT");
        contentThumb.put("userLogin",userLogin);
        Map<String,Object> contentThumbResult=FastMap.newInstance();
        try {
          contentThumbResult=dispatcher.runSync("createContent",contentThumb);
        }
 catch (        GenericServiceException e) {
          Debug.logError(e,module);
          return ServiceUtil.returnError(e.getMessage());
        }
        String contentIdThumb=(String)contentThumbResult.get("contentId");
        String imageUrlThumb=imageServerUrl + "/" + productId+ "/"+ filenameToUse;
        ImageManagementServices.createContentAndDataResource(dctx,userLogin,filenameToUse,imageUrlThumb,contentIdThumb,"image/jpeg");
        Map<String,Object> createContentAssocMap=FastMap.newInstance();
        createContentAssocMap.put("contentAssocTypeId","IMAGE_THUMBNAIL");
        createContentAssocMap.put("contentId",contentId);
        createContentAssocMap.put("contentIdTo",contentIdThumb);
        createContentAssocMap.put("userLogin",userLogin);
        createContentAssocMap.put("mapKey",width);
        try {
          dispatcher.runSync("createContentAssoc",createContentAssocMap);
        }
 catch (        GenericServiceException e) {
          Debug.logError(e,module);
          return ServiceUtil.returnError(e.getMessage());
        }
      }
    }
  }
 catch (  Exception e) {
    Debug.logError(e,module);
    return ServiceUtil.returnError(e.getMessage());
  }
  String successMsg="Resize images successful";
  return ServiceUtil.returnSuccess(successMsg);
}
