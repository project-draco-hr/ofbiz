{
  Map paymentMethodAmounts=FastMap.newInstance();
  List paymentPrefs=getPaymentPreferences();
  Iterator ppit=paymentPrefs.iterator();
  while (ppit.hasNext()) {
    GenericValue paymentPref=(GenericValue)ppit.next();
    List payments=FastList.newInstance();
    try {
      List exprs=UtilMisc.toList(EntityCondition.makeCondition("statusId",EntityOperator.EQUALS,"PMNT_RECEIVED"),EntityCondition.makeCondition("statusId",EntityOperator.EQUALS,"PMNT_CONFIRMED"));
      payments=paymentPref.getRelated("Payment");
      payments=EntityUtil.filterByOr(payments,exprs);
      List conds=UtilMisc.toList(EntityCondition.makeCondition("paymentTypeId",EntityOperator.EQUALS,"CUSTOMER_PAYMENT"),EntityCondition.makeCondition("paymentTypeId",EntityOperator.EQUALS,"CUSTOMER_DEPOSIT"),EntityCondition.makeCondition("paymentTypeId",EntityOperator.EQUALS,"INTEREST_RECEIPT"),EntityCondition.makeCondition("paymentTypeId",EntityOperator.EQUALS,"GC_DEPOSIT"),EntityCondition.makeCondition("paymentTypeId",EntityOperator.EQUALS,"POS_PAID_IN"));
      payments=EntityUtil.filterByOr(payments,conds);
    }
 catch (    GenericEntityException e) {
      Debug.logError(e,module);
    }
    BigDecimal chargedToPaymentPref=ZERO;
    Iterator payit=payments.iterator();
    while (payit.hasNext()) {
      GenericValue payment=(GenericValue)payit.next();
      if (payment.get("amount") != null) {
        chargedToPaymentPref=chargedToPaymentPref.add(payment.getBigDecimal("amount")).setScale(scale + 1,rounding);
      }
    }
    if (chargedToPaymentPref.compareTo(ZERO) > 0) {
      String paymentMethodKey=paymentPref.getString("paymentMethodId") != null ? paymentPref.getString("paymentMethodId") : paymentPref.getString("paymentMethodTypeId");
      if (paymentMethodAmounts.containsKey(paymentMethodKey)) {
        BigDecimal value=(BigDecimal)paymentMethodAmounts.get(paymentMethodKey);
        if (value != null)         chargedToPaymentPref=chargedToPaymentPref.add(value);
      }
      paymentMethodAmounts.put(paymentMethodKey,chargedToPaymentPref.setScale(scale,rounding));
    }
  }
  return paymentMethodAmounts;
}
