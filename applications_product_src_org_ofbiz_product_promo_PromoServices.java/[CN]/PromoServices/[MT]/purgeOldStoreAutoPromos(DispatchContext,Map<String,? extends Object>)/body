{
  Delegator delegator=dctx.getDelegator();
  String productStoreId=(String)context.get("productStoreId");
  Locale locale=(Locale)context.get("locale");
  Timestamp nowTimestamp=UtilDateTime.nowTimestamp();
  List<EntityCondition> condList=FastList.newInstance();
  if (UtilValidate.isEmpty(productStoreId)) {
    condList.add(EntityCondition.makeCondition("productStoreId",EntityOperator.EQUALS,productStoreId));
  }
  condList.add(EntityCondition.makeCondition("userEntered",EntityOperator.EQUALS,"Y"));
  condList.add(EntityCondition.makeCondition("thruDate",EntityOperator.NOT_EQUAL,null));
  condList.add(EntityCondition.makeCondition("thruDate",EntityOperator.LESS_THAN,nowTimestamp));
  EntityCondition cond=EntityCondition.makeCondition(condList,EntityOperator.AND);
  try {
    EntityListIterator eli=delegator.find("ProductStorePromoAndAppl",cond,null,null,null,null);
    GenericValue productStorePromoAndAppl=null;
    while ((productStorePromoAndAppl=eli.next()) != null) {
      GenericValue productStorePromo=delegator.makeValue("ProductStorePromoAppl");
      productStorePromo.setAllFields(productStorePromoAndAppl,true,null,null);
      productStorePromo.remove();
    }
    eli.close();
  }
 catch (  GenericEntityException e) {
    Debug.logError(e,"Error removing expired ProductStorePromo records: " + e.toString(),module);
    return ServiceUtil.returnError(UtilProperties.getMessage(resource,"ProductPromoCodeCannotBeRemoved",UtilMisc.toMap("errorString",e.toString()),locale));
  }
  return ServiceUtil.returnSuccess();
}
