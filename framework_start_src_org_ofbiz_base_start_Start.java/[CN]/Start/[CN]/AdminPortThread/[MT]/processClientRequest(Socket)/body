{
  BufferedReader reader=null;
  PrintWriter writer=null;
  try {
    reader=new BufferedReader(new InputStreamReader(client.getInputStream()));
    String request=reader.readLine();
    if (request != null) {
      writer=new PrintWriter(client.getOutputStream(),true);
      String key=request.substring(0,request.indexOf(':'));
      String command=request.substring(request.indexOf(':') + 1);
      if (key.equals(config.adminKey)) {
        if (command.equals(Start.SHUTDOWN_COMMAND)) {
          if (serverStopping) {
            writer.println("IN-PROGRESS");
          }
 else {
            writer.println("OK");
            writer.flush();
            stopServer();
          }
          return;
        }
 else         if (command.equals(Start.STATUS_COMMAND)) {
          writer.println(serverStopping ? "Stopping" : serverStarted ? "Running" : "Starting");
          return;
        }
      }
    }
    writer.println("FAIL");
  }
  finally {
    if (reader != null) {
      reader.close();
    }
    if (writer != null) {
      writer.flush();
      writer.close();
    }
  }
}
