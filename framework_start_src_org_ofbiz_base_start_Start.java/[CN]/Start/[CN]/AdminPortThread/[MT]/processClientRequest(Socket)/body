{
  BufferedReader reader=null;
  PrintWriter writer=null;
  try {
    reader=new BufferedReader(new InputStreamReader(client.getInputStream()));
    String request=reader.readLine();
    writer=new PrintWriter(client.getOutputStream(),true);
    if (request != null && !request.isEmpty() && request.contains(":")) {
      String key=request.substring(0,request.indexOf(':'));
      Control control=Control.valueOf(request.substring(request.indexOf(':') + 1));
      if (key.equals(config.adminKey)) {
        if (control == Control.SHUTDOWN) {
          if (Start.this.serverState.get() == ServerState.STOPPING) {
            writer.println("IN-PROGRESS");
          }
 else {
            writer.println("OK");
            writer.flush();
            stopServer();
          }
          return;
        }
 else         if (control == Control.STATUS) {
          writer.println(Start.this.serverState.get());
          return;
        }
      }
    }
    writer.println("FAIL");
  }
  finally {
    if (reader != null) {
      reader.close();
    }
    if (writer != null) {
      writer.flush();
      writer.close();
    }
  }
}
