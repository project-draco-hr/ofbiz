{
  String workEffortId=null;
  if (root != null) {
    if (UtilValidate.isEmpty(facilityId)) {
      if (orderId != null) {
        GenericValue order=delegator.findOne("OrderHeader",UtilMisc.toMap("orderId",orderId),false);
        String productStoreId=order.getString("productStoreId");
        if (productStoreId != null) {
          GenericValue productStore=ProductStoreWorker.getProductStore(productStoreId,delegator);
          if (productStore != null) {
            facilityId=productStore.getString("inventoryFacilityId");
          }
        }
      }
      if (facilityId == null && shipmentId != null) {
        GenericValue shipment=delegator.findOne("Shipment",UtilMisc.toMap("shipmentId",shipmentId),false);
        facilityId=shipment.getString("originFacilityId");
      }
    }
    Map<String,Object> tmpMap=root.createManufacturingOrder(facilityId,date,workEffortName,description,routingId,orderId,orderItemSeqId,shipGroupSeqId,shipmentId,true,true);
    workEffortId=(String)tmpMap.get("productionRunId");
  }
  return workEffortId;
}
