{
  if (root != null) {
    String facilityId=null;
    if (orderId != null) {
      GenericValue order=delegator.findByPrimaryKey("OrderHeader",UtilMisc.toMap("orderId",orderId));
      String productStoreId=order.getString("productStoreId");
      if (productStoreId != null) {
        GenericValue productStore=ProductStoreWorker.getProductStore(productStoreId,delegator);
        if (productStore != null) {
          facilityId=productStore.getString("inventoryFacilityId");
        }
      }
    }
    if (facilityId == null && shipmentId != null) {
      GenericValue shipment=delegator.findByPrimaryKey("Shipment",UtilMisc.toMap("shipmentId",shipmentId));
      facilityId=shipment.getString("originFacilityId");
    }
    root.createManufacturingOrder(orderId,orderItemSeqId,shipmentId,facilityId,date,true);
  }
}
