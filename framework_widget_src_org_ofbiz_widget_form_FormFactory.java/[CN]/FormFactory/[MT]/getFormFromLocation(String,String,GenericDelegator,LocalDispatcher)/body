{
  Map modelFormMap=(Map)formLocationCache.get(resourceName);
  if (modelFormMap == null) {
synchronized (FormFactory.class) {
      modelFormMap=(Map)formLocationCache.get(resourceName);
      if (modelFormMap == null) {
        ClassLoader loader=Thread.currentThread().getContextClassLoader();
        if (loader == null) {
          loader=FormFactory.class.getClassLoader();
        }
        URL formFileUrl=null;
        formFileUrl=FlexibleLocation.resolveLocation(resourceName);
        Document formFileDoc=UtilXml.readXmlDocument(formFileUrl,true);
        modelFormMap=readFormDocument(formFileDoc,delegator,dispatcher,resourceName);
        formLocationCache.put(resourceName,modelFormMap);
      }
    }
  }
  ModelForm modelForm=(ModelForm)modelFormMap.get(formName);
  if (modelForm == null) {
    throw new IllegalArgumentException("Could not find form with name [" + formName + "] in class resource ["+ resourceName+ "]");
  }
  return modelForm;
}
