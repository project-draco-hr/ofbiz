{
  GenericDelegator delegator=dctx.getDelegator();
  HashMap results=new HashMap();
  String contentId=(String)context.get("contentId");
  String direction=(String)context.get("direction");
  if (direction != null && direction.equalsIgnoreCase("From")) {
    direction="From";
  }
 else {
    direction="To";
  }
  if (contentId == null) {
    contentId="PUBLISH_ROOT";
  }
  GenericValue content=null;
  try {
    content=delegator.findByPrimaryKey("Content",UtilMisc.toMap("contentId",contentId));
  }
 catch (  GenericEntityException e) {
    System.out.println("Entity Error:" + e.getMessage());
    return ServiceUtil.returnError("Error in retrieving Content. " + e.getMessage());
  }
  String fromDateStr=(String)context.get("fromDateStr");
  String thruDateStr=(String)context.get("thruDateStr");
  Timestamp fromDate=null;
  if (fromDateStr != null && fromDateStr.length() > 0) {
    fromDate=UtilDateTime.toTimestamp(fromDateStr);
  }
  Timestamp thruDate=null;
  if (thruDateStr != null && thruDateStr.length() > 0) {
    thruDate=UtilDateTime.toTimestamp(thruDateStr);
  }
  Map whenMap=new HashMap();
  whenMap.put("followWhen",context.get("followWhen"));
  whenMap.put("pickWhen",context.get("pickWhen"));
  whenMap.put("returnBeforePickWhen",context.get("returnBeforePickWhen"));
  whenMap.put("returnAfterPickWhen",context.get("returnAfterPickWhen"));
  String startContentAssocTypeId=(String)context.get("contentAssocTypeId");
  if (startContentAssocTypeId != null) {
    startContentAssocTypeId="PUBLISH";
  }
  Map nodeMap=new HashMap();
  List pickList=new ArrayList();
  ContentWorker.traverse(delegator,content,fromDate,thruDate,whenMap,0,nodeMap,startContentAssocTypeId,pickList,direction);
  results.put("nodeMap",nodeMap);
  results.put("pickList",pickList);
  return results;
}
