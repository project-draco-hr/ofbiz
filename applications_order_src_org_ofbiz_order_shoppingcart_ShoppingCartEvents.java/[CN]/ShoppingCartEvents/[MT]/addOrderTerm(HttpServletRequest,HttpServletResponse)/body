{
  GenericDelegator delegator=(GenericDelegator)request.getAttribute("delegator");
  LocalDispatcher dispatcher=(LocalDispatcher)request.getAttribute("dispatcher");
  ShoppingCart cart=getCartObject(request);
  ShoppingCartHelper cartHelper=new ShoppingCartHelper(delegator,dispatcher,cart);
  String termTypeId=request.getParameter("termTypeId");
  String termValue=request.getParameter("termValue");
  String termDays=request.getParameter("termDays");
  String termIndex=request.getParameter("termIndex");
  String textValue=request.getParameter("textValue");
  Locale locale=UtilHttp.getLocale(request);
  Double dTermValue=null;
  Long lTermDays=null;
  if (termValue.trim().equals("")) {
    termValue=null;
  }
  if (termDays.trim().equals("")) {
    termDays=null;
  }
  if (UtilValidate.isEmpty(termTypeId)) {
    request.setAttribute("_ERROR_MESSAGE_",UtilProperties.getMessage(resource_error,"OrderOrderTermTypeIsRequired",locale));
    return "error";
  }
  if (!UtilValidate.isSignedDouble(termValue)) {
    request.setAttribute("_ERROR_MESSAGE_",UtilProperties.getMessage(resource_error,"OrderOrderTermValue",UtilMisc.toMap("orderTermValue",UtilValidate.isSignedFloatMsg),locale));
    return "error";
  }
  if (termValue != null) {
    dTermValue=new Double(termValue);
  }
  if (!UtilValidate.isInteger(termDays)) {
    request.setAttribute("_ERROR_MESSAGE_",UtilProperties.getMessage(resource_error,"OrderOrderTermDays",UtilMisc.toMap("orderTermDays",UtilValidate.isLongMsg),locale));
    return "error";
  }
  if (termDays != null) {
    lTermDays=new Long(termDays);
  }
  if ((termIndex != null) && (!"-1".equals(termIndex)) && (UtilValidate.isInteger(termIndex))) {
    cartHelper.removeOrderTerm(Integer.parseInt(termIndex));
  }
  Map result=cartHelper.addOrderTerm(termTypeId,dTermValue,lTermDays,textValue);
  if (ServiceUtil.isError(result)) {
    request.setAttribute("_ERROR_MESSAGE_",ServiceUtil.getErrorMessage(result));
    return "error";
  }
  return "success";
}
