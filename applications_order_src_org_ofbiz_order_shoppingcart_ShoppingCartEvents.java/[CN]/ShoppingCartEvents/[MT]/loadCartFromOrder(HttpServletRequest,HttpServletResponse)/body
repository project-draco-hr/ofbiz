{
  LocalDispatcher dispatcher=(LocalDispatcher)request.getAttribute("dispatcher");
  HttpSession session=request.getSession();
  GenericValue userLogin=(GenericValue)session.getAttribute("userLogin");
  String orderId=request.getParameter("orderId");
  ShoppingCart cart=null;
  try {
    Map<String,Object> outMap=dispatcher.runSync("loadCartFromOrder",UtilMisc.<String,Object>toMap("orderId",orderId,"skipProductChecks",Boolean.TRUE,"userLogin",userLogin));
    if (!ServiceUtil.isSuccess(outMap)) {
      request.setAttribute("_ERROR_MESSAGE_",ServiceUtil.getErrorMessage(outMap));
      return "error";
    }
    cart=(ShoppingCart)outMap.get("shoppingCart");
  }
 catch (  GenericServiceException exc) {
    request.setAttribute("_ERROR_MESSAGE_",exc.getMessage());
    return "error";
  }
  cart.setAttribute("addpty","Y");
  session.setAttribute("shoppingCart",cart);
  session.setAttribute("productStoreId",cart.getProductStoreId());
  session.setAttribute("orderMode",cart.getOrderType());
  session.setAttribute("orderPartyId",cart.getOrderPartyId());
  cart.setOrderId(null);
  return "success";
}
