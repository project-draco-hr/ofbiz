{
  if (quantityDesired == 0)   return 0;
  double promoQuantityAvailable=this.getPromoQuantityAvailable();
  double promoQuantityToUse=quantityDesired;
  if (promoQuantityAvailable > 0) {
    if (promoQuantityToUse > promoQuantityAvailable) {
      promoQuantityToUse=promoQuantityAvailable;
    }
    if (!checkAvailableOnly) {
      GenericPK productPromoCondActionPK=productPromoCondAction.getPrimaryKey();
      Double existingValue=(Double)this.quantityUsedPerPromoCandidate.get(productPromoCondActionPK);
      if (existingValue == null) {
        this.quantityUsedPerPromoCandidate.put(productPromoCondActionPK,new Double(promoQuantityToUse));
      }
 else {
        this.quantityUsedPerPromoCandidate.put(productPromoCondActionPK,new Double(promoQuantityToUse + existingValue.doubleValue()));
      }
      this.promoQuantityUsed+=promoQuantityToUse;
    }
    return promoQuantityToUse;
  }
 else {
    return 0;
  }
}
