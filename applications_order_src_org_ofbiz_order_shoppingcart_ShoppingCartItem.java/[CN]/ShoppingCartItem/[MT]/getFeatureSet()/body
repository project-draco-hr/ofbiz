{
  Set featureSet=new LinkedHashSet();
  GenericValue product=this.getProduct();
  if (product != null) {
    List featureAppls=null;
    try {
      featureAppls=product.getRelated("ProductFeatureAppl");
      List filterExprs=UtilMisc.toList(EntityCondition.makeCondition("productFeatureApplTypeId",EntityOperator.EQUALS,"STANDARD_FEATURE"));
      filterExprs.add(EntityCondition.makeCondition("productFeatureApplTypeId",EntityOperator.EQUALS,"REQUIRED_FEATURE"));
      featureAppls=EntityUtil.filterByOr(featureAppls,filterExprs);
    }
 catch (    GenericEntityException e) {
      Debug.logError(e,"Unable to get features from product : " + product.get("productId"),module);
    }
    if (featureAppls != null) {
      Iterator fai=featureAppls.iterator();
      while (fai.hasNext()) {
        GenericValue appl=(GenericValue)fai.next();
        featureSet.add(appl.getString("productFeatureId"));
      }
    }
  }
  if (this.additionalProductFeatureAndAppls != null) {
    Iterator aapi=this.additionalProductFeatureAndAppls.values().iterator();
    while (aapi.hasNext()) {
      GenericValue appl=(GenericValue)aapi.next();
      featureSet.add(appl.getString("productFeatureId"));
    }
  }
  return featureSet;
}
