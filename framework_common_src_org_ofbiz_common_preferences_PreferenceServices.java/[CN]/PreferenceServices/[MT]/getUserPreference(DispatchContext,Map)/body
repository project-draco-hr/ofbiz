{
  GenericDelegator delegator=ctx.getDelegator();
  Locale locale=(Locale)context.get("locale");
  String userPrefTypeId=(String)context.get("userPrefTypeId");
  if (UtilValidate.isEmpty(userPrefTypeId)) {
    return ServiceUtil.returnError(UtilProperties.getMessage(resource,"getPreference.invalidArgument",locale));
  }
  String userLoginId=PreferenceWorker.getUserLoginId(context,true);
  Map fieldMap=UtilMisc.toMap("userLoginId",userLoginId,"userPrefTypeId",userPrefTypeId);
  String userPrefGroupId=(String)context.get("userPrefGroupId");
  if (UtilValidate.isNotEmpty(userPrefGroupId)) {
    fieldMap.put("userPrefGroupId",userPrefGroupId);
  }
  Map userPrefMap=null;
  try {
    GenericValue preference=EntityUtil.getFirst(delegator.findByAnd("UserPreference",fieldMap));
    if (preference != null) {
      userPrefMap=PreferenceWorker.createUserPrefMap(preference);
    }
  }
 catch (  GenericEntityException e) {
    Debug.logWarning(e.getMessage(),module);
    return ServiceUtil.returnError(UtilProperties.getMessage(resource,"getPreference.readFailure",new Object[]{e.getMessage()},locale));
  }
catch (  GeneralException e) {
    Debug.logWarning(e.getMessage(),module);
    return ServiceUtil.returnError(UtilProperties.getMessage(resource,"getPreference.readFailure",new Object[]{e.getMessage()},locale));
  }
  Map<String,Object> result=ServiceUtil.returnSuccess();
  result.put("userPrefMap",userPrefMap);
  if (userPrefMap != null) {
    Object userPrefValue=userPrefMap.get(userPrefTypeId);
    if (userPrefValue != null) {
      result.put("userPrefValue",userPrefValue);
    }
  }
  return result;
}
