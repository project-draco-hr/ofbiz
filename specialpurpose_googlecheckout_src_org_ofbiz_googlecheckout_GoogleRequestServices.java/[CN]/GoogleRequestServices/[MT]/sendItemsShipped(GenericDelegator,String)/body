{
  List<GenericValue> issued=delegator.findByAnd("ItemIssuance",UtilMisc.toMap("shipmentId",shipmentId));
  if (issued != null && issued.size() > 0) {
    for (    GenericValue issue : issued) {
      String shipmentItemSeqId=issue.getString("shipmentItemSeqId");
      String productId=issue.getString("productId");
      String orderId=issue.getString("orderId");
      GenericValue order=findGoogleOrder(delegator,orderId);
      String externalId=order.getString("externalId");
      if (externalId != null) {
        Map<String,? extends Object> spcLup=UtilMisc.toMap("shipmentId",shipmentId,"shipmentItemSeqId",shipmentItemSeqId);
        List<GenericValue> spc=delegator.findByAnd("ShipmentPackageContent",spcLup);
        GenericValue packageContent=EntityUtil.getFirst(spc);
        String carrier=null;
        if (packageContent != null) {
          GenericValue shipPackage=packageContent.getRelatedOne("ShipmentPackage");
          if (shipPackage != null) {
            List<GenericValue> prs=shipPackage.getRelated("ShipmentPackageRouteSeg");
            GenericValue packageRoute=EntityUtil.getFirst(prs);
            if (packageRoute != null) {
              List<GenericValue> srs=packageRoute.getRelated("ShipmentRouteSegment");
              GenericValue route=EntityUtil.getFirst(srs);
              String track=packageRoute.getString("trackingCode");
              if (route != null) {
                carrier=route.getString("carrierPartyId");
                if (UtilValidate.isEmpty(track)) {
                  track=route.getString("trackingIdNumber");
                }
                try {
                  ShipItemsRequest isr=new ShipItemsRequest(getMerchantInfo(),externalId);
                  isr.addItemShippingInformation(productId,carrier,track);
                  isr.send();
                }
 catch (                CheckoutException e) {
                  Debug.logError(e,module);
                  throw new GeneralException(e);
                }
              }
            }
          }
        }
      }
    }
  }
}
