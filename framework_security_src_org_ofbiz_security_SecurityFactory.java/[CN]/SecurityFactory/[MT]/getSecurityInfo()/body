{
  SecurityInfo instance=configRef.get();
  if (instance == null) {
    URL confUrl=UtilURL.fromResource(SECURITY_CONFIG_XML_FILENAME);
    if (confUrl == null) {
      throw new SecurityConfigurationException("Could not find the " + SECURITY_CONFIG_XML_FILENAME + " file");
    }
    String securityName=UtilProperties.getPropertyValue("security.properties","security.context");
    if (Debug.verboseOn()) {
      Debug.logVerbose("Security implementation context name from security.properties: " + securityName,module);
    }
    Document document=null;
    try {
      document=UtilXml.readXmlDocument(confUrl,true,true);
    }
 catch (    Exception e) {
      throw new SecurityConfigurationException("Exception thrown while reading " + SECURITY_CONFIG_XML_FILENAME + ": ",e);
    }
    Element securityElement=UtilXml.firstChildElement(document.getDocumentElement(),"security","name",securityName);
    if (securityElement == null) {
      throw new SecurityConfigurationException("Could not find the <security> element in the " + SECURITY_CONFIG_XML_FILENAME + " file");
    }
    instance=new SecurityInfo(securityElement);
    if (configRef.compareAndSet(null,instance)) {
      if (Debug.verboseOn()) {
        Debug.logVerbose("Security configuration read from " + SECURITY_CONFIG_XML_FILENAME + ", using class "+ instance.className,module);
      }
    }
 else {
      instance=configRef.get();
    }
  }
  return instance;
}
