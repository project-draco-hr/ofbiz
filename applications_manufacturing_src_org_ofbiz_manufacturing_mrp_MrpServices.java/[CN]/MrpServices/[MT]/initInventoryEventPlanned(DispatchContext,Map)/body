{
  GenericDelegator delegator=ctx.getDelegator();
  LocalDispatcher dispatcher=ctx.getDispatcher();
  Security security=ctx.getSecurity();
  Timestamp now=UtilDateTime.nowTimestamp();
  Locale locale=(Locale)context.get("locale");
  GenericValue userLogin=(GenericValue)context.get("userLogin");
  Debug.logInfo("initInventoryEventPlanned called",module);
  List listResult=null;
  try {
    listResult=delegator.findAll("InventoryEventPlanned");
  }
 catch (  GenericEntityException e) {
    Debug.logError(e,"Error : delegator.findAll(\"InventoryEventPlanned\")",module);
    return ServiceUtil.returnError("Problem, we can not find all the items of InventoryEventPlanned, for more detail look at the log");
  }
  if (listResult != null) {
    try {
      delegator.removeAll(listResult);
    }
 catch (    GenericEntityException e) {
      Debug.logError(e,"Error : delegator.removeAll(listResult), listResult =" + listResult,module);
      return ServiceUtil.returnError("Problem, we can not remove the InventoryEventPlanned items, for more detail look at the log");
    }
  }
  listResult=null;
  try {
    listResult=delegator.findByAnd("Requirement",UtilMisc.toMap("requirementTypeId","MRP_PRO_PURCH_ORDER","statusId","REQ_CREATED"));
  }
 catch (  GenericEntityException e) {
    return ServiceUtil.returnError("Problem, we can not find all the items of InventoryEventPlanned, for more detail look at the log");
  }
  if (listResult != null) {
    try {
      delegator.removeAll(listResult);
    }
 catch (    GenericEntityException e) {
      return ServiceUtil.returnError("Problem, we can not remove the InventoryEventPlanned items, for more detail look at the log");
    }
  }
  listResult=null;
  try {
    listResult=delegator.findByAnd("Requirement",UtilMisc.toMap("requirementTypeId","MRP_PRO_PROD_ORDER","statusId","REQ_CREATED"));
  }
 catch (  GenericEntityException e) {
    return ServiceUtil.returnError("Problem, we can not find all the items of InventoryEventPlanned, for more detail look at the log");
  }
  if (listResult != null) {
    try {
      delegator.removeAll(listResult);
    }
 catch (    GenericEntityException e) {
      return ServiceUtil.returnError("Problem, we can not remove the InventoryEventPlanned items, for more detail look at the log");
    }
  }
  GenericValue genericResult=null;
  Map parameters=null;
  List resultList=null;
  Iterator iteratorResult=null;
  resultList=null;
  iteratorResult=null;
  parameters=UtilMisc.toMap("orderTypeId","SALES_ORDER","itemStatusId","ITEM_APPROVED");
  try {
    resultList=delegator.findByAnd("OrderHeaderAndItems",parameters);
  }
 catch (  GenericEntityException e) {
    Debug.logError(e,"Error : delegator.findByAnd(\"OrderItem\", parameters\")",module);
    Debug.logError(e,"Error : parameters = " + parameters,module);
    return ServiceUtil.returnError("Problem, we can not find the order items, for more detail look at the log");
  }
  iteratorResult=resultList.iterator();
  while (iteratorResult.hasNext()) {
    genericResult=(GenericValue)iteratorResult.next();
    String productId=genericResult.getString("productId");
    Double eventQuantityTmp=new Double(-1.0 * genericResult.getDouble("quantity").doubleValue());
    Timestamp estimatedShipDate=genericResult.getTimestamp("estimatedDeliveryDate");
    if (estimatedShipDate == null) {
      estimatedShipDate=now;
    }
    parameters=UtilMisc.toMap("productId",productId,"eventDate",estimatedShipDate,"inventoryEventPlanTypeId","SALE_ORDER_SHIP");
    try {
      InventoryEventPlannedServices.createOrUpdateInventoryEventPlanned(parameters,eventQuantityTmp,delegator);
    }
 catch (    GenericEntityException e) {
      return ServiceUtil.returnError("Problem initializing the InventoryEventPlanned entity (SALE_ORDER_SHIP)");
    }
  }
  resultList=null;
  iteratorResult=null;
  parameters=UtilMisc.toMap("orderTypeId","PURCHASE_ORDER","itemStatusId","ITEM_APPROVED");
  try {
    resultList=delegator.findByAnd("OrderHeaderAndItems",parameters);
  }
 catch (  GenericEntityException e) {
    Debug.logError(e,"Error : delegator.findByAnd(\"OrderItem\", parameters\")",module);
    Debug.logError(e,"Error : parameters = " + parameters,module);
    return ServiceUtil.returnError("Problem, we can not find the order items, for more detail look at the log");
  }
  iteratorResult=resultList.iterator();
  while (iteratorResult.hasNext()) {
    genericResult=(GenericValue)iteratorResult.next();
    String productId=genericResult.getString("productId");
    Double eventQuantityTmp=new Double(genericResult.getDouble("quantity").doubleValue());
    Timestamp estimatedShipDate=genericResult.getTimestamp("estimatedShipDate");
    if (estimatedShipDate == null) {
      estimatedShipDate=now;
    }
    parameters=UtilMisc.toMap("productId",productId,"eventDate",estimatedShipDate,"inventoryEventPlanTypeId","PUR_ORDER_RECP");
    try {
      InventoryEventPlannedServices.createOrUpdateInventoryEventPlanned(parameters,eventQuantityTmp,delegator);
    }
 catch (    GenericEntityException e) {
      return ServiceUtil.returnError("Problem initializing the InventoryEventPlanned entity (PUR_ORDER_RECP)");
    }
  }
  resultList=null;
  iteratorResult=null;
  parameters=UtilMisc.toMap("workEffortGoodStdTypeId","PRUNT_PROD_NEEDED","statusId","WEGS_CREATED");
  try {
    resultList=delegator.findByAnd("WorkEffortAndGoods",parameters);
  }
 catch (  GenericEntityException e) {
    Debug.logError(e,"Error : delegator.findByAnd(\"OrderItem\", parameters\")",module);
    Debug.logError(e,"Error : parameters = " + parameters,module);
    return ServiceUtil.returnError("Problem, we can not find the order items, for more detail look at the log");
  }
  iteratorResult=resultList.iterator();
  while (iteratorResult.hasNext()) {
    genericResult=(GenericValue)iteratorResult.next();
    String productId=genericResult.getString("productId");
    Double eventQuantityTmp=new Double(-1.0 * genericResult.getDouble("estimatedQuantity").doubleValue());
    Timestamp estimatedShipDate=genericResult.getTimestamp("estimatedStartDate");
    if (estimatedShipDate == null) {
      estimatedShipDate=now;
    }
    parameters=UtilMisc.toMap("productId",productId,"eventDate",estimatedShipDate,"inventoryEventPlanTypeId","MANUF_ORDER_REQ");
    try {
      InventoryEventPlannedServices.createOrUpdateInventoryEventPlanned(parameters,eventQuantityTmp,delegator);
    }
 catch (    GenericEntityException e) {
      return ServiceUtil.returnError("Problem initializing the InventoryEventPlanned entity (MRP_REQUIREMENT)");
    }
  }
  resultList=null;
  iteratorResult=null;
  parameters=UtilMisc.toMap("workEffortGoodStdTypeId","PRUN_PROD_DELIV","statusId","WEGS_CREATED","workEffortTypeId","PROD_ORDER_HEADER");
  try {
    resultList=delegator.findByAnd("WorkEffortAndGoods",parameters);
  }
 catch (  GenericEntityException e) {
    Debug.logError(e,"Error : delegator.findByAnd(\"OrderItem\", parameters\")",module);
    Debug.logError(e,"Error : parameters = " + parameters,module);
    return ServiceUtil.returnError("Problem, we can not find the order items, for more detail look at the log");
  }
  iteratorResult=resultList.iterator();
  while (iteratorResult.hasNext()) {
    genericResult=(GenericValue)iteratorResult.next();
    if ("PRUN_CLOSED".equals(genericResult.getString("currentStatusId"))) {
      continue;
    }
    Double qtyToProduce=genericResult.getDouble("quantityToProduce");
    if (qtyToProduce == null) {
      qtyToProduce=new Double(0);
    }
    Double qtyProduced=genericResult.getDouble("quantityProduced");
    if (qtyProduced == null) {
      qtyProduced=new Double(0);
    }
    if (qtyProduced.compareTo(qtyToProduce) >= 0) {
      continue;
    }
    double qtyDiff=qtyToProduce.doubleValue() - qtyProduced.doubleValue();
    String productId=genericResult.getString("productId");
    Double eventQuantityTmp=new Double(qtyDiff);
    Timestamp estimatedShipDate=genericResult.getTimestamp("estimatedCompletionDate");
    if (estimatedShipDate == null) {
      estimatedShipDate=now;
    }
    parameters=UtilMisc.toMap("productId",productId,"eventDate",estimatedShipDate,"inventoryEventPlanTypeId","MANUF_ORDER_RECP");
    try {
      InventoryEventPlannedServices.createOrUpdateInventoryEventPlanned(parameters,eventQuantityTmp,delegator);
    }
 catch (    GenericEntityException e) {
      return ServiceUtil.returnError("Problem initializing the InventoryEventPlanned entity (MANUF_ORDER_RECP)");
    }
  }
  Map result=new HashMap();
  result.put(ModelService.RESPONSE_MESSAGE,ModelService.RESPOND_SUCCESS);
  Debug.logInfo("return from initInventoryEventPlanned",module);
  return result;
}
