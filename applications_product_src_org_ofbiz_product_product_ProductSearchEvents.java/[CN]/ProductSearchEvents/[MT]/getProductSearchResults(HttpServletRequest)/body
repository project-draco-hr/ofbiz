{
  HttpSession session=request.getSession();
  GenericDelegator delegator=(GenericDelegator)request.getAttribute("delegator");
  String visitId=VisitHandler.getVisitId(session);
  List productSearchConstraintList=ProductSearchSession.ProductSearchOptions.getConstraintList(session);
  if (productSearchConstraintList != null && productSearchConstraintList.size() > 0) {
    ResultSortOrder resultSortOrder=ProductSearchSession.ProductSearchOptions.getResultSortOrder(request);
    ProductSearchSession.checkSaveSearchOptionsHistory(session);
    ProductSearchContext productSearchContext=new ProductSearchContext(delegator,visitId);
    productSearchContext.addProductSearchConstraints(productSearchConstraintList);
    productSearchContext.setResultSortOrder(resultSortOrder);
    return productSearchContext.doQuery(delegator);
  }
 else {
    return null;
  }
}
