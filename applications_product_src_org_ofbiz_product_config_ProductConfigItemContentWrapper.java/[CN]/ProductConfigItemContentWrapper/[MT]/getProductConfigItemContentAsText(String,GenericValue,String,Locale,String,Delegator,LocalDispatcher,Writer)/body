{
  if (configItemId == null && productConfigItem != null) {
    configItemId=productConfigItem.getString("configItemId");
  }
  if (delegator == null && productConfigItem != null) {
    delegator=productConfigItem.getDelegator();
  }
  if (UtilValidate.isEmpty(mimeTypeId)) {
    mimeTypeId="text/html";
  }
  String candidateFieldName=ModelUtil.dbNameToVarName(confItemContentTypeId);
  ModelEntity productConfigItemModel=delegator.getModelEntity("ProductConfigItem");
  if (productConfigItemModel.isField(candidateFieldName)) {
    if (productConfigItem == null) {
      productConfigItem=delegator.findOne("ProductConfigItem",UtilMisc.toMap("configItemId",configItemId),true);
    }
    if (productConfigItem != null) {
      String candidateValue=productConfigItem.getString(candidateFieldName);
      if (UtilValidate.isNotEmpty(candidateValue)) {
        outWriter.write(candidateValue);
        return;
      }
    }
  }
  List<GenericValue> productConfigItemContentList=delegator.findByAnd("ProdConfItemContent",UtilMisc.toMap("configItemId",configItemId,"confItemContentTypeId",confItemContentTypeId),UtilMisc.toList("-fromDate"),true);
  productConfigItemContentList=EntityUtil.filterByDate(productConfigItemContentList);
  GenericValue productConfigItemContent=EntityUtil.getFirst(productConfigItemContentList);
  if (productConfigItemContent != null) {
    Map<String,Object> inContext=FastMap.newInstance();
    inContext.put("productConfigItem",productConfigItem);
    inContext.put("productConfigItemContent",productConfigItemContent);
    ContentWorker.renderContentAsText(dispatcher,delegator,productConfigItemContent.getString("contentId"),outWriter,inContext,locale,mimeTypeId,null,null,false);
  }
}
