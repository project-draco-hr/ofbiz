{
  ShoppingCart cart=(ShoppingCart)request.getSession().getAttribute("shoppingCart");
  LocalDispatcher dispatcher=(LocalDispatcher)request.getAttribute("dispatcher");
  GenericDelegator delegator=(GenericDelegator)request.getAttribute("delegator");
  int shipGroups=cart.getShipGroupSize();
  for (int i=0; i < shipGroups; i++) {
    Map result=getShipGroupEstimate(dispatcher,delegator,cart,i);
    ServiceUtil.getMessages(request,result,null,"","","","",null,null);
    if (result.get(ModelService.RESPONSE_MESSAGE).equals(ModelService.RESPOND_ERROR)) {
      return "error";
    }
    Double shippingTotal=(Double)result.get("shippingTotal");
    if (shippingTotal == null) {
      shippingTotal=new Double(0.00);
    }
    cart.setItemShipGroupEstimate(shippingTotal.doubleValue(),i);
  }
  return "success";
}
