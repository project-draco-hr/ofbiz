{
  Element rootElement=null;
  try {
    rootElement=ServiceConfigUtil.getXmlRootElement();
  }
 catch (  GenericConfigException e) {
    throw new GenericServiceException("Error getting Service Engine XML root element",e);
  }
  Element engineElement=UtilXml.firstChildElement(rootElement,"engine","name",engineName);
  if (engineElement == null) {
    throw new GenericServiceException("Cannot find an engine definition for the engine name [" + engineName + "] in the serviceengine.xml file");
  }
  String className=engineElement.getAttribute("class");
  GenericEngine engine=(GenericEngine)engines.get(engineName);
  if (engine == null) {
synchronized (GenericEngineFactory.class) {
      engine=(GenericEngine)engines.get(engineName);
      if (engine == null) {
        Class[] paramTypes=new Class[]{ServiceDispatcher.class};
        Object[] params=new Object[]{dispatcher};
        try {
          ClassLoader loader=Thread.currentThread().getContextClassLoader();
          Class c=loader.loadClass(className);
          Constructor cn=c.getConstructor(paramTypes);
          engine=(GenericEngine)cn.newInstance(params);
        }
 catch (        Exception e) {
          throw new GenericServiceException(e.getMessage(),e);
        }
        if (engine != null) {
          engines.put(engineName,engine);
        }
      }
    }
  }
  return engine;
}
