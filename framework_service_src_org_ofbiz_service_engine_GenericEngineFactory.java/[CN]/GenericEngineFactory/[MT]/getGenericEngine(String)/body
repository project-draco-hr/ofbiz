{
  Element rootElement=null;
  try {
    rootElement=ServiceConfigUtil.getXmlRootElement();
  }
 catch (  GenericConfigException e) {
    throw new GenericServiceException("Error getting Service Engine XML root element",e);
  }
  Element engineElement=UtilXml.firstChildElement(rootElement,"engine","name",engineName);
  if (engineElement == null) {
    throw new GenericServiceException("Cannot find a service engine definition for the engine name [" + engineName + "] in the serviceengine.xml file");
  }
  String className=engineElement.getAttribute("class");
  GenericEngine engine=engines.get(engineName);
  if (engine == null) {
synchronized (GenericEngineFactory.class) {
      engine=engines.get(engineName);
      if (engine == null) {
        try {
          ClassLoader loader=Thread.currentThread().getContextClassLoader();
          Class<?> c=loader.loadClass(className);
          Constructor<GenericEngine> cn=UtilGenerics.cast(c.getConstructor(ServiceDispatcher.class));
          engine=cn.newInstance(dispatcher);
        }
 catch (        Exception e) {
          throw new GenericServiceException(e.getMessage(),e);
        }
        if (engine != null) {
          engines.put(engineName,engine);
        }
      }
    }
  }
  return engine;
}
