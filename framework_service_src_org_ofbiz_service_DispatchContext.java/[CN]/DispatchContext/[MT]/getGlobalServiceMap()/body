{
  Map<String,ModelService> serviceMap=modelServiceMapByDispatcher.get(GLOBAL_KEY);
  if (serviceMap == null) {
synchronized (this) {
      serviceMap=modelServiceMapByDispatcher.get(GLOBAL_KEY);
      if (serviceMap == null) {
        serviceMap=FastMap.newInstance();
        Element rootElement;
        try {
          rootElement=ServiceConfigUtil.getXmlRootElement();
        }
 catch (        GenericConfigException e) {
          Debug.logError(e,"Error getting Service Engine XML root element",module);
          return null;
        }
        for (        Element globalServicesElement : UtilXml.childElementList(rootElement,"global-services")) {
          ResourceHandler handler=new MainResourceHandler(ServiceConfigUtil.SERVICE_ENGINE_XML_FILENAME,globalServicesElement);
          Map<String,ModelService> servicesMap=ModelServiceReader.getModelServiceMap(handler,this);
          if (servicesMap != null) {
            serviceMap.putAll(servicesMap);
          }
        }
        List componentResourceInfos=ComponentConfig.getAllServiceResourceInfos("model");
        Iterator componentResourceInfoIter=componentResourceInfos.iterator();
        while (componentResourceInfoIter.hasNext()) {
          ComponentConfig.ServiceResourceInfo componentResourceInfo=(ComponentConfig.ServiceResourceInfo)componentResourceInfoIter.next();
          Map<String,ModelService> servicesMap=ModelServiceReader.getModelServiceMap(componentResourceInfo.createResourceHandler(),this);
          if (servicesMap != null) {
            serviceMap.putAll(servicesMap);
          }
        }
        if (serviceMap != null) {
          modelServiceMapByDispatcher.put(GLOBAL_KEY,serviceMap);
          ServiceEcaUtil.reloadConfig();
        }
      }
    }
  }
  return serviceMap;
}
