{
  GenericDelegator delegator=invoice.getDelegator();
  List locations=null;
  try {
    locations=invoice.getRelated("InvoiceContactMech",UtilMisc.toMap("contactMechPurposeTypeId",contactMechPurposeTypeId),null);
  }
 catch (  GenericEntityException e) {
    Debug.logError("Touble getting InvoiceContactMech entity list",module);
  }
  if (locations == null || locations.size() == 0) {
    String destinationPartyId=null;
    if (invoice.getString("invoiceTypeId").equals("SALES_INVOICE"))     destinationPartyId=invoice.getString("partyId");
    if (invoice.getString("invoiceTypeId").equals("PURCHASE_INVOICE"))     destinationPartyId="partyFrom";
    try {
      locations=EntityUtil.filterByDate(delegator.findByAnd("PartyContactMechPurpose",UtilMisc.toMap("partyId",destinationPartyId,"contactMechPurposeTypeId",contactMechPurposeTypeId)));
    }
 catch (    GenericEntityException e) {
      Debug.logError("Trouble getting contact party purpose list",module);
    }
    if (locations == null || locations.size() == 0) {
      try {
        locations=EntityUtil.filterByDate(delegator.findByAnd("PartyContactMechPurpose",UtilMisc.toMap("partyId",destinationPartyId,"contactMechPurposeTypeId","GENERAL_LOCATION")));
      }
 catch (      GenericEntityException e) {
        Debug.logError("Trouble getting contact party purpose list",module);
      }
    }
  }
  GenericValue postalAddress=null;
  GenericValue contactMech=null;
  if (locations != null && locations.size() > 0) {
    try {
      contactMech=((GenericValue)locations.get(0)).getRelatedOne("ContactMech");
    }
 catch (    GenericEntityException e) {
      Debug.logError(e,"Trouble getting Contact for contactMechId: " + contactMech.getString("contactMechId"),module);
    }
    if (contactMech.getString("contactMechTypeId").equals("POSTAL_ADDRESS")) {
      try {
        postalAddress=contactMech.getRelatedOne("PostalAddress");
        return postalAddress;
      }
 catch (      GenericEntityException e) {
        Debug.logError(e,"Trouble getting PostalAddress for contactMechId: " + contactMech.getString("contactMechId"),module);
      }
    }
  }
  return contactMech;
}
