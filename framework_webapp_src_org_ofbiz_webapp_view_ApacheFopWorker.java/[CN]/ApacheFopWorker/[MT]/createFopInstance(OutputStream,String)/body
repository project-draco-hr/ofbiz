{
  if (UtilValidate.isEmpty(outputFormat)) {
    outputFormat=MimeConstants.MIME_PDF;
  }
  FopFactory fopFactory=getFactoryInstance();
  FOUserAgent foUserAgent=fopFactory.newFOUserAgent();
  Fop fop;
  if (out != null) {
    fop=fopFactory.newFop(outputFormat,foUserAgent,out);
  }
 else {
    fop=fopFactory.newFop(outputFormat,foUserAgent);
  }
  return fop;
}
