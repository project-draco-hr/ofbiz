{
  if (this.strElems == null || context == null) {
    return this.orig == null ? "" : this.orig;
  }
  if (locale == null) {
    locale=(Locale)context.get("locale");
    if (locale == null && context.containsKey("autoUserLogin")) {
      Map<String,Object> autoUserLogin=UtilGenerics.cast(context.get("autoUserLogin"));
      locale=UtilMisc.ensureLocale(autoUserLogin.get("lastLocale"));
    }
    if (locale == null) {
      locale=Locale.getDefault();
    }
  }
  if (timeZone == null) {
    timeZone=(TimeZone)context.get("timeZone");
    if (timeZone == null && context.containsKey("autoUserLogin")) {
      Map<String,String> autoUserLogin=UtilGenerics.cast(context.get("autoUserLogin"));
      timeZone=UtilDateTime.toTimeZone(autoUserLogin.get("lastTimeZone"));
    }
    if (timeZone == null) {
      timeZone=TimeZone.getDefault();
    }
  }
  StringBuilder buffer=new StringBuilder(this.hint);
  for (  StrElem elem : this.strElems) {
    elem.append(buffer,context,timeZone,locale);
  }
  if (buffer.length() > this.hint) {
synchronized (this) {
      this.hint=buffer.length();
    }
  }
  return buffer.toString();
}
