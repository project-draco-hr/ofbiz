{
  GenericDelegator delegator=orderHeader.getDelegator();
  GenericValue paymentSettings=null;
  GenericValue paymentMethod=null;
  try {
    paymentMethod=paymentPreference.getRelatedOne("PaymentMethod");
  }
 catch (  GenericEntityException e) {
    Debug.logError(e,"Problem getting PaymentMethod from OrderPaymentPreference",module);
  }
  if (paymentMethod != null) {
    String productStoreId=orderHeader.getString("productStoreId");
    String paymentMethodTypeId=paymentMethod.getString("paymentMethodTypeId");
    if (productStoreId != null && paymentMethodTypeId != null) {
      paymentSettings=ProductStoreWorker.getProductStorePaymentSetting(delegator,productStoreId,paymentMethodTypeId,paymentServiceType,anyServiceType);
    }
  }
  return paymentSettings;
}
