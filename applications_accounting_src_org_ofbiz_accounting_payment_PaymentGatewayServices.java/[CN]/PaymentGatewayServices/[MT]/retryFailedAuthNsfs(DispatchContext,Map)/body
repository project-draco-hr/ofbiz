{
  GenericDelegator delegator=dctx.getDelegator();
  LocalDispatcher dispatcher=dctx.getDispatcher();
  GenericValue userLogin=(GenericValue)context.get("userLogin");
  Calendar calcCal=Calendar.getInstance();
  calcCal.setTimeInMillis(System.currentTimeMillis());
  calcCal.add(Calendar.WEEK_OF_YEAR,-1);
  Timestamp oneWeekAgo=new Timestamp(calcCal.getTimeInMillis());
  EntityListIterator eli=null;
  try {
    eli=delegator.find("OrderPaymentPreference",new EntityExpr(new EntityExpr("needsNsfRetry",EntityOperator.EQUALS,"Y"),EntityOperator.AND,new EntityExpr(ModelEntity.STAMP_FIELD,EntityOperator.LESS_THAN_EQUAL_TO,oneWeekAgo)),null,null,UtilMisc.toList("orderId"),null);
    List processList=new ArrayList();
    if (eli != null) {
      Debug.logInfo("Processing failed order re-auth(s)",module);
      GenericValue value=null;
      while (((value=(GenericValue)eli.next()) != null)) {
        String orderId=value.getString("orderId");
        if (!processList.contains(orderId)) {
          try {
            dispatcher.runAsync("retryFailedOrderAuth",UtilMisc.<String,Object>toMap("orderId",orderId,"userLogin",userLogin));
            processList.add(orderId);
          }
 catch (          GenericServiceException e) {
            Debug.logError(e,module);
          }
        }
      }
    }
  }
 catch (  GenericEntityException e) {
    Debug.logError(e,module);
  }
 finally {
    if (eli != null) {
      try {
        eli.close();
      }
 catch (      GenericEntityException e) {
        Debug.logError(e,module);
      }
    }
  }
  return ServiceUtil.returnSuccess();
}
