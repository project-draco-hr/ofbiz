{
  HttpSession session=((HttpServletRequest)request).getSession();
  Map requestParameters=UtilHttp.getParameterMap((HttpServletRequest)request);
  String prodCatalogId=null;
  boolean fromSession=false;
  prodCatalogId=(String)requestParameters.get("CURRENT_CATALOG_ID");
  if (prodCatalogId == null) {
    prodCatalogId=(String)session.getAttribute("CURRENT_CATALOG_ID");
    if (prodCatalogId != null)     fromSession=true;
  }
  if (prodCatalogId == null) {
    List catalogIds=getCatalogIdsAvailable(request);
    if (catalogIds != null && catalogIds.size() > 0)     prodCatalogId=(String)catalogIds.get(0);
  }
  if (!fromSession) {
    if (Debug.verboseOn())     Debug.logVerbose("[CatalogWorker.getCurrentCatalogId] Setting new catalog name: " + prodCatalogId,module);
    session.setAttribute("CURRENT_CATALOG_ID",prodCatalogId);
    CategoryWorker.setTrail(request,FastList.newInstance());
  }
  return prodCatalogId;
}
