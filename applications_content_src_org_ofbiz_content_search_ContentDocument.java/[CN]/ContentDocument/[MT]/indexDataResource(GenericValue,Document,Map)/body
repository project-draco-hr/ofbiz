{
  GenericDelegator delegator=content.getDelegator();
  String contentId=content.getString("contentId");
  String dataResourceId=content.getString("dataResourceId");
  GenericValue dataResource=null;
  try {
    dataResource=delegator.findByPrimaryKeyCache("DataResource",UtilMisc.toMap("dataResourceId",dataResourceId));
  }
 catch (  GenericEntityException e) {
    Debug.logError(e,module);
    List badIndexList=(List)context.get("badIndexList");
    badIndexList.add(contentId + " - " + e.getMessage());
    return false;
  }
  if (dataResource == null) {
    List badIndexList=(List)context.get("badIndexList");
    badIndexList.add(contentId + " - dataResource is null.");
    return false;
  }
  String mimeTypeId=dataResource.getString("mimeTypeId");
  if (UtilValidate.isEmpty(mimeTypeId)) {
    mimeTypeId="text/html";
  }
  Locale locale=Locale.getDefault();
  String currentLocaleString=dataResource.getString("localeString");
  if (UtilValidate.isNotEmpty(currentLocaleString)) {
    locale=UtilMisc.parseLocale(currentLocaleString);
  }
  String text=null;
  try {
    text=ContentWorker.renderContentAsTextCache(delegator,contentId,context,content,locale,mimeTypeId);
  }
 catch (  GeneralException e) {
    Debug.logError(e,module);
    List badIndexList=(List)context.get("badIndexList");
    badIndexList.add(contentId + " - " + e.getMessage());
    return false;
  }
catch (  IOException e2) {
    Debug.logError(e2,module);
    List badIndexList=(List)context.get("badIndexList");
    badIndexList.add(contentId + " - " + e2.getMessage());
    return false;
  }
  if (UtilValidate.isNotEmpty(text)) {
    Field field=Field.UnStored("content",text);
    doc.add(field);
  }
  List featureDataResourceList=null;
  try {
    featureDataResourceList=content.getRelatedCache("ProductFeatureDataResource");
  }
 catch (  GenericEntityException e) {
    Debug.logError(e,module);
    List badIndexList=(List)context.get("badIndexList");
    badIndexList.add(contentId + " - " + e.getMessage());
    return false;
  }
  List featureList=new ArrayList();
  Iterator iter=featureDataResourceList.iterator();
  while (iter.hasNext()) {
    GenericValue productFeatureDataResource=(GenericValue)iter.next();
    String feature=productFeatureDataResource.getString("productFeatureId");
    featureList.add(feature);
  }
  String featureString=StringUtil.join(featureList," ");
  if (UtilValidate.isNotEmpty(featureString)) {
    Field field=Field.UnStored("feature",featureString);
    doc.add(field);
  }
  return true;
}
