{
  Delegator delegator=dctx.getDelegator();
  String billingAccountId=(String)context.get("billingAccountId");
  Map result=ServiceUtil.returnSuccess();
  try {
    GenericValue billingAccount=delegator.findByPrimaryKey("BillingAccount",UtilMisc.toMap("billingAccountId",billingAccountId));
    if (billingAccount == null) {
      return ServiceUtil.returnError("Unable to locate billing account #" + billingAccountId);
    }
    result.put("billingAccount",billingAccount);
    result.put("accountBalance",getBillingAccountBalance(delegator,billingAccountId));
    result.put("netAccountBalance",getBillingAccountNetBalance(delegator,billingAccountId));
    result.put("availableBalance",getBillingAccountAvailableBalance(billingAccount));
    result.put("availableToCapture",availableToCapture(billingAccount));
    return result;
  }
 catch (  GenericEntityException e) {
    Debug.logError(e,module);
    return ServiceUtil.returnError("Error getting billing account or calculating balance for billing account #" + billingAccountId);
  }
}
