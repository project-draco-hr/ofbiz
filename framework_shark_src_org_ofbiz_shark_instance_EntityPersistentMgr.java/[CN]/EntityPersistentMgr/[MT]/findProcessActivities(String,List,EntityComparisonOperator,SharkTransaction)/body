{
  GenericDelegator delegator=SharkContainer.getDelegator();
  List createdList=new ArrayList();
  List order=UtilMisc.toList("lastStateTime");
  List lookupList=null;
  try {
    EntityCondition cond=null;
    EntityCondition proc=new EntityExpr("processId",EntityOperator.EQUALS,processId);
    if (states != null) {
      EntityCondition stateCond=this.makeStateListCondition("currentState",states,operator,EntityOperator.OR);
      cond=new EntityConditionList(UtilMisc.toList(proc,stateCond),EntityOperator.AND);
    }
 else {
      cond=proc;
    }
    lookupList=delegator.findByCondition("WfActivity",cond,null,order);
  }
 catch (  GenericEntityException e) {
    throw new PersistenceException(e);
  }
  if (lookupList != null && lookupList.size() > 0) {
    Iterator i=lookupList.iterator();
    while (i.hasNext()) {
      GenericValue v=(GenericValue)i.next();
      createdList.add(Activity.getInstance(this,v));
    }
  }
  return createdList;
}
