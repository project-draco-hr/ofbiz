{
  boolean beganTransaction=false;
  try {
    if (alwaysUseTransaction) {
      beganTransaction=TransactionUtil.begin();
    }
    if (doCacheClear) {
      this.clearCacheLineByCondition(entityName,condition);
    }
    ModelEntity modelEntity=getModelReader().getModelEntity(entityName);
    GenericHelper helper=getEntityHelper(entityName);
    List<GenericValue> removedEntities=null;
    if (testMode) {
      removedEntities=this.findList(entityName,condition,null,null,null,false);
    }
    int rowsAffected=helper.removeByCondition(modelEntity,condition);
    if (testMode) {
      for (      GenericValue entity : removedEntities) {
        storeForTestRollback(new TestOperation(OperationType.DELETE,entity));
      }
    }
    return rowsAffected;
  }
 catch (  GenericEntityException e) {
    String errMsg="Failure in removeByCondition operation for entity [" + entityName + "]: "+ e.toString()+ ". Rolling back transaction.";
    Debug.logError(e,errMsg,module);
    try {
      TransactionUtil.rollback(beganTransaction,errMsg,e);
    }
 catch (    GenericEntityException e2) {
      Debug.logError(e2,"[GenericDelegator] Could not rollback transaction: " + e2.toString(),module);
    }
    throw e;
  }
 finally {
    TransactionUtil.commit(beganTransaction);
  }
}
