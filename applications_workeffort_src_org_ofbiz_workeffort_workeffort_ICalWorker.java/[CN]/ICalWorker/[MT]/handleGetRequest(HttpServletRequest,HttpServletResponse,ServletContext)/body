{
  setupRequest(request,response);
  String workEffortId=(String)request.getAttribute("workEffortId");
  if (workEffortId == null) {
    Debug.logInfo("[sendCalendar] workEffortId missing",module);
    response.sendError(HttpServletResponse.SC_BAD_REQUEST);
    return;
  }
  Debug.logInfo("[sendCalendar] workEffortId = " + workEffortId,module);
  try {
    String calendar=ICalConverter.getICalendar(workEffortId,createConversionContext(request));
    if (calendar == null) {
      response.sendError(HttpServletResponse.SC_NOT_FOUND);
      return;
    }
    response.setContentType("text/calendar");
    response.setStatus(HttpServletResponse.SC_OK);
    Writer writer=getWriter(response,context);
    writer.write(calendar);
    writer.close();
  }
 catch (  Exception e) {
    Debug.logError(e,"[sendCalendar] Error while sending calendar: ",module);
    response.setStatus(HttpServletResponse.SC_INTERNAL_SERVER_ERROR);
    return;
  }
}
