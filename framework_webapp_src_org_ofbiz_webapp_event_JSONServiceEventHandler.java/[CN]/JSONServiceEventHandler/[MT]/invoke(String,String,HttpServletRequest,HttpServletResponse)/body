{
  String respCode=service.invoke(eventPath,eventMethod,request,response);
  Map attrMap=getAttributesAsMap(request);
  JSONObject json=JSONObject.fromMap(attrMap);
  String jsonStr=json.toString();
  if (jsonStr == null) {
    throw new EventHandlerException("JSON Object was empty; fatal error!");
  }
  response.setContentType("application/x-json");
  response.setContentLength(jsonStr.length());
  Writer out;
  try {
    out=response.getWriter();
    out.write(jsonStr);
    out.flush();
  }
 catch (  IOException e) {
    throw new EventHandlerException("Unable to get response writer",e);
  }
  return respCode;
}
