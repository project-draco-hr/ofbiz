{
  if (orderId == null && order != null) {
    orderId=order.getString("orderId");
  }
  if (orderItemSeqId == null && order != null) {
    orderItemSeqId=(order.getEntityName().equals("OrderItem") ? order.getString("orderItemSeqId") : "_NA_");
  }
  if (delegator == null && order != null) {
    delegator=order.getDelegator();
  }
  if (UtilValidate.isEmpty(mimeTypeId)) {
    mimeTypeId="text/html";
  }
  List<GenericValue> orderContentList=delegator.findByAnd("OrderContent",UtilMisc.toMap("orderId",orderId,"orderItemSeqId",orderItemSeqId,"orderContentTypeId",orderContentTypeId),UtilMisc.toList("-fromDate"),true);
  orderContentList=EntityUtil.filterByDate(orderContentList);
  GenericValue orderContent=EntityUtil.getFirst(orderContentList);
  if (orderContent != null) {
    Map<String,Object> inContext=FastMap.newInstance();
    inContext.put("order",order);
    inContext.put("orderContent",orderContent);
    ContentWorker.renderContentAsText(dispatcher,delegator,orderContent.getString("contentId"),outWriter,inContext,locale,mimeTypeId,null,null,false);
  }
}
