{
  Map result=ServiceUtil.returnSuccess();
  GenericDelegator delegator=dctx.getDelegator();
  String serviceName=(String)context.get("serviceName");
  String jobId=(String)context.get("jobId");
  String jobName=(String)context.get("jobName");
  int viewIndex=0;
  try {
    viewIndex=Integer.parseInt((String)context.get("VIEW_INDEX"));
  }
 catch (  Exception e) {
    viewIndex=0;
  }
  result.put("viewIndex",Integer.valueOf(viewIndex));
  int viewSize=50;
  try {
    viewSize=Integer.parseInt((String)context.get("VIEW_SIZE"));
  }
 catch (  Exception e) {
    viewSize=50;
  }
  result.put("viewSize",Integer.valueOf(viewSize));
  String lookupFlag=(String)context.get("lookupFlag");
  List paramList=FastList.newInstance();
  List conditions=FastList.newInstance();
  List jobList=null;
  int jobListSize=0;
  int lowIndex=0;
  int highIndex=0;
  EntityListIterator eli=null;
  if ("Y".equals(lookupFlag)) {
    String showAll=(context.get("showAll") != null ? (String)context.get("showAll") : "N");
    paramList.add("showAll=" + showAll);
    paramList.add("lookupFlag=" + lookupFlag);
    if (UtilValidate.isNotEmpty(serviceName)) {
      paramList.add("serviceName=" + serviceName);
      conditions.add(EntityCondition.makeCondition(EntityFunction.UPPER_FIELD("serviceName"),EntityOperator.LIKE,EntityFunction.UPPER("%" + serviceName + "%")));
    }
    if (UtilValidate.isNotEmpty(jobId)) {
      paramList.add("jobId=" + jobId);
      conditions.add(EntityCondition.makeCondition(EntityFunction.UPPER_FIELD("jobId"),EntityOperator.LIKE,EntityFunction.UPPER("%" + jobId + "%")));
    }
    if (UtilValidate.isNotEmpty(jobName)) {
      paramList.add("jobName=" + jobName);
      conditions.add(EntityCondition.makeCondition(EntityFunction.UPPER_FIELD("jobName"),EntityOperator.LIKE,EntityFunction.UPPER("%" + jobName + "%")));
    }
    List filterExprs=FastList.newInstance();
    String filterJobPending=(String)context.get("filterJobsWithPendingStatus");
    String filterJobRunning=(String)context.get("filterJobsWithRunningStatus");
    String filterJobFinished=(String)context.get("filterJobsWithFinishedStatus");
    if (filterJobPending == null) {
      filterJobPending="N";
    }
    if (filterJobRunning == null) {
      filterJobRunning="N";
    }
    if (filterJobFinished == null) {
      filterJobFinished="N";
    }
    if ("Y".equals(filterJobPending)) {
      paramList.add("filterJobsWithPendingStatus=Y");
      filterExprs.add(EntityCondition.makeCondition("statusId","SERVICE_PENDING"));
      result.put("filterJobsWithPendingStatus",filterJobPending);
    }
    if ("Y".equals(filterJobRunning)) {
      paramList.add("filterJobsWithRunningStatus=Y");
      filterExprs.add(EntityCondition.makeCondition("statusId","SERVICE_RUNNING"));
      result.put("filterJobsWithRunningStatus",filterJobRunning);
    }
    if ("Y".equals(filterJobFinished)) {
      paramList.add("filterJobsWithFinishedStatus=Y");
      filterExprs.add(EntityCondition.makeCondition("statusId","SERVICE_FINISHED"));
      result.put("filterJobsWithFinishedStatus",filterJobFinished);
    }
    if (filterExprs.size() > 0) {
      conditions.add(EntityCondition.makeCondition(filterExprs,EntityOperator.OR));
    }
    EntityFindOptions findOpts=new EntityFindOptions(true,EntityFindOptions.TYPE_SCROLL_INSENSITIVE,EntityFindOptions.CONCUR_READ_ONLY,true);
    List orderBy=UtilMisc.toList("-runTime");
    EntityCondition cond=null;
    if (conditions.size() > 0) {
      cond=EntityCondition.makeCondition(conditions);
    }
    if (cond != null || "Y".equals(showAll)) {
      try {
        eli=delegator.find("JobSandbox",cond,null,null,orderBy,findOpts);
        lowIndex=viewIndex * viewSize + 1;
        highIndex=(viewIndex + 1) * viewSize;
        jobList=eli.getPartialList(lowIndex,viewSize);
        eli.last();
        jobListSize=eli.currentIndex();
        if (highIndex > jobListSize) {
          highIndex=jobListSize;
        }
        eli.close();
      }
 catch (      GenericEntityException e) {
        String errMsg="Failure in job find operation, rolling back transaction: " + e.toString();
        Debug.logError(e,errMsg,module);
        return ServiceUtil.returnError(errMsg);
      }
    }
 else {
      jobListSize=0;
    }
  }
  if (jobList == null)   jobList=FastList.newInstance();
  String paramString=StringUtil.join(paramList,"&amp;");
  result.put("paramList",(paramString != null ? paramString : ""));
  result.put("lowIndex",Integer.valueOf(lowIndex));
  result.put("highIndex",Integer.valueOf(highIndex));
  result.put("jobs",jobList);
  result.put("jobListSize",Integer.valueOf(jobListSize));
  return result;
}
