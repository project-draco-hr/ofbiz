{
  ModelService model;
  try {
    model=dispatcher.getDispatchContext().getModelService(serviceName);
  }
 catch (  GenericServiceException e) {
    throw new XmlRpcException(e.getMessage(),e);
  }
  Map context=FastMap.newInstance();
  if (model != null) {
    int parameterCount=xmlRpcReq.getParameterCount();
    if (parameterCount > 1) {
      int x=0;
      Iterator i=model.getParameterNames("IN",true,true).iterator();
      while (i.hasNext()) {
        String name=(String)i.next();
        context.put(name,xmlRpcReq.getParameter(x));
        x++;
        if (x == parameterCount) {
          break;
        }
      }
    }
 else     if (parameterCount == 1) {
      Object param=xmlRpcReq.getParameter(0);
      if (param instanceof Map) {
        context=(Map)param;
      }
 else {
        if (model.getDefinedInCount() == 1) {
          String paramName=(String)model.getInParamNames().iterator().next();
          context.put(paramName,xmlRpcReq.getParameter(0));
        }
 else {
          throw new XmlRpcException("More than one parameter defined on service; cannot call via RPC with parameter list");
        }
      }
    }
    context=model.makeValid(context,ModelService.IN_PARAM);
  }
  return context;
}
