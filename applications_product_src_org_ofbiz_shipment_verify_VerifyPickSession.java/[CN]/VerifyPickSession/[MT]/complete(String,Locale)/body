{
  this.checkVerifiedQty(orderId,locale);
  this.checkReservedQty(orderId,locale);
  String shipmentId=this.createShipment((this.getPickRows(orderId)).get(0));
  this.issueItemsToShipment(shipmentId,locale);
  this.updateProduct();
  List<GenericValue> picklistItems=this.getDelegator().findByAnd("PicklistItem",UtilMisc.toMap("orderId",orderId));
  for (  GenericValue item : picklistItems) {
    Map<String,Object> setPicklistItemToCompleteCtx=FastMap.newInstance();
    setPicklistItemToCompleteCtx.put("picklistBinId",item.get("picklistBinId"));
    setPicklistItemToCompleteCtx.put("orderId",orderId);
    setPicklistItemToCompleteCtx.put("orderItemSeqId",item.get("orderItemSeqId"));
    setPicklistItemToCompleteCtx.put("shipGroupSeqId",item.get("shipGroupSeqId"));
    setPicklistItemToCompleteCtx.put("inventoryItemId",item.get("inventoryItemId"));
    setPicklistItemToCompleteCtx.put("quantity",item.get("quantity"));
    setPicklistItemToCompleteCtx.put("itemStatusId","PICKITEM_COMPLETED");
    setPicklistItemToCompleteCtx.put("userLogin",this.getUserLogin());
    this.getDispatcher().runSync("setPicklistItemToComplete",setPicklistItemToCompleteCtx);
  }
  Map<String,Object> updateShipmentCtx=FastMap.newInstance();
  updateShipmentCtx.put("shipmentId",shipmentId);
  updateShipmentCtx.put("statusId","SHIPMENT_PICKED");
  updateShipmentCtx.put("userLogin",this.getUserLogin());
  this.getDispatcher().runSync("updateShipment",updateShipmentCtx);
  return shipmentId;
}
