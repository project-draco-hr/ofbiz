{
  Map createInvoiceContext=FastMap.newInstance();
  createInvoiceContext.put("partyId",(EntityUtil.getFirst(this.getDelegator().findByAnd("OrderRole",UtilMisc.toMap("orderId",orderId,"roleTypeId","BILL_TO_CUSTOMER")))).getString("partyId"));
  createInvoiceContext.put("partyIdFrom",(EntityUtil.getFirst(this.getDelegator().findByAnd("OrderRole",UtilMisc.toMap("orderId",orderId,"roleTypeId","BILL_FROM_VENDOR")))).getString("partyId"));
  createInvoiceContext.put("invoiceTypeId","SALES_INVOICE");
  createInvoiceContext.put("statusId","INVOICE_IN_PROCESS");
  createInvoiceContext.put("userLogin",this.getUserLogin());
  Map createInvoiceResult=this.getDispatcher().runSync("createInvoice",createInvoiceContext);
  if (ServiceUtil.isError(createInvoiceResult)) {
    throw new GeneralException(ServiceUtil.getErrorMessage(createInvoiceResult));
  }
  String invoiceId=(String)createInvoiceResult.get("invoiceId");
  return invoiceId;
}
