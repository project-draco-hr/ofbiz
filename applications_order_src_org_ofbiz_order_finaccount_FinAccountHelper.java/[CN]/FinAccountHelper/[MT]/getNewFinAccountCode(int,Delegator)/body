{
  Random r=new Random();
  boolean foundUniqueNewCode=false;
  StringBuilder newAccountCode=null;
  long count=0;
  while (!foundUniqueNewCode) {
    newAccountCode=new StringBuilder(codeLength);
    for (int i=0; i < codeLength; i++) {
      newAccountCode.append(char_pool[r.nextInt(char_pool.length)]);
    }
    List<GenericValue> existingAccountsWithCode=delegator.findByAnd("FinAccount",UtilMisc.toMap("finAccountCode",newAccountCode.toString()),null,false);
    if (existingAccountsWithCode.size() == 0) {
      foundUniqueNewCode=true;
    }
    count++;
    if (count > 999999) {
      throw new GenericEntityException("Unable to locate unique FinAccountCode! Length [" + codeLength + "]");
    }
  }
  return newAccountCode.toString();
}
