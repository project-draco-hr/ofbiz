{
  Random r=new Random();
  boolean foundUniqueNewCode=false;
  StringBuffer newAccountCode=null;
  long count=0;
  while (!foundUniqueNewCode) {
    newAccountCode=new StringBuffer(codeLength);
    for (int i=0; i < codeLength; i++) {
      newAccountCode.append(char_pool[r.nextInt(char_pool.length)]);
    }
    List existingAccountsWithCode=delegator.findByAnd("FinAccount",UtilMisc.toMap("finAccountCode",newAccountCode.toString()));
    if (existingAccountsWithCode.size() == 0) {
      foundUniqueNewCode=true;
    }
    count++;
    if (count > 999999) {
      throw new GenericEntityException("Unable to locate unique FinAccountCode! Length [" + codeLength + "]");
    }
  }
  return newAccountCode.toString();
}
