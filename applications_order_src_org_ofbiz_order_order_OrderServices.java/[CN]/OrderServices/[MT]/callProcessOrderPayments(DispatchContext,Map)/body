{
  LocalDispatcher dispatcher=dctx.getDispatcher();
  GenericDelegator delegator=dctx.getDelegator();
  ShoppingCart cart=(ShoppingCart)context.get("shoppingCart");
  GenericValue userLogin=cart.getUserLogin();
  Boolean manualHold=(Boolean)context.get("manualHold");
  if (manualHold == null) {
    manualHold=Boolean.FALSE;
  }
  String productStoreId=cart.getProductStoreId();
  GenericValue productStore=ProductStoreWorker.getProductStore(productStoreId,delegator);
  CheckOutHelper coh=new CheckOutHelper(dispatcher,delegator,cart);
  Map payResp;
  try {
    payResp=coh.processPayment(productStore,userLogin,false,manualHold.booleanValue());
  }
 catch (  GeneralException e) {
    Debug.logError(e,module);
    return ServiceUtil.returnError(e.getMessage());
  }
  if (ServiceUtil.isError(payResp)) {
    return ServiceUtil.returnError(ServiceUtil.getErrorMessage(payResp));
  }
  return ServiceUtil.returnSuccess();
}
