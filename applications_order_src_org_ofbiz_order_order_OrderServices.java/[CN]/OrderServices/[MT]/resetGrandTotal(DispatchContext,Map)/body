{
  GenericDelegator delegator=ctx.getDelegator();
  String orderId=(String)context.get("orderId");
  GenericValue orderHeader=null;
  try {
    orderHeader=delegator.findByPrimaryKey("OrderHeader",UtilMisc.toMap("orderId",orderId));
  }
 catch (  GenericEntityException e) {
    String errMsg="ERROR: Could not set grantTotal on OrderHeader entity: " + e.toString();
    Debug.logError(e,errMsg,module);
    return ServiceUtil.returnError(errMsg);
  }
  if (orderHeader != null) {
    OrderReadHelper orh=new OrderReadHelper(orderHeader);
    BigDecimal currentTotal=orderHeader.getBigDecimal("grandTotal");
    BigDecimal currentSubTotal=orderHeader.getBigDecimal("remainingSubTotal");
    BigDecimal updatedTotal=orh.getOrderGrandTotal();
    BigDecimal remainingSubTotal=updatedTotal.subtract(orh.getOrderReturnedTotalBd()).subtract(orh.getOrderNonReturnedTaxAndShippingBd());
    if (currentTotal == null || currentSubTotal == null || updatedTotal.compareTo(currentTotal) != 0 || remainingSubTotal.compareTo(currentSubTotal) != 0) {
      orderHeader.set("grandTotal",updatedTotal);
      orderHeader.set("remainingSubTotal",remainingSubTotal);
      try {
        orderHeader.store();
      }
 catch (      GenericEntityException e) {
        String errMsg="ERROR: Could not set grandTotal on OrderHeader entity: " + e.toString();
        Debug.logError(e,errMsg,module);
        return ServiceUtil.returnError(errMsg);
      }
    }
  }
  return ServiceUtil.returnSuccess();
}
