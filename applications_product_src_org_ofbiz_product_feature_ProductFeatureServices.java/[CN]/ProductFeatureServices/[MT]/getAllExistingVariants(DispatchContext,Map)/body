{
  Map results=new HashMap();
  GenericDelegator delegator=dctx.getDelegator();
  String productId=(String)context.get("productId");
  List curProductFeatureAndAppls=(List)context.get("productFeatureAppls");
  List existingVariantProductIds=new ArrayList();
  try {
    List productAssocs=EntityUtil.filterByDate(delegator.findByAnd("ProductAssoc",UtilMisc.toMap("productId",productId,"productAssocTypeId","PRODUCT_VARIANT")));
    Iterator productAssocIter=productAssocs.iterator();
    while (productAssocIter.hasNext()) {
      GenericEntity productAssoc=(GenericEntity)productAssocIter.next();
      boolean hasAllFeatures=true;
      Iterator curProductFeatureAndApplIter=curProductFeatureAndAppls.iterator();
      while (curProductFeatureAndApplIter.hasNext()) {
        String productFeatureAndAppl=(String)curProductFeatureAndApplIter.next();
        Map findByMap=UtilMisc.toMap("productId",productAssoc.getString("productIdTo"),"productFeatureId",productFeatureAndAppl,"productFeatureApplTypeId","STANDARD_FEATURE");
        List standardProductFeatureAndAppls=EntityUtil.filterByDate(delegator.findByAnd("ProductFeatureAppl",findByMap));
        if (UtilValidate.isEmpty(standardProductFeatureAndAppls)) {
          hasAllFeatures=false;
          break;
        }
 else {
        }
      }
      if (hasAllFeatures) {
        existingVariantProductIds.add(productAssoc.get("productIdTo"));
      }
    }
    results=ServiceUtil.returnSuccess();
    results.put("variantProductIds",existingVariantProductIds);
  }
 catch (  GenericEntityException ex) {
    Debug.logError(ex,ex.getMessage(),module);
    return ServiceUtil.returnError(ex.getMessage());
  }
  return results;
}
