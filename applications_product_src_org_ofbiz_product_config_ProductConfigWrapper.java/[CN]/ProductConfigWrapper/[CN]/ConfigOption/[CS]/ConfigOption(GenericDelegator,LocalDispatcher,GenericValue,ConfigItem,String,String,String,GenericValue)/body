{
  configOption=option;
  parentConfigItem=configItem;
  componentList=option.getRelated("ConfigOptionProductConfigProduct");
  Iterator componentsIt=componentList.iterator();
  while (componentsIt.hasNext()) {
    double price=0;
    GenericValue oneComponent=(GenericValue)componentsIt.next();
    Map fieldMap=UtilMisc.toMap("product",oneComponent.getRelatedOne("ProductProduct"),"prodCatalogId",catalogId,"webSiteId",webSiteId,"currencyUomId",currencyUomId,"productPricePurposeId","COMPONENT_PRICE","autoUserLogin",autoUserLogin);
    Map priceMap=dispatcher.runSync("calculateProductPrice",fieldMap);
    Double componentPrice=(Double)priceMap.get("price");
    Boolean validPriceFound=(Boolean)priceMap.get("validPriceFound");
    double mult=1;
    if (oneComponent.getDouble("quantity") != null) {
      mult=oneComponent.getDouble("quantity").doubleValue();
    }
    if (mult == 0) {
      mult=1;
    }
    if (componentPrice != null && validPriceFound.booleanValue()) {
      price=componentPrice.doubleValue();
    }
 else {
      fieldMap.put("productPricePurposeId","PURCHASE");
      Map purchasePriceResultMap=dispatcher.runSync("calculateProductPrice",fieldMap);
      Double purchasePrice=(Double)purchasePriceResultMap.get("price");
      if (purchasePrice != null) {
        price=purchasePrice.doubleValue();
      }
    }
    optionPrice+=(price * mult);
  }
}
