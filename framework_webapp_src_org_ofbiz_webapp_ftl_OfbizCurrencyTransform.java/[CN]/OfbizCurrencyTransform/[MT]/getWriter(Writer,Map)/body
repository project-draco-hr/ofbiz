{
  final StringBuffer buf=new StringBuffer();
  final Double amount=OfbizCurrencyTransform.getAmount(args,"amount");
  final String isoCode=OfbizCurrencyTransform.getArg(args,"isoCode");
  final String locale=OfbizCurrencyTransform.getArg(args,"locale");
  int roundingNumber=getInteger(args,"rounding");
  if (roundingNumber == 0)   roundingNumber=10;
  final int rounding=roundingNumber;
  return new Writer(out){
    public void write(    char cbuf[],    int off,    int len){
      buf.append(cbuf,off,len);
    }
    public void flush() throws IOException {
      out.flush();
    }
    public void close() throws IOException {
      try {
        if (Debug.verboseOn())         Debug.logVerbose("parms: " + amount + " "+ isoCode+ " "+ locale,module);
        if (locale.length() < 1) {
          Environment env=Environment.getCurrentEnvironment();
          BeanModel req=(BeanModel)env.getVariable("request");
          if (req != null) {
            HttpServletRequest request=(HttpServletRequest)req.getWrappedObject();
            out.write(UtilFormatOut.formatCurrency(amount,isoCode,UtilHttp.getLocale(request),rounding));
          }
 else {
            out.write(UtilFormatOut.formatCurrency(amount,isoCode,env.getLocale(),rounding));
          }
        }
 else {
          out.write(UtilFormatOut.formatCurrency(amount.doubleValue(),isoCode,new Locale(locale),rounding));
        }
      }
 catch (      TemplateModelException e) {
        throw new IOException(e.getMessage());
      }
    }
  }
;
}
