{
  Double billingAccountAmt=null;
  if (UtilValidate.isNotEmpty(billingAccountId)) {
    if (UtilValidate.isNotEmpty(billingAccountAmount)) {
      String currencyFormat=UtilProperties.getPropertyValue("general.properties","currency.decimal.format","##0.00");
      DecimalFormat formatter=new DecimalFormat(currencyFormat);
      try {
        billingAccountAmt=new Double(formatter.parse(billingAccountAmount).doubleValue());
      }
 catch (      ParseException e) {
        return null;
      }
    }
    if (billingAccountAmt == null) {
      billingAccountAmt=new Double(0.0);
    }
    double availableBalance=CheckOutHelper.availableAccountBalance(billingAccountId,dispatcher);
    double chargeAmount=0;
    if (billingAccountAmt.doubleValue() < availableBalance) {
      chargeAmount=billingAccountAmt.doubleValue();
    }
 else {
      chargeAmount=availableBalance;
    }
    if (chargeAmount < 0.0) {
      chargeAmount=0.0;
    }
    return new Double(chargeAmount);
  }
 else {
    return null;
  }
}
