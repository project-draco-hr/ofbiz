{
  Delegator delegator=(Delegator)request.getAttribute("delegator");
  ShoppingCart cart=ShoppingCartEvents.getCartObject(request);
  GenericValue productStore=ProductStoreWorker.getProductStore(cart.getProductStoreId(),delegator);
  String paymentMethodTypeId=request.getParameter("paymentMethodTypeId");
  if ("EXT_PAYPAL".equals(paymentMethodTypeId) || cart.getPaymentMethodTypeIds().contains("EXT_PAYPAL")) {
    List<GenericValue> payPalProdStorePaySettings=null;
    try {
      payPalProdStorePaySettings=delegator.findByAnd("ProductStorePaymentSetting",UtilMisc.toMap("productStoreId",productStore.getString("productStoreId"),"paymentMethodTypeId","EXT_PAYPAL"),null,false);
      GenericValue payPalProdStorePaySetting=EntityUtil.getFirst(payPalProdStorePaySettings);
      if (payPalProdStorePaySetting != null) {
        GenericValue gatewayConfig=payPalProdStorePaySetting.getRelatedOne("PaymentGatewayConfig",false);
        if (gatewayConfig != null && "PAYFLOWPRO".equals(gatewayConfig.getString("paymentGatewayConfigTypeId"))) {
          return "paypal";
        }
      }
    }
 catch (    GenericEntityException e) {
      Debug.logError(e,module);
    }
  }
  return "success";
}
