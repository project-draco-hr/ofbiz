{
  ShoppingCart cart=(ShoppingCart)request.getSession().getAttribute("shoppingCart");
  String billingAccountId=request.getParameter("billingAccountId");
  String billingAcctAmtStr=request.getParameter("amount_" + billingAccountId);
  Double billingAccountAmt=null;
  if (billingAcctAmtStr != null) {
    try {
      billingAccountAmt=new Double(formatter.parse(billingAcctAmtStr).doubleValue());
    }
 catch (    ParseException e) {
      return null;
    }
  }
  if ((cart != null) && (billingAccountId != null) && !"_NA_".equals(billingAccountId)) {
    double availableBalance=checkOutHelper.availableAccountBalance(billingAccountId);
    double chargeAmount=0;
    if ((billingAccountAmt != null) && (billingAccountAmt.doubleValue() < availableBalance)) {
      chargeAmount=billingAccountAmt.doubleValue();
    }
 else {
      chargeAmount=availableBalance;
    }
    return new Double(chargeAmount);
  }
 else {
    return null;
  }
}
