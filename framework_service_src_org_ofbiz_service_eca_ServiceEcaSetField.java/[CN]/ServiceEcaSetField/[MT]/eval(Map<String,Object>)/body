{
  if (fieldName != null) {
    if (UtilValidate.isEmpty(value)) {
      if (UtilValidate.isNotEmpty(envName) && envName.startsWith("${")) {
        FlexibleStringExpander exp=FlexibleStringExpander.getInstance(envName);
        String s=exp.expandString(context);
        if (UtilValidate.isNotEmpty(s)) {
          value=s;
        }
        Debug.log("Expanded String: " + s,module);
      }
    }
    if (UtilValidate.isNotEmpty(this.mapName) && context.containsKey(this.mapName)) {
      map=(Map<String,Object>)context.get(mapName);
    }
 else {
      map=FastMap.newInstance();
    }
    String newValue=null;
    if (UtilValidate.isNotEmpty(this.value)) {
      newValue=(String)this.format(this.value,context);
    }
 else     if (UtilValidate.isNotEmpty(envName) && context.get(this.envName) != null) {
      newValue=(String)this.format((String)context.get(this.envName),context);
    }
    if (newValue != null) {
      if (UtilValidate.isNotEmpty(this.mapName)) {
        this.map.put(this.fieldName,newValue);
        context.put(this.mapName,this.map);
      }
 else {
        context.put(this.fieldName,newValue);
      }
    }
  }
}
