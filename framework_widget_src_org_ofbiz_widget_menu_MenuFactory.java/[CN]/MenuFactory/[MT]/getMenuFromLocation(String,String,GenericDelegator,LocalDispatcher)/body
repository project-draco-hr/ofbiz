{
  Map modelMenuMap=(Map)menuLocationCache.get(resourceName);
  if (modelMenuMap == null) {
synchronized (MenuFactory.class) {
      modelMenuMap=(Map)menuLocationCache.get(resourceName);
      if (modelMenuMap == null) {
        ClassLoader loader=Thread.currentThread().getContextClassLoader();
        if (loader == null) {
          loader=MenuFactory.class.getClassLoader();
        }
        URL menuFileUrl=null;
        menuFileUrl=FlexibleLocation.resolveLocation(resourceName);
        Document menuFileDoc=UtilXml.readXmlDocument(menuFileUrl,true);
        modelMenuMap=readMenuDocument(menuFileDoc,delegator,dispatcher);
        menuLocationCache.put(resourceName,modelMenuMap);
      }
    }
  }
  if (UtilValidate.isEmpty(modelMenuMap)) {
    throw new IllegalArgumentException("Could not find menu file in location [" + resourceName + "]");
  }
  ModelMenu modelMenu=(ModelMenu)modelMenuMap.get(menuName);
  if (modelMenu == null) {
    throw new IllegalArgumentException("Could not find menu with name [" + menuName + "] in location ["+ resourceName+ "]");
  }
  return modelMenu;
}
