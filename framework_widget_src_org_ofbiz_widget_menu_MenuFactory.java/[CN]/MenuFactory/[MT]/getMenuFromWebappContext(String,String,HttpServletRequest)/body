{
  String webappName=UtilHttp.getApplicationName(request);
  String cacheKey=webappName + "::" + resourceName;
  Map<String,ModelMenu> modelMenuMap=menuWebappCache.get(cacheKey);
  if (modelMenuMap == null) {
synchronized (MenuFactory.class) {
      modelMenuMap=menuWebappCache.get(cacheKey);
      if (modelMenuMap == null) {
        ServletContext servletContext=(ServletContext)request.getAttribute("servletContext");
        GenericDelegator delegator=(GenericDelegator)request.getAttribute("delegator");
        LocalDispatcher dispatcher=(LocalDispatcher)request.getAttribute("dispatcher");
        URL menuFileUrl=servletContext.getResource(resourceName);
        Document menuFileDoc=UtilXml.readXmlDocument(menuFileUrl,true);
        modelMenuMap=readMenuDocument(menuFileDoc,delegator,dispatcher,cacheKey);
        menuWebappCache.put(cacheKey,modelMenuMap);
      }
    }
  }
  if (UtilValidate.isEmpty(modelMenuMap)) {
    throw new IllegalArgumentException("Could not find menu file in webapp resource [" + resourceName + "] in the webapp ["+ webappName+ "]");
  }
  ModelMenu modelMenu=(ModelMenu)modelMenuMap.get(menuName);
  if (modelMenu == null) {
    throw new IllegalArgumentException("Could not find menu with name [" + menuName + "] in webapp resource ["+ resourceName+ "] in the webapp ["+ webappName+ "]");
  }
  return modelMenu;
}
