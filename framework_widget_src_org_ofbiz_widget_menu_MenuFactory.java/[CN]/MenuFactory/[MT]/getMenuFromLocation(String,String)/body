{
  Map<String,ModelMenu> modelMenuMap=menuLocationCache.get(resourceName);
  if (modelMenuMap == null) {
synchronized (MenuFactory.class) {
      modelMenuMap=menuLocationCache.get(resourceName);
      if (modelMenuMap == null) {
        ClassLoader loader=Thread.currentThread().getContextClassLoader();
        if (loader == null) {
          loader=MenuFactory.class.getClassLoader();
        }
        URL menuFileUrl=null;
        menuFileUrl=FlexibleLocation.resolveLocation(resourceName);
        Document menuFileDoc=UtilXml.readXmlDocument(menuFileUrl,true,true);
        modelMenuMap=readMenuDocument(menuFileDoc,resourceName);
        menuLocationCache.put(resourceName,modelMenuMap);
      }
    }
  }
  if (UtilValidate.isEmpty(modelMenuMap)) {
    throw new IllegalArgumentException("Could not find menu file in location [" + resourceName + "]");
  }
  ModelMenu modelMenu=modelMenuMap.get(menuName);
  if (modelMenu == null) {
    throw new IllegalArgumentException("Could not find menu with name [" + menuName + "] in location ["+ resourceName+ "]");
  }
  return modelMenu;
}
