{
  Map modelMenuMap=(Map)menuClassCache.get(resourceName);
  if (modelMenuMap == null) {
synchronized (MenuFactory.class) {
      modelMenuMap=(Map)menuClassCache.get(resourceName);
      if (modelMenuMap == null) {
        ClassLoader loader=Thread.currentThread().getContextClassLoader();
        if (loader == null) {
          loader=MenuFactory.class.getClassLoader();
        }
        URL menuFileUrl=loader.getResource(resourceName);
        Document menuFileDoc=UtilXml.readXmlDocument(menuFileUrl,true);
        modelMenuMap=readMenuDocument(menuFileDoc,delegator,dispatcher);
        menuClassCache.put(resourceName,modelMenuMap);
      }
    }
  }
  ModelMenu modelMenu=(ModelMenu)modelMenuMap.get(menuName);
  if (modelMenu == null) {
    throw new IllegalArgumentException("Could not find menu with name [" + menuName + "] in class resource ["+ resourceName+ "]");
  }
  return modelMenu;
}
