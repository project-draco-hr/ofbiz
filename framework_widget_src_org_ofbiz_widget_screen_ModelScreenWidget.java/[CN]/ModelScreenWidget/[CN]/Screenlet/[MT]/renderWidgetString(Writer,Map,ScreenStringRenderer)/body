{
  boolean collapsed=initiallyCollapsed;
  if (this.collapsible) {
    String preferenceKey=getPreferenceKey(context) + "_collapsed";
    Map requestParameters=(Map)context.get("requestParameters");
    if (requestParameters != null) {
      String collapsedParam=(String)requestParameters.get(preferenceKey);
      if (UtilValidate.isNotEmpty(collapsedParam)) {
        collapsed="true".equals(collapsedParam);
      }
    }
  }
  try {
    screenStringRenderer.renderScreenletBegin(writer,context,collapsed,this);
    if (!collapsed) {
      for (      ModelScreenWidget subWidget : this.subWidgets) {
        screenStringRenderer.renderScreenletSubWidget(writer,context,subWidget,this);
      }
    }
    screenStringRenderer.renderScreenletEnd(writer,context,this);
  }
 catch (  IOException e) {
    String errMsg="Error rendering screenlet in screen named [" + this.modelScreen.getName() + "]: ";
    Debug.logError(e,errMsg,module);
    throw new RuntimeException(errMsg + e);
  }
}
