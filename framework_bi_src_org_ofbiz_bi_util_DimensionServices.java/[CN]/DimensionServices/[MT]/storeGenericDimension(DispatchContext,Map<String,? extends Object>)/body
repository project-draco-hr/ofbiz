{
  Delegator delegator=ctx.getDelegator();
  GenericValue dimensionValue=(GenericValue)context.get("dimensionValue");
  List<String> naturalKeyFields=UtilGenerics.checkList(context.get("naturalKeyFields"),String.class);
  String updateMode=(String)context.get("updateMode");
  try {
    Map<String,Object> andCondition=FastMap.newInstance();
    for (    String naturalKeyField : naturalKeyFields) {
      andCondition.put(naturalKeyField,dimensionValue.get(naturalKeyField));
    }
    if (andCondition.isEmpty()) {
      return ServiceUtil.returnError("The natural key: " + naturalKeyFields + " is empty in value: "+ dimensionValue);
    }
    List<GenericValue> existingDimensionValues=null;
    try {
      existingDimensionValues=delegator.findByAnd(dimensionValue.getEntityName(),andCondition);
    }
 catch (    GenericEntityException gee) {
      return ServiceUtil.returnError(gee.getMessage());
    }
    if (UtilValidate.isEmpty(existingDimensionValues)) {
      dimensionValue.set("dimensionId",delegator.getNextSeqId(dimensionValue.getEntityName()));
      dimensionValue.create();
    }
 else {
      if ("TYPE1".equals(updateMode)) {
        for (        GenericValue existingDimensionValue : existingDimensionValues) {
          GenericValue updatedValue=delegator.makeValue(dimensionValue.getEntityName(),dimensionValue);
          updatedValue.set("dimensionId",existingDimensionValue.getString("dimensionId"));
          updatedValue.store();
        }
      }
 else       if ("TYPE2".equals(updateMode)) {
        dimensionValue.set("dimensionId",delegator.getNextSeqId(dimensionValue.getEntityName()));
        dimensionValue.create();
      }
 else {
        return ServiceUtil.returnError("The update mode: " + updateMode + " is still not supported.");
      }
    }
  }
 catch (  GenericEntityException gee) {
    return ServiceUtil.returnError(gee.getMessage());
  }
  return ServiceUtil.returnSuccess();
}
