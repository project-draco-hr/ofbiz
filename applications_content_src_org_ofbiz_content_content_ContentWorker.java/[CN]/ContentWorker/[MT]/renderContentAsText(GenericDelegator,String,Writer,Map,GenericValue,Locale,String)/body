{
  Map results=new HashMap();
  GenericValue content=null;
  if (view == null) {
    if (contentId == null) {
      throw new IOException("ContentId is null");
    }
    try {
      List lst=delegator.findByAnd("SubContentDataResourceView",UtilMisc.toMap("contentId",contentId));
      if (lst != null && lst.size() > 0) {
        view=(GenericValue)lst.get(0);
      }
 else {
        throw new IOException("SubContentDataResourceView not found in renderSubContentAsText" + " for contentId=" + contentId);
      }
    }
 catch (    GenericEntityException e) {
      throw new IOException(e.getMessage());
    }
  }
  if (view != null) {
    Map contentMap=new HashMap();
    try {
      SimpleMapProcessor.runSimpleMapProcessor("org/ofbiz/content/ContentManagementMapProcessors.xml","contentIn",view,contentMap,new ArrayList(),locale);
    }
 catch (    MiniLangException e) {
      throw new IOException(e.getMessage());
    }
    content=delegator.makeValue("Content",contentMap);
  }
  results.put("view",view);
  results.put("content",content);
  if (locale != null) {
    String targetLocaleString=locale.toString();
    String thisLocaleString=(String)view.get("localeString");
    thisLocaleString=(thisLocaleString != null) ? thisLocaleString : "";
    if (targetLocaleString != null && !targetLocaleString.equalsIgnoreCase(thisLocaleString)) {
      view=findAlternateLocaleContent(delegator,view,locale);
    }
  }
  String dataResourceId=null;
  try {
    dataResourceId=(String)view.get("drDataResourceId");
  }
 catch (  Exception e) {
    dataResourceId=(String)view.get("dataResourceId");
  }
  if (templateContext == null) {
    templateContext=new HashMap();
  }
  if (UtilValidate.isNotEmpty(dataResourceId) || view != null)   DataResourceWorker.renderDataResourceAsText(delegator,dataResourceId,out,templateContext,view,locale,mimeTypeId);
  return results;
}
