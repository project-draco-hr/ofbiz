{
  InputStream in;
  try {
    in=request.getInputStream();
  }
 catch (  IOException e) {
    throw new EventHandlerException(e.getMessage(),e);
  }
  OutputStream out;
  try {
    out=response.getOutputStream();
  }
 catch (  IOException e) {
    throw new EventHandlerException(e.getMessage(),e);
  }
  Map<String,Object> context=new HashMap<String,Object>();
  context.put("inputStream",in);
  context.put("outputStream",out);
  if (Debug.infoOn())   Debug.logInfo("Running service with context: " + context,module);
  Map<String,Object> resp;
  try {
    resp=dispatcher.runSync(event.invoke,context);
  }
 catch (  GenericServiceException e) {
    outputError(out,e,"Exception thrown in runSync()");
    throw new EventHandlerException(e.getMessage(),e);
  }
  Debug.logInfo("Received respone: " + resp,module);
  if (ServiceUtil.isError(resp)) {
    outputError(out,null,ServiceUtil.getErrorMessage(resp));
    throw new EventHandlerException(ServiceUtil.getErrorMessage(resp));
  }
  String contentType=(String)resp.get("contentType");
  if (contentType != null) {
    response.setContentType(contentType);
  }
  if (out != null) {
    try {
      out.close();
    }
 catch (    IOException e) {
      throw new EventHandlerException(ServiceUtil.getErrorMessage(resp));
    }
  }
  return null;
}
