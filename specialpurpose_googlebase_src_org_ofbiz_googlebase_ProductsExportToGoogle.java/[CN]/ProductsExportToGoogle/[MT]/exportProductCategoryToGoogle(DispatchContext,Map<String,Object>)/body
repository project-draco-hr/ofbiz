{
  LocalDispatcher dispatcher=dctx.getDispatcher();
  Locale locale=(Locale)context.get("locale");
  String productCategoryId=(String)context.get("productCategoryId");
  String actionType=(String)context.get("actionType");
  String webSiteUrl=(String)context.get("webSiteUrl");
  String imageUrl=(String)context.get("imageUrl");
  GenericValue userLogin=(GenericValue)context.get("userLogin");
  if (userLogin == null) {
    return ServiceUtil.returnFailure(UtilProperties.getMessage(resource,"productsExportToGoogle.cannotRetrieveUserLogin",locale));
  }
  try {
    if (UtilValidate.isNotEmpty(productCategoryId)) {
      List<String> productsList=FastList.newInstance();
      Map<String,Object> result=dispatcher.runSync("getProductCategoryMembers",UtilMisc.toMap("categoryId",productCategoryId));
      if (result.get("categoryMembers") != null) {
        List<GenericValue> productCategoryMembers=UtilGenerics.checkList(result.get("categoryMembers"),GenericValue.class);
        if (productCategoryMembers != null) {
          for (          GenericValue prodCatMemb : productCategoryMembers) {
            if (prodCatMemb != null) {
              String productId=prodCatMemb.getString("productId");
              if (productId != null) {
                GenericValue prod=prodCatMemb.getRelatedOne("Product",false);
                Timestamp salesDiscontinuationDate=prod.getTimestamp("salesDiscontinuationDate");
                if (salesDiscontinuationDate == null) {
                  productsList.add(productId);
                }
              }
            }
          }
        }
      }
      if (productsList.size() == 0) {
        return ServiceUtil.returnFailure(UtilProperties.getMessage(resource,"productsExportToGoogle.noProductsAvailableInProductCategory",locale));
      }
 else {
        Map<String,Object> paramIn=FastMap.newInstance();
        paramIn.put("selectResult",productsList);
        paramIn.put("webSiteUrl",webSiteUrl);
        paramIn.put("imageUrl",imageUrl);
        paramIn.put("actionType",actionType);
        paramIn.put("statusId","publish");
        paramIn.put("testMode","N");
        paramIn.put("userLogin",userLogin);
        result=dispatcher.runSync("exportToGoogle",paramIn);
        if (ServiceUtil.isError(result)) {
          return ServiceUtil.returnFailure(ServiceUtil.getErrorMessage(result));
        }
      }
    }
 else {
      return ServiceUtil.returnFailure(UtilProperties.getMessage(resource,"productsExportToGoogle.missingParameterProductCategoryId",locale));
    }
  }
 catch (  Exception e) {
    return ServiceUtil.returnFailure(UtilProperties.getMessage(resource,"productsExportToGoogle.exceptionInExportProductCategoryToGoogle",locale));
  }
  return ServiceUtil.returnSuccess();
}
