{
  Delegator delegator=dctx.getDelegator();
  Map<String,Object> context=UtilMisc.makeMapWritable(rcontext);
  Map results=FastMap.newInstance();
  Locale locale=(Locale)context.get("locale");
  Set visitedSet=(Set)context.get("visitedSet");
  if (visitedSet == null) {
    visitedSet=FastSet.newInstance();
    context.put("visitedSet",visitedSet);
  }
  String pageMode=(String)context.get("pageMode");
  String contentId=(String)context.get("contentId");
  visitedSet.add(contentId);
  String contentTypeId="PAGE_NODE";
  if (pageMode != null && pageMode.toLowerCase().indexOf("outline") >= 0)   contentTypeId="OUTLINE_NODE";
  GenericValue thisContent=null;
  try {
    thisContent=delegator.findByPrimaryKey("Content",UtilMisc.toMap("contentId",contentId));
    if (thisContent == null) {
      return ServiceUtil.returnError(UtilProperties.getMessage(resource,"ContentNoContentFound",UtilMisc.toMap("contentId",contentId),locale));
    }
    thisContent.set("contentTypeId",contentTypeId);
    thisContent.store();
    List kids=ContentWorker.getAssociatedContent(thisContent,"from",UtilMisc.toList("SUB_CONTENT"),null,null,null);
    Iterator iter=kids.iterator();
    while (iter.hasNext()) {
      GenericValue kidContent=(GenericValue)iter.next();
      if (contentTypeId.equals("OUTLINE_NODE")) {
        updateOutlineNodeChildren(kidContent,false,context);
      }
 else {
        updatePageNodeChildren(kidContent,context);
      }
    }
  }
 catch (  GenericEntityException e) {
    Debug.logError(e,module);
    return ServiceUtil.returnError(e.toString());
  }
  return results;
}
