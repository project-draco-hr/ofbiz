{
  Map result=new HashMap();
  GenericDelegator delegator=dctx.getDelegator();
  LocalDispatcher dispatcher=dctx.getDispatcher();
  String orderId=(String)context.get("orderId");
  Debug.logInfo("In updateSubscriptionByOrder service with orderId: " + orderId,module);
  GenericValue orderHeader=null;
  try {
    List orderRoleList=delegator.findByAnd("OrderRole",UtilMisc.toMap("orderId",orderId,"roleTypeId","END_USER_CUSTOMER"));
    if (orderRoleList.size() > 0) {
      GenericValue orderRole=(GenericValue)orderRoleList.get(0);
      String partyId=(String)orderRole.get("partyId");
      context.put("partyId",partyId);
    }
 else {
      String msg="No OrderRole found for orderId:" + orderId;
      Debug.logError(msg,module);
      return ServiceUtil.returnError(msg);
    }
    orderHeader=delegator.findByPrimaryKeyCache("OrderHeader",UtilMisc.toMap("orderId",orderId));
    if (orderHeader == null) {
      String msg="No OrderHeader found for orderId:" + orderId;
      Debug.logError(msg,module);
      return ServiceUtil.returnError(msg);
    }
    Timestamp orderCreatedDate=(Timestamp)orderHeader.get("orderDate");
    context.put("orderCreatedDate",orderCreatedDate);
    List orderItemList=orderHeader.getRelated("OrderItem");
    Iterator orderItemIter=orderItemList.iterator();
    ModelService subscriptionModel=dispatcher.getDispatchContext().getModelService("updateSubscriptionByProduct");
    while (orderItemIter.hasNext()) {
      GenericValue orderItem=(GenericValue)orderItemIter.next();
      Double qty=(Double)orderItem.get("quantity");
      String productId=(String)orderItem.get("productId");
      List productContentList=delegator.findByAnd("ProductContent",UtilMisc.toMap("productId",productId,"productContentTypeId","ONLINE_ACCESS"));
      List productContentListFiltered=EntityUtil.filterByDate(productContentList);
      if (productContentListFiltered.size() > 0) {
        context.put("productId",productId);
        context.put("quantity",new Integer(qty.intValue()));
        Map ctx=subscriptionModel.makeValid(context,"IN");
        Map thisResult=dispatcher.runSync("updateSubscriptionByProduct",ctx);
      }
    }
  }
 catch (  GenericEntityException e) {
    Debug.logError(e.getMessage(),module);
    return ServiceUtil.returnError(e.getMessage());
  }
  return result;
}
