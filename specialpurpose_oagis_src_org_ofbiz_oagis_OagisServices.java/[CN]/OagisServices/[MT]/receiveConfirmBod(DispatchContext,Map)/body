{
  GenericDelegator delegator=ctx.getDelegator();
  LocalDispatcher dispatcher=ctx.getDispatcher();
  InputStream in=(InputStream)context.get("inputStream");
  FastList errorList=FastList.newInstance();
  GenericValue userLogin=null;
  try {
    userLogin=delegator.findByPrimaryKey("UserLogin",UtilMisc.toMap("userLoginId","admin"));
  }
 catch (  GenericEntityException e) {
    String errMsg="Error Getting UserLogin with userLoginId 'admin'";
    Debug.logError(e,errMsg,module);
  }
  Document doc=null;
  try {
    doc=UtilXml.readXmlDocument(in,true,"RecieveConfirmBod");
  }
 catch (  SAXException e) {
    String errMsg="Error parsing the ConfirmBodResponse";
    errorList.add(errMsg);
    Debug.logError(e,errMsg,module);
  }
catch (  ParserConfigurationException e) {
    String errMsg="Error parsing the ConfirmBodResponse";
    errorList.add(errMsg);
    Debug.logError(e,errMsg,module);
  }
catch (  IOException e) {
    String errMsg="Error parsing the ConfirmBodResponse";
    errorList.add(errMsg);
    Debug.logError(e,errMsg,module);
  }
  Element confirmBodElement=doc.getDocumentElement();
  confirmBodElement.normalize();
  Element docCtrlAreaElement=UtilXml.firstChildElement(confirmBodElement,"N1:CNTROLAREA");
  Element bsrElement=UtilXml.firstChildElement(docCtrlAreaElement,"N1:BSR");
  String bsrVerb=UtilXml.childElementValue(bsrElement,"N2:VERB");
  String bsrNoun=UtilXml.childElementValue(bsrElement,"N2:NOUN");
  String bsrRevision=UtilXml.childElementValue(bsrElement,"N2:REVISION");
  Element docSenderElement=UtilXml.firstChildElement(docCtrlAreaElement,"N1:SENDER");
  String logicalId=UtilXml.childElementValue(docSenderElement,"N2:LOGICALID");
  String component=UtilXml.childElementValue(docSenderElement,"N2:COMPONENT");
  String task=UtilXml.childElementValue(docSenderElement,"N2:TASK");
  String referenceId=UtilXml.childElementValue(docSenderElement,"N2:REFERENCEID");
  String confirmation=UtilXml.childElementValue(docSenderElement,"N2:CONFIRMATION");
  String language=UtilXml.childElementValue(docSenderElement,"N2:LANGUAGE");
  String codepage=UtilXml.childElementValue(docSenderElement,"N2:CODEPAGE");
  String authId=UtilXml.childElementValue(docSenderElement,"N2:AUTHID");
  String sentDate=UtilXml.childElementValue(docCtrlAreaElement,"N1:DATETIMEANY");
  Element dataAreaElement=UtilXml.firstChildElement(confirmBodElement,"n:DATAAREA");
  Element dataAreaConfirmBodElement=UtilXml.firstChildElement(dataAreaElement,"n:CONFIRM_BOD");
  Element dataAreaConfirmElement=UtilXml.firstChildElement(dataAreaConfirmBodElement,"n:CONFIRM");
  Element dataAreaCtrlElement=UtilXml.firstChildElement(dataAreaConfirmElement,"N1:CNTROLAREA");
  Element dataAreaSenderElement=UtilXml.firstChildElement(dataAreaCtrlElement,"N1:SENDER");
  String dataAreaLogicalId=UtilXml.childElementValue(dataAreaSenderElement,"N2:LOGICALID");
  String dataAreaComponent=UtilXml.childElementValue(dataAreaSenderElement,"N2:COMPONENT");
  String dataAreaTask=UtilXml.childElementValue(dataAreaSenderElement,"N2:TASK");
  String dataAreaReferenceId=UtilXml.childElementValue(dataAreaSenderElement,"N2:REFERENCEID");
  String dataAreaDate=UtilXml.childElementValue(dataAreaCtrlElement,"N1:DATETIMEANY");
  String origRef=UtilXml.childElementValue(dataAreaConfirmElement,"N2:ORIGREF");
  Element dataAreaConfirmMsgElement=UtilXml.firstChildElement(dataAreaConfirmElement,"n:CONFIRMMSG");
  String description=UtilXml.childElementValue(dataAreaConfirmMsgElement,"N2:DESCRIPTN");
  String reasonCode=UtilXml.childElementValue(dataAreaConfirmMsgElement,"N2:REASONCODE");
  Timestamp timestamp=UtilDateTime.nowTimestamp();
  Map oagisMsgInfoCtx=new HashMap();
  oagisMsgInfoCtx.put("logicalId",logicalId);
  oagisMsgInfoCtx.put("component",component);
  oagisMsgInfoCtx.put("task",task);
  oagisMsgInfoCtx.put("referenceId",referenceId);
  oagisMsgInfoCtx.put("authId",authId);
  oagisMsgInfoCtx.put("receivedDate",timestamp);
  oagisMsgInfoCtx.put("confirmation",confirmation);
  oagisMsgInfoCtx.put("bsrVerb",bsrVerb);
  oagisMsgInfoCtx.put("bsrNoun",bsrNoun);
  oagisMsgInfoCtx.put("bsrRevision",bsrRevision);
  oagisMsgInfoCtx.put("outgoingMessage","N");
  oagisMsgInfoCtx.put("userLogin",userLogin);
  try {
    Map oagisMsgInfoResult=dispatcher.runSync("createOagisMessageInfo",oagisMsgInfoCtx);
    if (ServiceUtil.isError(oagisMsgInfoResult)) {
      String errMsg="Error creating OagisMessageInfo for the Incoming Message";
      errorList.add(errMsg);
      Debug.logError(errMsg,module);
    }
  }
 catch (  GenericServiceException e) {
    String errMsg="Error creating OagisMessageInfo for the Incoming Message";
    errorList.add(errMsg);
    Debug.logError(e,errMsg,module);
  }
  Map oagisMsgErrorCtx=new HashMap();
  oagisMsgErrorCtx.put("logicalId",dataAreaLogicalId);
  oagisMsgErrorCtx.put("component",dataAreaComponent);
  oagisMsgErrorCtx.put("task",dataAreaTask);
  oagisMsgErrorCtx.put("referenceId",dataAreaReferenceId);
  GenericValue oagisMsgInfo=null;
  try {
    oagisMsgInfo=delegator.findByPrimaryKey("OagisMessageInfo",oagisMsgErrorCtx);
  }
 catch (  GenericEntityException e) {
    String errMsg="Error Getting Entity OagisMessageInfo";
    errorList.add(errMsg);
    Debug.logError(e,errMsg,module);
  }
  if (oagisMsgInfo != null) {
    oagisMsgErrorCtx.put("reasonCode",reasonCode);
    oagisMsgErrorCtx.put("description",description);
    oagisMsgErrorCtx.put("userLogin",userLogin);
    try {
      Map oagisMsgErrorInfoResult=dispatcher.runSync("createOagisMessageErrorInfo",oagisMsgErrorCtx);
      if (ServiceUtil.isError(oagisMsgErrorInfoResult)) {
        String errMsg="Error creating OagisMessageErrorInfo";
        errorList.add(errMsg);
        Debug.logError(errMsg,module);
      }
    }
 catch (    GenericServiceException e) {
      String errMsg="Error creating OagisMessageErrorInfo";
      errorList.add(errMsg);
      Debug.logError(e,errMsg,module);
    }
  }
 else {
    String errMsg="No such message with an error was found in OagisMessageInfoEntity ; Not creating OagisMessageErrorInfo";
    Debug.logWarning(errMsg,module);
    errorList.add(errMsg);
  }
  Map result=new HashMap();
  result.put("contentType","text/plain");
  if (errorList.size() > 0) {
    result.putAll(oagisMsgInfoCtx);
    String errMsg="Error Processing Received Message";
    result.put("description",errMsg);
    result.put("reasonCode","00000");
    return result;
  }
  result.putAll(ServiceUtil.returnSuccess("Service Completed Successfully"));
  return result;
}
