{
  Delegator delegator=ctx.getDelegator();
  LocalDispatcher dispatcher=ctx.getDispatcher();
  Locale locale=(Locale)context.get("locale");
  String logicalId=(String)context.get("logicalId");
  String component=(String)context.get("component");
  String task=(String)context.get("task");
  String referenceId=(String)context.get("referenceId");
  Map<String,Object> oagisMessageInfoKey=UtilMisc.toMap("logicalId",(Object)logicalId,"component",component,"task",task,"referenceId",referenceId);
  try {
    GenericValue oagisMessageInfo=null;
    if (UtilValidate.isNotEmpty(referenceId) && (UtilValidate.isEmpty(component) || UtilValidate.isEmpty(task) || UtilValidate.isEmpty(referenceId))) {
      List<GenericValue> oagisMessageInfoList=delegator.findByAnd("OagisMessageInfo",UtilMisc.toMap("referenceId",referenceId));
      if (oagisMessageInfoList.size() == 1) {
        oagisMessageInfo=oagisMessageInfoList.get(0);
      }
 else       if (oagisMessageInfoList.size() > 1) {
        Integer messageSize=new Integer(oagisMessageInfoList.size());
        return ServiceUtil.returnError(UtilProperties.getMessage(resource,"OagisErrorLookupByReferenceError",UtilMisc.toMap("messageSize",messageSize.toString(),"referenceId",referenceId),locale));
      }
    }
 else {
      oagisMessageInfo=delegator.findOne("OagisMessageInfo",oagisMessageInfoKey,false);
    }
    if (oagisMessageInfo == null) {
      return ServiceUtil.returnError(UtilProperties.getMessage(resource,"OagisErrorFindOagisMessageInfo",UtilMisc.toMap("oagisMessageInfoKey",oagisMessageInfoKey),locale));
    }
    String fullMessageXml=oagisMessageInfo.getString("fullMessageXml");
    if (UtilValidate.isEmpty(fullMessageXml)) {
      return ServiceUtil.returnError(UtilProperties.getMessage(resource,"OagisErrorNotFoundFullMessageXml",UtilMisc.toMap("oagisMessageInfoKey",oagisMessageInfoKey),locale));
    }
    ByteArrayInputStream bis=new ByteArrayInputStream(fullMessageXml.getBytes("UTF-8"));
    Map<String,Object> result=dispatcher.runSync("oagisMessageHandler",UtilMisc.toMap("inputStream",bis,"isErrorRetry",Boolean.TRUE));
    if (ServiceUtil.isError(result)) {
      return ServiceUtil.returnError(UtilProperties.getMessage(resource,"OagisErrorReceivingAgainMessage",UtilMisc.toMap("oagisMessageInfoKey",oagisMessageInfoKey),locale),null,null,result);
    }
    return ServiceUtil.returnSuccess();
  }
 catch (  Exception e) {
    Debug.logError(e,"Error re-receiving message with ID [" + oagisMessageInfoKey + "]: "+ e.toString(),module);
    return ServiceUtil.returnError(UtilProperties.getMessage(resource,"OagisErrorReceivingAgainMessage",UtilMisc.toMap("oagisMessageInfoKey",oagisMessageInfoKey),locale) + e.toString());
  }
}
