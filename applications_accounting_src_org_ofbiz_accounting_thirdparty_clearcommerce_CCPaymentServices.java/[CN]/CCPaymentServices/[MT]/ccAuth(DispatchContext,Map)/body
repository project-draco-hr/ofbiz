{
  Document authRequestDoc=buildPrimaryTxRequest(context,"PreAuth",(Double)context.get("processAmount"),(String)context.get("orderId"));
  Document authResponseDoc=null;
  try {
    authResponseDoc=sendRequest(authRequestDoc,(String)context.get("paymentConfig"));
  }
 catch (  ClearCommerceException cce) {
    return ServiceUtil.returnError(cce.getMessage());
  }
  if (getMessageListMaxSev(authResponseDoc) > 4) {
    Map result=ServiceUtil.returnSuccess();
    result.put("authResult",new Boolean(false));
    result.put("processAmount",new Double(0.00));
    result.put("authRefNum",getReferenceNum(authResponseDoc));
    List messages=getMessageList(authResponseDoc);
    if (UtilValidate.isNotEmpty(messages)) {
      result.put("internalRespMsgs",messages);
    }
    return result;
  }
  return processAuthResponse(authResponseDoc);
}
