{
  File files[]=getTemplates();
  Map<String,Object> dataMap=buildDataMap();
  if (isGeronimo) {
    String serverType=args[0];
    String geronimoHome=null;
    if (args.length > 2) {
      geronimoHome=args[2];
    }
    GenerateGeronimoDeployment geronimoDeployment=new GenerateGeronimoDeployment();
    List classpathJars=geronimoDeployment.generate(serverType,geronimoHome);
    if (classpathJars == null) {
      throw new ContainerException("Error in Geronimo deployment, please check the log");
    }
    dataMap.put("classpathJars",classpathJars);
  }
  String applicationPrefix="";
  if (args.length > 3 && args[3].length() > 0) {
    applicationPrefix=args[3] + "-";
  }
  dataMap.put("applicationPrefix",applicationPrefix);
  dataMap.put("pathSeparatorChar",File.pathSeparatorChar);
  for (  File file : files) {
    if (isGeronimo && !(file.isDirectory() || file.isHidden() || file.getName().equalsIgnoreCase("geronimo-web.xml"))) {
      parseTemplate(file,dataMap);
    }
  }
}
