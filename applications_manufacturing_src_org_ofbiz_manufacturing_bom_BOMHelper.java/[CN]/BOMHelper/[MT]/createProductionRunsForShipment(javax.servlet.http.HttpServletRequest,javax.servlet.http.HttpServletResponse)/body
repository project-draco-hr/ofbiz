{
  Delegator delegator=(Delegator)request.getAttribute("delegator");
  LocalDispatcher dispatcher=(LocalDispatcher)request.getAttribute("dispatcher");
  GenericValue userLogin=(GenericValue)request.getSession().getAttribute("userLogin");
  String shipmentId=request.getParameter("shipmentId");
  try {
    List<GenericValue> shipmentPlans=delegator.findByAnd("OrderShipment",UtilMisc.toMap("shipmentId",shipmentId));
    for (    GenericValue shipmentPlan : shipmentPlans) {
      GenericValue orderItem=shipmentPlan.getRelatedOne("OrderItem");
      List<GenericValue> productionRuns=delegator.findByAndCache("WorkOrderItemFulfillment",UtilMisc.toMap("orderId",shipmentPlan.getString("orderId"),"orderItemSeqId",shipmentPlan.getString("orderItemSeqId"),"shipGroupSeqId",shipmentPlan.getString("shipGroupSeqId")));
      if (UtilValidate.isNotEmpty(productionRuns)) {
        Debug.logError("Production Run for order item (" + orderItem.getString("orderId") + "/"+ orderItem.getString("orderItemSeqId")+ ") not created.",module);
        continue;
      }
      dispatcher.runSync("createProductionRunsForOrder",UtilMisc.<String,Object>toMap("quantity",shipmentPlan.getBigDecimal("quantity"),"orderId",shipmentPlan.getString("orderId"),"orderItemSeqId",shipmentPlan.getString("orderItemSeqId"),"shipGroupSeqId",shipmentPlan.getString("shipGroupSeqId"),"shipmentId",shipmentId,"userLogin",userLogin));
    }
  }
 catch (  Exception e) {
    Debug.logWarning(e,module);
  }
  return "success";
}
