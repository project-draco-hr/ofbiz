{
  if (inDate == null)   inDate=new Date();
  int maxDepth=0;
  List<GenericValue> productNodesList=delegator.findByAndCache("ProductAssoc",UtilMisc.toMap("productIdTo",productId,"productAssocTypeId",bomType));
  productNodesList=EntityUtil.filterByDate(productNodesList,inDate);
  GenericValue oneNode=null;
  Iterator<GenericValue> nodesIterator=productNodesList.iterator();
  int depth=0;
  while (nodesIterator.hasNext()) {
    oneNode=nodesIterator.next();
    depth=0;
    depth=getMaxDepth(oneNode.getString("productId"),bomType,inDate,delegator);
    depth++;
    if (depth > maxDepth) {
      maxDepth=depth;
    }
  }
  return maxDepth;
}
