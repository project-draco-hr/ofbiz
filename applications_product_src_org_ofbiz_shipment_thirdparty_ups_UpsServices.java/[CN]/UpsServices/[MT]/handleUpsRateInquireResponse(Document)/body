{
  Element rateResponseElement=rateResponseDocument.getDocumentElement();
  Element responseElement=UtilXml.firstChildElement(rateResponseElement,"Response");
  Element responseTransactionReferenceElement=UtilXml.firstChildElement(responseElement,"TransactionReference");
  String responseTransactionReferenceCustomerContext=UtilXml.childElementValue(responseTransactionReferenceElement,"CustomerContext");
  String responseTransactionReferenceXpciVersion=UtilXml.childElementValue(responseTransactionReferenceElement,"XpciVersion");
  String responseStatusCode=UtilXml.childElementValue(responseElement,"ResponseStatusCode");
  String responseStatusDescription=UtilXml.childElementValue(responseElement,"ResponseStatusDescription");
  List<Object> errorList=FastList.newInstance();
  UpsServices.handleErrors(responseElement,errorList);
  if ("1".equals(responseStatusCode)) {
    List<? extends Element> rates=UtilXml.childElementList(rateResponseElement,"RatedShipment");
    Map<String,Double> rateMap=FastMap.newInstance();
    Double firstRate=null;
    if (rates == null || rates.size() == 0) {
      return ServiceUtil.returnError("No rates available at this time");
    }
 else {
      Iterator<? extends Element> i=rates.iterator();
      while (i.hasNext()) {
        Element element=i.next();
        Element service=UtilXml.firstChildElement(element,"Service");
        String serviceCode=UtilXml.childElementValue(service,"Code");
        Element totalCharges=UtilXml.firstChildElement(element,"TotalCharges");
        String totalString=UtilXml.childElementValue(totalCharges,"MonetaryValue");
        rateMap.put(serviceCode,Double.valueOf(totalString));
        if (firstRate == null) {
          firstRate=rateMap.get(serviceCode);
        }
      }
    }
    Debug.log("UPS Rate Map : " + rateMap,module);
    Map<String,Object> resp=ServiceUtil.returnSuccess();
    resp.put("upsRateCodeMap",rateMap);
    resp.put("shippingEstimateAmount",firstRate);
    return resp;
  }
 else {
    errorList.add("Error status code : " + responseStatusCode);
    return ServiceUtil.returnFailure(errorList);
  }
}
