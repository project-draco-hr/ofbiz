{
  Element avResponseElement=rateResponseDocument.getDocumentElement();
  Element responseElement=UtilXml.firstChildElement(avResponseElement,"Response");
  String responseStatusCode=UtilXml.childElementValue(responseElement,"ResponseStatusCode");
  List<Object> errorList=FastList.newInstance();
  UpsServices.handleErrors(responseElement,errorList);
  if ("1".equals(responseStatusCode)) {
    List<Map<String,String>> matches=FastList.newInstance();
    List<? extends Element> avResultList=UtilXml.childElementList(avResponseElement,"AddressValidationResult");
    if (UtilValidate.isNotEmpty(avResultList)) {
      Iterator<? extends Element> i=avResultList.iterator();
      while (i.hasNext()) {
        Element avResultElement=i.next();
        Map<String,String> match=FastMap.newInstance();
        match.put("Rank",UtilXml.childElementValue(avResultElement,"Rank"));
        match.put("Quality",UtilXml.childElementValue(avResultElement,"Quality"));
        Element addressElement=UtilXml.firstChildElement(avResultElement,"Address");
        match.put("City",UtilXml.childElementValue(addressElement,"City"));
        match.put("StateProvinceCode",UtilXml.childElementValue(addressElement,"StateProvinceCode"));
        match.put("PostalCodeLowEnd",UtilXml.childElementValue(avResultElement,"PostalCodeLowEnd"));
        match.put("PostalCodeHighEnd",UtilXml.childElementValue(avResultElement,"PostalCodeHighEnd"));
        matches.add(match);
      }
    }
    Map<String,Object> result=ServiceUtil.returnSuccess();
    result.put("matches",matches);
    return result;
  }
 else {
    errorList.add("Error status code : " + responseStatusCode);
    return ServiceUtil.returnError(errorList);
  }
}
