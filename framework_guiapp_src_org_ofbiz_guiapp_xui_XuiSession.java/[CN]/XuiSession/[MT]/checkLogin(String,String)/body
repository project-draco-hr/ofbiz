{
  if (dispatcher == null) {
    throw new UserLoginFailure("Unable to log in; XUI not configured propertly");
  }
  if (UtilValidate.isEmpty(username)) {
    throw new UserLoginFailure("Username is missing");
  }
  if (UtilValidate.isEmpty(password)) {
    throw new UserLoginFailure("Password is missing");
  }
  Map result=null;
  try {
    result=dispatcher.runSync("userLogin",UtilMisc.toMap("login.username",username,"login.password",password));
  }
 catch (  GenericServiceException e) {
    Debug.logError(e,module);
    throw new UserLoginFailure(e);
  }
catch (  Throwable t) {
    Debug.logError(t,"Thowable caught!",module);
  }
  if (ServiceUtil.isError(result)) {
    throw new UserLoginFailure(ServiceUtil.getErrorMessage(result));
  }
 else {
    GenericValue ul=(GenericValue)result.get("userLogin");
    if (ul == null) {
      throw new UserLoginFailure("UserLogin return was not valid (null)");
    }
    return ul;
  }
}
