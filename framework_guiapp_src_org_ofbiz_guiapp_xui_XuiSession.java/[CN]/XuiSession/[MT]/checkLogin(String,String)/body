{
  if (dispatcher == null) {
    throw new UserLoginFailure(UtilProperties.getMessage("XuiUiLabels","XuiUnableToLogIn",locale));
  }
  if (UtilValidate.isEmpty(username)) {
    throw new UserLoginFailure(UtilProperties.getMessage("PartyUiLabels","PartyUserNameMissing",locale));
  }
  if (UtilValidate.isEmpty(password)) {
    throw new UserLoginFailure(UtilProperties.getMessage("PartyUiLabels","PartyPasswordMissing",locale));
  }
  Map<String,Object> result=null;
  try {
    result=dispatcher.runSync("userLogin",UtilMisc.toMap("login.username",username,"login.password",password));
  }
 catch (  GenericServiceException e) {
    Debug.logError(e,module);
    throw new UserLoginFailure(e);
  }
catch (  Throwable t) {
    Debug.logError(t,"Throwable caught!",module);
  }
  if (ServiceUtil.isError(result)) {
    throw new UserLoginFailure(ServiceUtil.getErrorMessage(result));
  }
 else {
    GenericValue ul=(GenericValue)result.get("userLogin");
    if (ul == null) {
      throw new UserLoginFailure(UtilProperties.getMessage("XuiUiLabels","XuiUserLoginNotValid",locale));
    }
    return ul;
  }
}
