{
  try {
    int multipartCount=multipart.getCount();
    for (int i=0; i < multipartCount && i < 10; i++) {
      Part part=multipart.getBodyPart(i);
      String thisContentTypeRaw=part.getContentType();
      String content=null;
      int idx2=thisContentTypeRaw.indexOf(";");
      if (idx2 == -1) {
        idx2=thisContentTypeRaw.length();
      }
      String thisContentType=thisContentTypeRaw.substring(0,idx2);
      if (thisContentType == null || thisContentType.equals(""))       thisContentType="text/html";
      String disposition=part.getDisposition();
      if (thisContentType.startsWith("multipart") || thisContentType.startsWith("Multipart")) {
        contentIndex=contentIndex.concat("." + i);
        return addMessageBody(commEventMap,(Multipart)part.getContent());
      }
 else       if ((disposition == null) && (i == 0) && thisContentType.startsWith("text")) {
        content=(String)part.getContent();
        if (UtilValidate.isNotEmpty(content)) {
          contentIndex=contentIndex.concat("." + i);
          commEventMap.put("content",content);
          commEventMap.put("contentMimeTypeId",thisContentType);
          return commEventMap;
        }
      }
 else       if ((disposition != null) && (disposition.equals(Part.ATTACHMENT) || disposition.equals(Part.INLINE)) && thisContentType.startsWith("text")) {
        contentIndex=contentIndex.concat("." + i);
        commEventMap.put("content",part.getContent());
        commEventMap.put("contentMimeTypeId",thisContentType);
        return commEventMap;
      }
    }
    return commEventMap;
  }
 catch (  MessagingException e) {
    Debug.logError(e,module);
    return ServiceUtil.returnError(e.getMessage());
  }
catch (  IOException e) {
    Debug.logError(e,module);
    return ServiceUtil.returnError(e.getMessage());
  }
}
