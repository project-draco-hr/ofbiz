{
  try {
    Iterator it=parties.iterator();
    while (it.hasNext()) {
      Map result=(Map)it.next();
      String partyId=(String)result.get("partyId");
      GenericValue commEventRole=delegator.findByPrimaryKey("CommunicationEventRole",UtilMisc.toMap("communicationEventId",communicationEventId,"partyId",partyId,"roleTypeId",roleTypeId));
      if (commEventRole == null) {
        GenericValue partyRole=delegator.findByPrimaryKey("PartyRole",UtilMisc.toMap("partyId",partyId,"roleTypeId",roleTypeId));
        if (partyRole == null) {
          dispatcher.runSync("createPartyRole",UtilMisc.<String,Object>toMap("partyId",partyId,"roleTypeId",roleTypeId,"userLogin",userLogin));
        }
        Map input=UtilMisc.toMap("communicationEventId",communicationEventId,"partyId",partyId,"roleTypeId",roleTypeId,"userLogin",userLogin,"contactMechId",(String)result.get("contactMechId"));
        dispatcher.runSync("createCommunicationEventRole",input);
      }
    }
  }
 catch (  GenericServiceException e) {
    Debug.logError(e,module);
  }
catch (  Exception e) {
    Debug.logError(e,module);
  }
}
