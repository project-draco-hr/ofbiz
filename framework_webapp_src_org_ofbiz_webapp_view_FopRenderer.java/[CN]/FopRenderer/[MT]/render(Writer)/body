{
  Logger logger=new Log4JLogger(Debug.getLogger(module));
  MessageHandler.setScreenLogger(logger);
  Driver driver=new Driver();
  driver.setRenderer(Driver.RENDER_PDF);
  driver.setLogger(logger);
  Document xslfo=null;
  try {
    xslfo=UtilXml.readXmlDocument(writer.toString());
  }
 catch (  Throwable t) {
    throw new GeneralException("Problems reading the parsed content to XML Document",t);
  }
  ByteArrayOutputStream out=new ByteArrayOutputStream();
  driver.setOutputStream(out);
  InputSource is=new DocumentInputSource(xslfo);
  driver.setInputSource(is);
  try {
    driver.run();
    FopImageFactory.resetCache();
  }
 catch (  Throwable t) {
    throw new GeneralException("Unable to generate PDF from XSL-FO",t);
  }
  return out;
}
