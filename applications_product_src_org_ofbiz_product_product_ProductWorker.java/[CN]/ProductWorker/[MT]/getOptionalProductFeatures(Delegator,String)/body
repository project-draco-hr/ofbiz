{
  Map<String,List<GenericValue>> featureMap=new LinkedHashMap<String,List<GenericValue>>();
  List<GenericValue> productFeatureAppls=null;
  try {
    productFeatureAppls=delegator.findByAnd("ProductFeatureAndAppl",UtilMisc.toMap("productId",productId,"productFeatureApplTypeId","OPTIONAL_FEATURE"),UtilMisc.toList("productFeatureTypeId","sequenceNum"),false);
  }
 catch (  GenericEntityException e) {
    Debug.logError(e,module);
  }
  if (productFeatureAppls != null) {
    for (    GenericValue appl : productFeatureAppls) {
      String featureType=appl.getString("productFeatureTypeId");
      List<GenericValue> features=featureMap.get(featureType);
      if (features == null) {
        features=FastList.newInstance();
      }
      features.add(appl);
      featureMap.put(featureType,features);
    }
  }
  return featureMap;
}
