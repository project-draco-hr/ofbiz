{
  Map featureMap=new LinkedMap();
  List productFeatureAppls=null;
  try {
    productFeatureAppls=delegator.findByAnd("ProductFeatureAndAppl",UtilMisc.toMap("productId",productId,"productFeatureApplTypeId","OPTIONAL_FEATURE"),UtilMisc.toList("productFeatureTypeId","sequenceNum"));
  }
 catch (  GenericEntityException e) {
    Debug.logError(e,module);
  }
  if (productFeatureAppls != null) {
    Iterator i=productFeatureAppls.iterator();
    while (i.hasNext()) {
      GenericValue appl=(GenericValue)i.next();
      String featureType=appl.getString("productFeatureTypeId");
      List features=(List)featureMap.get(featureType);
      if (features == null) {
        features=new LinkedList();
      }
      features.add(appl);
      featureMap.put(featureType,features);
    }
  }
  return featureMap;
}
