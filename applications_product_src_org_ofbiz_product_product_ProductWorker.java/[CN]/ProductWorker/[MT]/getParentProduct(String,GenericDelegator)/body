{
  GenericValue _parentProduct=null;
  if (productId == null) {
    Debug.logWarning("Bad product id",module);
  }
  try {
    List virtualProductAssocs=delegator.findByAndCache("ProductAssoc",UtilMisc.toMap("productIdTo",productId,"productAssocTypeId","PRODUCT_VARIANT"),UtilMisc.toList("-fromDate"));
    virtualProductAssocs=EntityUtil.filterByDate(virtualProductAssocs,true);
    if (virtualProductAssocs == null || virtualProductAssocs.size() == 0) {
      virtualProductAssocs=delegator.findByAndCache("ProductAssoc",UtilMisc.toMap("productIdTo",productId,"productAssocTypeId","UNIQUE_ITEM"),UtilMisc.toList("-fromDate"));
      virtualProductAssocs=EntityUtil.filterByDate(virtualProductAssocs,true);
    }
    if (virtualProductAssocs != null && virtualProductAssocs.size() > 0) {
      GenericValue productAssoc=EntityUtil.getFirst(virtualProductAssocs);
      _parentProduct=productAssoc.getRelatedOneCache("MainProduct");
    }
  }
 catch (  GenericEntityException e) {
    throw new RuntimeException("Entity Engine error getting Parent Product (" + e.getMessage() + ")");
  }
  return _parentProduct;
}
