{
  if (variantProduct == null) {
    return FastSet.newInstance();
  }
  if (!"Y".equals(variantProduct.getString("isVariant"))) {
    throw new IllegalArgumentException("Cannot get distinguishing features for a product that is not a variant (ie isVariant!=Y).");
  }
  GenericDelegator delegator=variantProduct.getDelegator();
  String virtualProductId=getVariantVirtualId(variantProduct);
  Set<GenericValue> distFeatures=FastSet.newInstance();
  List<GenericValue> variantDistinguishingFeatures=delegator.findByAndCache("ProductFeatureAndAppl",UtilMisc.toMap("productId",variantProduct.get("productId"),"productFeatureApplTypeId","DISTINGUISHING_FEAT"));
  Iterator<GenericValue> variantDistinguishingFeatureIter=UtilMisc.toIterator(EntityUtil.filterByDate(variantDistinguishingFeatures));
  while (variantDistinguishingFeatureIter != null && variantDistinguishingFeatureIter.hasNext()) {
    GenericValue variantDistinguishingFeature=variantDistinguishingFeatureIter.next();
    GenericValue dummyFeature=delegator.makeValue("ProductFeature");
    dummyFeature.setAllFields(variantDistinguishingFeature,true,null,null);
    distFeatures.add(dummyFeature);
  }
  List<GenericValue> virtualSelectableFeatures=delegator.findByAndCache("ProductFeatureAndAppl",UtilMisc.toMap("productId",virtualProductId,"productFeatureApplTypeId","SELECTABLE_FEATURE"));
  Iterator<GenericValue> virtualSelectableFeatureIter=UtilMisc.toIterator(EntityUtil.filterByDate(virtualSelectableFeatures));
  Set<String> virtualSelectableFeatureIds=FastSet.newInstance();
  while (virtualSelectableFeatureIter != null && virtualSelectableFeatureIter.hasNext()) {
    GenericValue virtualSelectableFeature=virtualSelectableFeatureIter.next();
    virtualSelectableFeatureIds.add(virtualSelectableFeature.getString("productFeatureId"));
  }
  List<GenericValue> variantStandardFeatures=delegator.findByAndCache("ProductFeatureAndAppl",UtilMisc.toMap("productId",variantProduct.get("productId"),"productFeatureApplTypeId","STANDARD_FEATURE"));
  Iterator<GenericValue> variantStandardFeatureIter=UtilMisc.toIterator(EntityUtil.filterByDate(variantStandardFeatures));
  while (variantStandardFeatureIter != null && variantStandardFeatureIter.hasNext()) {
    GenericValue variantStandardFeature=variantStandardFeatureIter.next();
    if (virtualSelectableFeatureIds.contains(variantStandardFeature.get("productFeatureId"))) {
      GenericValue dummyFeature=delegator.makeValue("ProductFeature");
      dummyFeature.setAllFields(variantStandardFeature,true,null,null);
      distFeatures.add(dummyFeature);
    }
  }
  return distFeatures;
}
