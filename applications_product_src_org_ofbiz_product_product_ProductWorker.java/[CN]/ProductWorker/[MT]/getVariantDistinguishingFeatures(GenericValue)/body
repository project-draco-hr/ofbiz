{
  if (variantProduct == null) {
    return FastSet.newInstance();
  }
  if (!"Y".equals(variantProduct.getString("isVariant"))) {
    throw new IllegalArgumentException("Cannot get distinguishing features for a product that is not a variant (ie isVariant!=Y).");
  }
  GenericDelegator delegator=variantProduct.getDelegator();
  String virtualProductId=getVariantVirtualId(variantProduct);
  Set distFeatures=FastSet.newInstance();
  List variantDistinguishingFeatures=delegator.findByAndCache("ProductFeatureAndAppl",UtilMisc.toMap("productId",variantProduct.get("productId"),"productFeatureApplTypeId","DISTINGUISHING_FEAT"));
  Iterator variantDistinguishingFeatureIter=UtilMisc.toIterator(EntityUtil.filterByDate(variantDistinguishingFeatures));
  while (variantDistinguishingFeatureIter != null && variantDistinguishingFeatureIter.hasNext()) {
    GenericValue variantDistinguishingFeature=(GenericValue)variantDistinguishingFeatureIter.next();
    GenericValue dummyFeature=delegator.makeValue("ProductFeature");
    dummyFeature.setAllFields(variantDistinguishingFeature,true,null,null);
    distFeatures.add(dummyFeature);
  }
  List virtualSelectableFeatures=delegator.findByAndCache("ProductFeatureAndAppl",UtilMisc.toMap("productId",virtualProductId,"productFeatureApplTypeId","SELECTABLE_FEATURE"));
  Iterator virtualSelectableFeatureIter=UtilMisc.toIterator(EntityUtil.filterByDate(virtualSelectableFeatures));
  Set virtualSelectableFeatureIds=FastSet.newInstance();
  while (virtualSelectableFeatureIter != null && virtualSelectableFeatureIter.hasNext()) {
    GenericValue virtualSelectableFeature=(GenericValue)virtualSelectableFeatureIter.next();
    virtualSelectableFeatureIds.add(virtualSelectableFeature.get("productFeatureId"));
  }
  List variantStandardFeatures=delegator.findByAndCache("ProductFeatureAndAppl",UtilMisc.toMap("productId",variantProduct.get("productId"),"productFeatureApplTypeId","STANDARD_FEATURE"));
  Iterator variantStandardFeatureIter=UtilMisc.toIterator(EntityUtil.filterByDate(variantStandardFeatures));
  while (variantStandardFeatureIter != null && variantStandardFeatureIter.hasNext()) {
    GenericValue variantStandardFeature=(GenericValue)variantStandardFeatureIter.next();
    if (virtualSelectableFeatureIds.contains(variantStandardFeature.get("productFeatureId"))) {
      GenericValue dummyFeature=delegator.makeValue("ProductFeature");
      dummyFeature.setAllFields(variantStandardFeature,true,null,null);
      distFeatures.add(dummyFeature);
    }
  }
  return distFeatures;
}
