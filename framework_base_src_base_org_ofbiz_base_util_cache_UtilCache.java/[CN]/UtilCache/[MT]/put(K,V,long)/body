{
  CacheLine<V> oldCacheLine;
  CacheLine<V> newCacheLine;
  if (expireTime > 0) {
    newCacheLine=useSoftReference ? new SoftRefCacheLine<V>(value,System.currentTimeMillis(),expireTime) : new HardRefCacheLine<V>(value,System.currentTimeMillis(),expireTime);
  }
 else {
    newCacheLine=useSoftReference ? new SoftRefCacheLine<V>(value,expireTime) : new HardRefCacheLine<V>(value,expireTime);
  }
  oldCacheLine=cacheLineTable.put(key,newCacheLine);
  if (oldCacheLine == null) {
    noteAddition(key,value);
    return null;
  }
 else {
    noteUpdate(key,value,oldCacheLine.getValue());
    return oldCacheLine.getValue();
  }
}
