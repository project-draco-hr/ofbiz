{
  String fieldName=fieldNameExdr.expandString(context);
  Object value=null;
  if (envNameAcsr != null) {
    value=envNameAcsr.get(context);
  }
  if (value == null && valueExdr != null) {
    value=valueExdr.expandString(context);
  }
  String operatorName=operatorExdr.expandString(context);
  EntityOperator operator=EntityOperator.lookup(operatorName);
  if (operator == null) {
    throw new IllegalArgumentException("Could not find an entity operator for the name: " + operatorName);
  }
  if ((operator == EntityOperator.IN || operator == EntityOperator.BETWEEN) && value instanceof String) {
    String delim=null;
    if (((String)value).indexOf("|") >= 0) {
      delim="|";
    }
 else     if (((String)value).indexOf(",") >= 0) {
      delim=",";
    }
    if (UtilValidate.isNotEmpty(delim)) {
      value=StringUtil.split((String)value,delim);
    }
  }
  if (modelEntity.getField(fieldName) == null) {
    throw new IllegalArgumentException("Error in Entity Find: could not find field [" + fieldName + "] in entity with name ["+ modelEntity.getEntityName()+ "]");
  }
  if (!((operator == EntityOperator.IN || operator == EntityOperator.BETWEEN) && value instanceof Collection)) {
    value=modelEntity.convertFieldValue(modelEntity.getField(fieldName),value,modelFieldTypeReader,context);
  }
  if (Debug.verboseOn())   Debug.logVerbose("Got value for fieldName [" + fieldName + "]: "+ value,module);
  if (this.ignoreIfNull && value == null) {
    return null;
  }
  if (this.ignoreIfEmpty && ObjectType.isEmpty(value)) {
    return null;
  }
  if ("true".equals(this.ignoreExdr.expandString(context))) {
    return null;
  }
  if (operator == EntityOperator.NOT_EQUAL && value != null) {
    if (ignoreCase) {
      return EntityCondition.makeCondition(EntityCondition.makeCondition(EntityFunction.UPPER_FIELD(fieldName),(EntityComparisonOperator)operator,EntityFunction.UPPER(value)),EntityOperator.OR,EntityCondition.makeCondition(fieldName,EntityOperator.EQUALS,null));
    }
 else {
      return EntityCondition.makeCondition(EntityCondition.makeCondition(fieldName,(EntityComparisonOperator)operator,value),EntityOperator.OR,EntityCondition.makeCondition(fieldName,EntityOperator.EQUALS,null));
    }
  }
 else {
    if (ignoreCase) {
      return EntityCondition.makeCondition(EntityFunction.UPPER_FIELD(fieldName),(EntityComparisonOperator)operator,EntityFunction.UPPER(value));
    }
 else {
      return EntityCondition.makeCondition(fieldName,(EntityComparisonOperator)operator,value);
    }
  }
}
