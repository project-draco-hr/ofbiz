{
  String storeType=UtilProperties.getPropertyValue("jsse.properties","ofbiz.rmi.keyStore.type","jks");
  String storeFile=UtilProperties.getPropertyValue("jsse.properties","ofbiz.rmi.keyStore",null);
  String storeAlias=UtilProperties.getPropertyValue("jsse.properties","ofbiz.rmi.keyStore.alias",null);
  String storePass=UtilProperties.getPropertyValue("jsse.properties","ofbiz.rmi.keyStore.password",null);
  char[] passphrase=null;
  if (storePass != null) {
    passphrase=storePass.toCharArray();
  }
  KeyStore ks=null;
  try {
    ks=KeyStore.getInstance(storeType);
    ks.load(new FileInputStream(storeFile),passphrase);
  }
 catch (  NoSuchAlgorithmException e) {
    Debug.logError(e,module);
    throw new IOException(e.getMessage());
  }
catch (  CertificateException e) {
    Debug.logError(e,module);
    throw new IOException(e.getMessage());
  }
catch (  KeyStoreException e) {
    Debug.logError(e,module);
    throw new IOException(e.getMessage());
  }
  if (ks == null) {
    throw new IOException("Unable to load KeyStore containing Service Engine RMI SSL certificate");
  }
  javax.net.ssl.SSLServerSocketFactory factory=null;
  try {
    factory=SSLUtil.getSSLServerSocketFactory(ks,storePass,storeAlias);
  }
 catch (  GeneralSecurityException e) {
    Debug.logError(e,"Error getting javax.net.ssl.SSLServerSocketFactory instance for Service Engine RMI calls: " + e.toString(),module);
    throw new IOException(e.toString());
  }
  if (factory == null) {
    throw new IOException("Unable to obtain SSLServerSocketFactory for provided KeyStore");
  }
  SSLServerSocket socket=(SSLServerSocket)factory.createServerSocket(port);
  socket.setNeedClientAuth(clientAuth);
  return socket;
}
