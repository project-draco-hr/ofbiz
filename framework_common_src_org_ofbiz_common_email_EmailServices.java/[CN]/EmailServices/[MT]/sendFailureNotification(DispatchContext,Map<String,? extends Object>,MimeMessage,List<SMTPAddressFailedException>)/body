{
  Map<String,Object> newContext=FastMap.newInstance();
  newContext.put("userLogin",context.get("userLogin"));
  newContext.put("sendFailureNotification",false);
  newContext.put("sendFrom",context.get("sendFrom"));
  newContext.put("sendTo",context.get("sendFrom"));
  newContext.put("subject","Undelivered Mail Returned to Sender");
  StringBuilder sb=new StringBuilder();
  sb.append("Delivery to the following recipient(s) failed:\n\n");
  for (  SMTPAddressFailedException failure : failures) {
    sb.append(failure.getAddress());
    sb.append(": ");
    sb.append(failure.getMessage());
    sb.append("/n/n");
  }
  sb.append("----- Original message -----/n/n");
  List<Map<String,Object>> bodyParts=FastList.newInstance();
  bodyParts.add(UtilMisc.<String,Object>toMap("content",sb.toString(),"type","text/plain"));
  Map<String,Object> bodyPart=FastMap.newInstance();
  bodyPart.put("content",sb.toString());
  bodyPart.put("type","text/plain");
  try {
    bodyParts.add(UtilMisc.<String,Object>toMap("content",message.getDataHandler()));
  }
 catch (  MessagingException e) {
    Debug.logError(e,module);
  }
  try {
    dctx.getDispatcher().runSync("sendMailMultiPart",newContext);
  }
 catch (  GenericServiceException e) {
    Debug.logError(e,module);
  }
}
