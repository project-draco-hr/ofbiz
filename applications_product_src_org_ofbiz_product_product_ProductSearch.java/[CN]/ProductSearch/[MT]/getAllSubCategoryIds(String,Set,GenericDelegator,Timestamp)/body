{
  if (nowTimestamp == null) {
    nowTimestamp=UtilDateTime.nowTimestamp();
  }
  productCategoryIdSet.add(productCategoryId);
  try {
    List productCategoryRollupList=delegator.findByAndCache("ProductCategoryRollup",UtilMisc.toMap("parentProductCategoryId",productCategoryId));
    Iterator productCategoryRollupIter=productCategoryRollupList.iterator();
    while (productCategoryRollupIter.hasNext()) {
      GenericValue productCategoryRollup=(GenericValue)productCategoryRollupIter.next();
      String subProductCategoryId=productCategoryRollup.getString("productCategoryId");
      if (productCategoryIdSet.contains(subProductCategoryId)) {
        continue;
      }
      if (EntityUtil.isValueActive(productCategoryRollup,nowTimestamp)) {
        getAllSubCategoryIds(subProductCategoryId,productCategoryIdSet,delegator,nowTimestamp);
      }
    }
  }
 catch (  GenericEntityException e) {
    Debug.logError(e,"Error finding sub-categories for product search",module);
  }
}
