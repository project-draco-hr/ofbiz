{
  List productSearchConstraintList=new LinkedList();
  if (UtilValidate.isNotEmpty(productCategoryId)) {
    productSearchConstraintList.add(new CategoryConstraint(productCategoryId,includeSubCategories));
  }
  if (UtilValidate.isNotEmpty(keywordsString)) {
    productSearchConstraintList.add(new KeywordConstraint(keywordsString,anyPrefix,anySuffix,null,isAnd));
  }
  if (featureIdSet != null && featureIdSet.size() > 0) {
    Iterator featureIdIter=featureIdSet.iterator();
    while (featureIdIter.hasNext()) {
      String productFeatureId=(String)featureIdIter.next();
      productSearchConstraintList.add(new FeatureConstraint(productFeatureId));
    }
  }
  return searchProducts(productSearchConstraintList,new SortKeywordRelevancy(),delegator,visitId);
}
