{
  GenericValue orderPaymentPreference=(GenericValue)context.get("orderPaymentPreference");
  String configString=(String)context.get("paymentConfig");
  String currency=(String)context.get("currency");
  if (configString == null) {
    configString="payment.properties";
  }
  String merchantDesc=UtilProperties.getPropertyValue(configString,"payment.cybersource.merchantDescr",null);
  String merchantCont=UtilProperties.getPropertyValue(configString,"payment.cybersource.merchantContact",null);
  Map request=new HashMap();
  request.put("ccCreditService_run","true");
  request.put("ccCreditService_captureRequestID",authTransaction.getString("referenceNum"));
  request.put("item_0_unitPrice",getAmountString(context,"refundAmount"));
  request.put("merchantReferenceCode",orderPaymentPreference.getString("orderId"));
  request.put("purchaseTotals_currency",currency);
  if (merchantDesc != null) {
    request.put("invoiceHeader_merchantDescriptor",merchantDesc);
  }
  if (merchantCont != null) {
    request.put("invoiceHeader_merchantDescriptorContact",merchantCont);
  }
  return request;
}
