{
  Debug.log("Parsing template : " + templateFile.getAbsolutePath() + " for web app "+ webApp.getName(),module);
  Map<String,Object> dataMap=new HashMap<String,Object>();
  dataMap.put("webApp",webApp);
  String webAppGeronimoWebXmlFileName=webApp.getLocation() + "/WEB-INF/geronimo-web.xml";
  String webAppGeronimoWebInfDirName=webApp.getLocation() + "/WEB-INF";
  File webAppGeronimoWebInfDir=new File(webAppGeronimoWebInfDirName);
  if (!(webAppGeronimoWebInfDir.exists() && webAppGeronimoWebInfDir.isDirectory())) {
    Debug.logFatal("Unable to create - " + webAppGeronimoWebXmlFileName,module);
    Debug.logFatal("The directory " + webAppGeronimoWebInfDirName + " does not exist",module);
    return;
  }
  Reader reader=null;
  try {
    reader=new InputStreamReader(new FileInputStream(templateFile));
  }
 catch (  FileNotFoundException e) {
    Debug.logFatal("Unable to create - " + webAppGeronimoWebXmlFileName,module);
    return;
  }
 finally {
    if (reader != null) {
      try {
        reader.close();
      }
 catch (      IOException e) {
        Debug.logError("Trouble closing - " + webAppGeronimoWebXmlFileName,module);
      }
    }
  }
  Writer writer=null;
  try {
    writer=new FileWriter(webAppGeronimoWebXmlFileName);
  }
 catch (  IOException e) {
    Debug.logFatal("Unable to create - " + webAppGeronimoWebXmlFileName,module);
    return;
  }
  try {
    FreeMarkerWorker.renderTemplate(UtilURL.fromFilename(templateFile.getAbsolutePath()).toExternalForm(),dataMap,writer);
  }
 catch (  Exception e) {
    Debug.logFatal("Unable to create - " + webAppGeronimoWebXmlFileName,module);
    return;
  }
  try {
    writer.flush();
    writer.close();
  }
 catch (  IOException e) {
    Debug.logFatal("Unable to create - " + webAppGeronimoWebXmlFileName,module);
    return;
  }
}
