{
  LocalDispatcher dispatcher=dctx.getDispatcher();
  double totalWeight=0.00;
  String defaultWeightUomId=UtilProperties.getPropertyValue("shipment.properties","shipment.default.weight.uom");
  if (UtilValidate.isEmpty(defaultWeightUomId)) {
    Debug.logWarning("No shipment.default.weight.uom set in shipment.properties, setting it to WT_oz for USPS",module);
    defaultWeightUomId="WT_oz";
  }
  for (  Map.Entry<String,Double> entry : packageMap.entrySet()) {
    String productId=entry.getKey();
    Map<String,Object> productInfo=getProductItemInfo(shippableItemInfo,productId);
    double productWeight=((Double)productInfo.get("weight")).doubleValue();
    double quantity=entry.getValue().doubleValue();
    String weightUomId=(String)productInfo.get("weight_uom_id");
    Debug.logInfo("Product Id : " + productId.toString() + " Product Weight : "+ String.valueOf(productWeight)+ " Product UomId : "+ weightUomId+ " assuming "+ defaultWeightUomId+ " if null. Quantity : "+ String.valueOf(quantity),module);
    if (UtilValidate.isEmpty(weightUomId)) {
      weightUomId=defaultWeightUomId;
    }
    if (!"WT_lb".equals(weightUomId)) {
      Map<String,Object> result=FastMap.newInstance();
      try {
        result=dispatcher.runSync("convertUom",UtilMisc.<String,Object>toMap("uomId",weightUomId,"uomIdTo","WT_lb","originalValue",Double.valueOf(productWeight)));
      }
 catch (      GenericServiceException ex) {
        Debug.logError(ex,module);
      }
      if (result.get(ModelService.RESPONSE_MESSAGE).equals(ModelService.RESPOND_SUCCESS) && result.get("convertedValue") != null) {
        productWeight=((Double)result.get("convertedValue")).doubleValue();
      }
 else {
        Debug.logError("Unsupported weightUom [" + weightUomId + "] for calcPackageWeight running productId "+ productId+ ", could not find a conversion factor to WT_lb",module);
      }
    }
    totalWeight+=(productWeight * quantity);
  }
  Debug.logInfo("Package Weight : " + String.valueOf(totalWeight) + " lbs.",module);
  return totalWeight + additionalWeight;
}
