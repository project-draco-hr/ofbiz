{
  HttpSession session=((HttpServletRequest)request).getSession();
  Map<String,Object> requestParameters=UtilHttp.getParameterMap((HttpServletRequest)request);
  String webSiteId=null;
  boolean fromSession=false;
  webSiteId=(String)requestParameters.get("webSiteId");
  if (UtilValidate.isEmpty(webSiteId)) {
    webSiteId=(String)session.getAttribute("webSiteId");
    if (webSiteId != null)     fromSession=true;
  }
  if (UtilValidate.isEmpty(webSiteId)) {
    ServletContext application=((ServletContext)request.getAttribute("servletContext"));
    if (application != null)     webSiteId=application.getInitParameter("webSiteId");
  }
  if (UtilValidate.isNotEmpty(webSiteId) && !fromSession) {
    session.setAttribute("webSiteId",webSiteId);
  }
  return webSiteId;
}
