{
  Interpreter bsh=new Interpreter();
  bsh.setClassLoader(methodContext.getLoader());
  try {
    for (    Map.Entry<String,Object> entry : methodContext) {
      bsh.set(entry.getKey(),entry.getValue());
    }
    if (UtilValidate.isNotEmpty(this.resource)) {
      InputStream is=methodContext.getLoader().getResourceAsStream(this.resource);
      if (is == null) {
        addErrorMessage(methodContext,"Could not find bsh resource: " + this.resource);
      }
 else {
        BufferedReader reader=null;
        try {
          reader=new BufferedReader(new InputStreamReader(is));
          StringBuilder outSb=new StringBuilder();
          String tempStr=null;
          while ((tempStr=reader.readLine()) != null) {
            outSb.append(tempStr);
            outSb.append('\n');
          }
          Object resourceResult=bsh.eval(outSb.toString());
          if ((resourceResult != null) && (resourceResult instanceof Map<?,?>)) {
            methodContext.putAllEnv(UtilGenerics.<String,Object>checkMap(resourceResult));
          }
        }
 catch (        IOException e) {
          addErrorMessage(methodContext,"IO error loading bsh resource: " + e.getMessage());
        }
 finally {
          if (reader != null) {
            try {
              reader.close();
            }
 catch (            IOException e) {
              addErrorMessage(methodContext,"IO error closing BufferedReader: " + e.getMessage());
            }
          }
        }
      }
    }
    if (Debug.verboseOn())     Debug.logVerbose("Running inline BSH script: " + inline,module);
    Object inlineResult=bsh.eval(inline);
    if (Debug.verboseOn())     Debug.logVerbose("Result of inline BSH script: " + inlineResult,module);
    if ((inlineResult != null) && (inlineResult instanceof Map<?,?>)) {
      methodContext.putAllEnv(UtilGenerics.<String,Object>checkMap(inlineResult));
    }
  }
 catch (  EvalError e) {
    Debug.logError(e,"BeanShell execution caused an error",module);
    addErrorMessage(methodContext,"BeanShell execution caused an error: " + e.getMessage());
  }
  return true;
}
