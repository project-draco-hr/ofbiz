{
  if (UtilValidate.isNotEmpty(postalAddress.getString("postalCodeGeoId"))) {
    return postalAddress.getString("postalCodeGeoId");
  }
  if (UtilValidate.isNotEmpty(postalAddress.getString("countryGeoId")) && UtilValidate.isNotEmpty(postalAddress.getString("postalCode"))) {
    GenericValue geo=delegator.findOne("Geo",UtilMisc.toMap("geoId",postalAddress.getString("countryGeoId") + "-" + postalAddress.getString("postalCode")),true);
    if (geo != null) {
      if (postalAddress.isMutable()) {
        postalAddress.set("postalCodeGeoId",geo.getString("geoId"));
        postalAddress.store();
      }
 else {
        GenericValue mutablePostalAddress=delegator.findOne("PostalAddress",UtilMisc.toMap("contactMechId",postalAddress.getString("contactMechId")),false);
        mutablePostalAddress.set("postalCodeGeoId",geo.getString("geoId"));
        mutablePostalAddress.store();
      }
      return geo.getString("geoId");
    }
    List<GenericValue> geoAssocAndGeoToList=delegator.findByAndCache("GeoAssocAndGeoTo",UtilMisc.toMap("geoIdFrom",postalAddress.getString("countryGeoId"),"geoCode",postalAddress.getString("postalCode"),"geoAssocTypeId","REGIONS"));
    GenericValue geoAssocAndGeoTo=EntityUtil.getFirst(geoAssocAndGeoToList);
    if (geoAssocAndGeoTo != null) {
      if (postalAddress.isMutable()) {
        postalAddress.set("postalCodeGeoId",geoAssocAndGeoTo.getString("geoId"));
        postalAddress.store();
      }
 else {
        GenericValue mutablePostalAddress=delegator.findOne("PostalAddress",UtilMisc.toMap("contactMechId",postalAddress.getString("contactMechId")),false);
        mutablePostalAddress.set("postalCodeGeoId",geoAssocAndGeoTo.getString("geoId"));
        mutablePostalAddress.store();
      }
      return geoAssocAndGeoTo.getString("geoId");
    }
  }
  return null;
}
