{
  HttpServletRequest request=(HttpServletRequest)context.get("request");
  HttpServletResponse response=(HttpServletResponse)context.get("response");
  boolean javaScriptEnabled=UtilHttp.isJavaScriptEnabled(request);
  ModelScreenWidget.Menu tabMenu=screenlet.getTabMenu();
  if (tabMenu != null) {
    tabMenu.renderWidgetString(writer,context,this);
  }
  writer.append("<div class=\"screenlet\"");
  String id=screenlet.getId(context);
  if (UtilValidate.isNotEmpty(id)) {
    writer.append(" id=\"");
    writer.append(id);
    writer.append("\"");
  }
  writer.append(">");
  appendWhitespace(writer);
  String title=screenlet.getTitle(context);
  ModelScreenWidget.Menu navMenu=screenlet.getNavigationMenu();
  ModelScreenWidget.Form navForm=screenlet.getNavigationForm();
  String collapsibleAreaId=null;
  if (UtilValidate.isNotEmpty(title) || navMenu != null || navForm != null || screenlet.collapsible()) {
    writer.append("<div class=\"screenlet-title-bar\">");
    appendWhitespace(writer);
    writer.append("<ul>");
    appendWhitespace(writer);
    if (UtilValidate.isNotEmpty(title)) {
      writer.append("<li class=\"h3\">");
      writer.append(title);
      writer.append("</li>");
      appendWhitespace(writer);
    }
    if (screenlet.collapsible()) {
      collapsibleAreaId=this.getNextElementId();
      String expandToolTip=null;
      String collapseToolTip=null;
      Map<String,Object> uiLabelMap=UtilGenerics.checkMap(context.get("uiLabelMap"));
      Map<String,Object> paramMap=UtilGenerics.checkMap(context.get("requestParameters"));
      Map<String,Object> requestParameters=new HashMap<String,Object>(paramMap);
      if (uiLabelMap != null) {
        expandToolTip=(String)uiLabelMap.get("CommonExpand");
        collapseToolTip=(String)uiLabelMap.get("CommonCollapse");
      }
      writer.append("<li class=\"");
      if (collapsed) {
        writer.append("collapsed\"><a ");
        if (javaScriptEnabled) {
          writer.append("onclick=\"javascript:toggleScreenlet(this, '").append(collapsibleAreaId).append("', '").append(expandToolTip).append("', '").append(collapseToolTip).append("');\"");
        }
 else {
          requestParameters.put(screenlet.getPreferenceKey(context) + "_collapsed","false");
          String queryString=UtilHttp.urlEncodeArgs(requestParameters);
          writer.append("href=\"").append(request.getRequestURI()).append("?").append(queryString).append("\"");
        }
        if (UtilValidate.isNotEmpty(expandToolTip)) {
          writer.append(" title=\"").append(expandToolTip).append("\"");
        }
      }
 else {
        writer.append("expanded\"><a ");
        if (javaScriptEnabled) {
          writer.append("onclick=\"javascript:toggleScreenlet(this, '").append(collapsibleAreaId).append("', '").append(expandToolTip).append("', '").append(collapseToolTip).append("');\"");
        }
 else {
          requestParameters.put(screenlet.getPreferenceKey(context) + "_collapsed","true");
          String queryString=UtilHttp.urlEncodeArgs(requestParameters);
          writer.append("href=\"").append(request.getRequestURI()).append("?").append(queryString).append("\"");
        }
        if (UtilValidate.isNotEmpty(collapseToolTip)) {
          writer.append(" title=\"").append(collapseToolTip).append("\"");
        }
      }
      writer.append(">&nbsp</a></li>");
      appendWhitespace(writer);
    }
    if (!collapsed) {
      if (navMenu != null) {
        MenuStringRenderer savedRenderer=(MenuStringRenderer)context.get("menuStringRenderer");
        MenuStringRenderer renderer=new ScreenletMenuRenderer(request,response);
        context.put("menuStringRenderer",renderer);
        navMenu.renderWidgetString(writer,context,this);
        context.put("menuStringRenderer",savedRenderer);
      }
 else       if (navForm != null) {
        renderScreenletPaginateMenu(writer,context,navForm);
      }
    }
    writer.append("</ul>");
    appendWhitespace(writer);
    writer.append("<br class=\"clear\" />");
    appendWhitespace(writer);
    writer.append("</div>");
    appendWhitespace(writer);
    writer.append("<div");
    if (UtilValidate.isNotEmpty(collapsibleAreaId)) {
      writer.append(" id=\"").append(collapsibleAreaId).append("\"");
      if (collapsed) {
        writer.append(" style=\"display: none;\"");
      }
    }
    if (screenlet.padded()) {
      writer.append(" class=\"screenlet-body\"");
    }
    writer.append(">");
    appendWhitespace(writer);
  }
}
