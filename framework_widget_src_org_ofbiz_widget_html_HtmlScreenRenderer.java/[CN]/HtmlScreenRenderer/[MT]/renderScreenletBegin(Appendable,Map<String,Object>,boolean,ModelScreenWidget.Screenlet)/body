{
  HttpServletRequest request=(HttpServletRequest)context.get("request");
  HttpServletResponse response=(HttpServletResponse)context.get("response");
  ModelScreenWidget.Menu tabMenu=screenlet.getTabMenu();
  if (tabMenu != null) {
    tabMenu.renderWidgetString(writer,context,this);
  }
  writer.append("<div class=\"screenlet\"");
  String id=screenlet.getId(context);
  if (UtilValidate.isNotEmpty(id)) {
    writer.append(" id=\"");
    writer.append(id);
    writer.append("\"");
  }
  writer.append(">");
  appendWhitespace(writer);
  String title=screenlet.getTitle(context);
  ModelScreenWidget.Menu navMenu=screenlet.getNavigationMenu();
  ModelScreenWidget.Form navForm=screenlet.getNavigationForm();
  if (UtilValidate.isNotEmpty(title) || navMenu != null || navForm != null || screenlet.collapsible()) {
    writer.append("<div class=\"screenlet-title-bar\">");
    appendWhitespace(writer);
    writer.append("<ul>");
    appendWhitespace(writer);
    if (UtilValidate.isNotEmpty(title)) {
      writer.append("<li class=\"h3\">");
      writer.append(title);
      writer.append("</li>");
      appendWhitespace(writer);
    }
    if (screenlet.collapsible()) {
      String toolTip=null;
      Map uiLabelMap=(Map)context.get("uiLabelMap");
      Map requestParameters=new HashMap((Map)context.get("requestParameters"));
      writer.append("<li class=\"");
      if (collapsed) {
        requestParameters.put(screenlet.getPreferenceKey(context) + "_collapsed","false");
        String queryString=UtilHttp.urlEncodeArgs(requestParameters);
        writer.append("collapsed\"><a href=\"");
        writer.append(request.getRequestURI() + "?" + queryString);
        if (uiLabelMap != null) {
          toolTip=(String)uiLabelMap.get("CommonExpand");
        }
      }
 else {
        requestParameters.put(screenlet.getPreferenceKey(context) + "_collapsed","true");
        String queryString=UtilHttp.urlEncodeArgs(requestParameters);
        writer.append("expanded\"><a href=\"");
        writer.append(request.getRequestURI() + "?" + queryString);
        if (uiLabelMap != null) {
          toolTip=(String)uiLabelMap.get("CommonCollapse");
        }
      }
      writer.append("\"");
      if (UtilValidate.isNotEmpty(toolTip)) {
        writer.append(" title=\"" + toolTip + "\"");
      }
      writer.append(">&nbsp</a></li>");
      appendWhitespace(writer);
    }
    if (!collapsed) {
      if (navMenu != null) {
        MenuStringRenderer savedRenderer=(MenuStringRenderer)context.get("menuStringRenderer");
        MenuStringRenderer renderer=new ScreenletMenuRenderer(request,response);
        context.put("menuStringRenderer",renderer);
        navMenu.renderWidgetString(writer,context,this);
        context.put("menuStringRenderer",savedRenderer);
      }
 else       if (navForm != null) {
        renderScreenletPaginateMenu(writer,context,navForm);
      }
    }
    writer.append("</ul>");
    appendWhitespace(writer);
    writer.append("<br class=\"clear\" />");
    appendWhitespace(writer);
    writer.append("</div>");
    appendWhitespace(writer);
    if (screenlet.padded()) {
      writer.append("<div class=\"screenlet-body\">");
      appendWhitespace(writer);
    }
  }
}
