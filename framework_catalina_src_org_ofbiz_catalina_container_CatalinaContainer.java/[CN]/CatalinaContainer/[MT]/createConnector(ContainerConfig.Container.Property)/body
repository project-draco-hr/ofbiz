{
  if (embedded == null) {
    throw new ContainerException("Cannot create Connector without Embedded instance!");
  }
  String protocol=ContainerConfig.getPropertyValue(connectorProp,"protocol","HTTP/1.1");
  String address=ContainerConfig.getPropertyValue(connectorProp,"address","0.0.0.0");
  int port=ContainerConfig.getPropertyValue(connectorProp,"port",0);
  boolean secure=ContainerConfig.getPropertyValue(connectorProp,"secure",false);
  if (protocol.toLowerCase().startsWith("ajp")) {
    protocol="ajp";
  }
 else   if ("memory".equals(protocol.toLowerCase())) {
    protocol="memory";
  }
 else   if (secure) {
    protocol="https";
  }
 else {
    protocol="http";
  }
  Connector connector=null;
  if (connectorProp.properties != null && connectorProp.properties.size() > 0) {
    connector=embedded.createConnector(address,port,protocol);
    try {
      Iterator i=connectorProp.properties.values().iterator();
      while (i.hasNext()) {
        ContainerConfig.Container.Property prop=(ContainerConfig.Container.Property)i.next();
        connector.setProperty(prop.name,prop.value);
      }
      embedded.addConnector(connector);
    }
 catch (    Exception e) {
      throw new ContainerException(e);
    }
  }
  return connector;
}
