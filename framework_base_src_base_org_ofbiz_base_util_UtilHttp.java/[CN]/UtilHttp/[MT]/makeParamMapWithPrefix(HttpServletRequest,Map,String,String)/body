{
  Map paramMap=new HashMap();
  Enumeration parameterNames=request.getParameterNames();
  while (parameterNames.hasMoreElements()) {
    String parameterName=(String)parameterNames.nextElement();
    if (parameterName.startsWith(prefix)) {
      if (suffix != null && suffix.length() > 0) {
        if (parameterName.endsWith(suffix)) {
          String key=parameterName.substring(prefix.length(),parameterName.length() - (suffix.length()));
          String value=request.getParameter(parameterName);
          paramMap.put(key,value);
        }
      }
 else {
        String key=parameterName.substring(prefix.length());
        String value=request.getParameter(parameterName);
        paramMap.put(key,value);
      }
    }
  }
  if (additionalFields != null) {
    Iterator i=additionalFields.keySet().iterator();
    while (i.hasNext()) {
      String fieldName=(String)i.next();
      if (fieldName.startsWith(prefix)) {
        if (suffix != null && suffix.length() > 0) {
          if (fieldName.endsWith(suffix)) {
            String key=fieldName.substring(prefix.length(),fieldName.length() - (suffix.length() - 1));
            Object value=additionalFields.get(fieldName);
            paramMap.put(key,value);
            if (!(value instanceof String)) {
              String nameKey="_" + key + "_fileName";
              Object nameVal=additionalFields.get("_" + fieldName + "_fileName");
              if (nameVal != null) {
                paramMap.put(nameKey,nameVal);
              }
              String typeKey="_" + key + "_contentType";
              Object typeVal=additionalFields.get("_" + fieldName + "_contentType");
              if (typeVal != null) {
                paramMap.put(typeKey,typeVal);
              }
              String sizeKey="_" + key + "_size";
              Object sizeVal=additionalFields.get("_" + fieldName + "_size");
              if (sizeVal != null) {
                paramMap.put(sizeKey,sizeVal);
              }
            }
          }
        }
 else {
          String key=fieldName.substring(prefix.length());
          Object value=additionalFields.get(fieldName);
          paramMap.put(key,value);
          if (!(value instanceof String)) {
            String nameKey="_" + key + "_fileName";
            Object nameVal=additionalFields.get("_" + fieldName + "_fileName");
            if (nameVal != null) {
              paramMap.put(nameKey,nameVal);
            }
            String typeKey="_" + key + "_contentType";
            Object typeVal=additionalFields.get("_" + fieldName + "_contentType");
            if (typeVal != null) {
              paramMap.put(typeKey,typeVal);
            }
            String sizeKey="_" + key + "_size";
            Object sizeVal=additionalFields.get("_" + fieldName + "_size");
            if (sizeVal != null) {
              paramMap.put(sizeKey,sizeVal);
            }
          }
        }
      }
    }
  }
  return paramMap;
}
