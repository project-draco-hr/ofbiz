{
  try {
    Debug.logInfo("correctCityStateCountry params: " + city + ", "+ state+ ", "+ country,module);
    String geoId="USA";
    if (country.indexOf("UNITED STATES") > -1 || country.indexOf("USA") > -1)     country="US";
    Debug.logInfo("GeoCode: " + country,module);
    Map outMap=getCountryGeoId(dispatcher.getDelegator(),country);
    geoId=(String)outMap.get("geoId");
    map.put("countryGeoId",geoId);
    Debug.logInfo("Country geoid: " + geoId,module);
    if (geoId.equals("USA") || geoId.equals("CAN")) {
      if (state.length() > 0) {
        map.put("stateProvinceGeoId",state);
      }
      map.put("city",city);
    }
 else {
      map.put("city",city + ", " + state);
    }
    Debug.logInfo("State geoid: " + state,module);
  }
 catch (  Exception e) {
    Debug.logError(e,"Failed to correctCityStateCountry",module);
  }
}
