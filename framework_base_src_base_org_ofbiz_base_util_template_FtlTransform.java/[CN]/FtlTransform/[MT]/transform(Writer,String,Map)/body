{
  Template template=(Template)ftlTemplatesCache.get(path);
  if (template == null) {
    template=getTemplate(path);
    if (template != null) {
      ftlTemplatesCache.put(path,template);
    }
  }
  SimpleHash templateContext=new SimpleHash();
  templateContext.putAll(templateRoot);
  if (params != null) {
    Set entrySet=params.entrySet();
    Iterator iter=entrySet.iterator();
    while (iter.hasNext()) {
      Map.Entry entry=(Map.Entry)iter.next();
      String key=(String)entry.getKey();
      Object val=entry.getValue();
      if (val != null) {
        templateContext.put(key,val);
      }
    }
  }
  template.process(templateContext,writer);
}
