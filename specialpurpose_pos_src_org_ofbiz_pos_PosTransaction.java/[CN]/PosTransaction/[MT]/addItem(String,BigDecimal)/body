{
  trace("add item",productId + "/" + quantity);
  try {
    Delegator delegator=cart.getDelegator();
    GenericValue product=null;
    ProductConfigWrapper pcw=null;
    product=delegator.findByPrimaryKeyCache("Product",UtilMisc.toMap("productId",productId));
    if (UtilValidate.isNotEmpty(product) && ("AGGREGATED".equals(product.getString("productTypeId")) || "AGGREGATED_SERVICE".equals(product.getString("productTypeId")))) {
      pcw=new ProductConfigWrapper(delegator,session.getDispatcher(),productId,null,null,null,null,null,null);
      pcw.setDefaultConfig();
    }
    cart.addOrIncreaseItem(productId,null,quantity,null,null,null,null,null,null,null,null,pcw,null,null,null,session.getDispatcher());
  }
 catch (  ItemNotFoundException e) {
    trace("item not found",e);
    throw e;
  }
catch (  CartItemModifyException e) {
    trace("add item error",e);
    throw e;
  }
catch (  GenericEntityException e) {
    trace("item lookup error",e);
    Debug.logError(e,module);
  }
catch (  Exception e) {
    trace("general exception",e);
    Debug.logError(e,module);
  }
}
