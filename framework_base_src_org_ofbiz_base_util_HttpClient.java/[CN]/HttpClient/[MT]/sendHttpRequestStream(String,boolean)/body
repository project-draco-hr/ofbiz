{
  SSLUtil.loadJsseProperties();
  String arguments=null;
  InputStream in=null;
  if (url == null) {
    throw new HttpClientException("Cannot process a null URL.");
  }
  if (rawStream != null) {
    arguments=rawStream;
  }
 else   if (parameters != null && parameters.size() > 0) {
    arguments=UtilHttp.urlEncodeArgs(parameters,false);
  }
  if (method.equalsIgnoreCase("get") && arguments != null) {
    if (url.contains("?")) {
      url=url + "&" + arguments;
    }
 else {
      url=url + "?" + arguments;
    }
  }
  try {
    requestUrl=new URL(url);
    if (overrideTrust) {
      con=URLConnector.openUntrustedConnection(requestUrl,timeout,clientCertAlias,hostVerification);
    }
 else {
      con=URLConnector.openConnection(requestUrl,timeout,clientCertAlias,hostVerification);
    }
    if (Debug.verboseOn() || debug)     Debug.log("Connection opened to : " + requestUrl.toExternalForm(),module);
    if ((con instanceof HttpURLConnection)) {
      ((HttpURLConnection)con).setInstanceFollowRedirects(followRedirects);
      if (Debug.verboseOn() || debug)       Debug.log("Connection is of type HttpURLConnection, more specifically: " + con.getClass().getName(),module);
    }
    if (contentType != null) {
      con.setRequestProperty("Content-type",contentType);
    }
    con.setDoOutput(true);
    con.setUseCaches(false);
    if (keepAlive) {
      con.setRequestProperty("Connection","Keep-Alive");
    }
    if (method.equalsIgnoreCase("post")) {
      if (contentType == null) {
        con.setRequestProperty("Content-type","application/x-www-form-urlencoded");
      }
      con.setDoInput(true);
    }
    if (basicAuthUsername != null) {
      String basicAuthString="Basic " + Base64.base64Encode(basicAuthUsername + ":" + (basicAuthPassword == null ? "" : basicAuthPassword));
      con.setRequestProperty("Authorization",basicAuthString);
      if (Debug.verboseOn() || debug)       Debug.log("Header - Authorization: " + basicAuthString,module);
    }
    if (headers != null && headers.size() > 0) {
      for (      Map.Entry<String,String> entry : headers.entrySet()) {
        String headerName=entry.getKey();
        String headerValue=entry.getValue();
        con.setRequestProperty(headerName,headerValue);
        if (Debug.verboseOn() || debug)         Debug.log("Header - " + headerName + ": "+ headerValue,module);
      }
    }
    if (method.equalsIgnoreCase("post")) {
      DataOutputStream out=new DataOutputStream(con.getOutputStream());
      if (Debug.verboseOn() || debug)       Debug.log("Opened output stream",module);
      if (arguments != null) {
        out.writeBytes(arguments);
        if (Debug.verboseOn() || debug)         Debug.log("Wrote arguements (parameters) : " + arguments,module);
      }
      out.flush();
      out.close();
      if (Debug.verboseOn() || debug)       Debug.log("Flushed and closed buffer",module);
    }
    if (Debug.verboseOn() || debug) {
      Map headerFields=con.getHeaderFields();
      Debug.log("Header Fields : " + headerFields,module);
    }
    in=con.getInputStream();
  }
 catch (  IOException ioe) {
    if ((trustAny && !overrideTrust) && (ioe.getCause() instanceof CertificateException)) {
      Debug.logWarning(ioe.getCause(),module);
      return sendHttpRequestStream(method,true);
    }
    throw new HttpClientException("IO Error processing request",ioe);
  }
catch (  Exception e) {
    throw new HttpClientException("Error processing request",e);
  }
  return in;
}
