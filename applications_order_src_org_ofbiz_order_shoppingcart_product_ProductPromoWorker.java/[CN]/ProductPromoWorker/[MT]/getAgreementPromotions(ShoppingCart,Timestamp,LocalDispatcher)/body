{
  List<GenericValue> productPromoList=FastList.newInstance();
  Delegator delegator=cart.getDelegator();
  String agreementId=cart.getAgreementId();
  GenericValue agreement=null;
  try {
    agreement=delegator.findByPrimaryKeyCache("Agreement",UtilMisc.toMap("agreementId",agreementId));
  }
 catch (  GenericEntityException e) {
    Debug.logError(e,"Error looking up agreement with id " + agreementId,module);
  }
  if (agreement == null) {
    Debug.logWarning(UtilProperties.getMessage(resource_error,"OrderNoAgreementFoundWithIdNotDoingPromotions",UtilMisc.toMap("agreementId",agreementId),cart.getLocale()),module);
    return productPromoList;
  }
  GenericValue agreementItem=null;
  try {
    List<GenericValue> agreementItems=delegator.findByAndCache("AgreementItem",UtilMisc.toMap("agreementId",agreementId,"agreementItemTypeId","AGREEMENT_PRICING_PR","currencyUomId",cart.getCurrency()));
    agreementItem=EntityUtil.getFirst(agreementItems);
  }
 catch (  GenericEntityException e) {
    Debug.logError(e,"Error looking up agreement items for agreement with id " + agreementId,module);
  }
  if (agreementItem == null) {
    Debug.logWarning(UtilProperties.getMessage(resource_error,"OrderNoAgreementItemFoundForAgreementWithIdNotDoingPromotions",UtilMisc.toMap("agreementId",agreementId),cart.getLocale()),module);
    return productPromoList;
  }
  try {
    List<GenericValue> agreementPromoApplsList=agreementItem.getRelatedCache("AgreementPromoAppl",null,UtilMisc.toList("sequenceNum"));
    agreementPromoApplsList=EntityUtil.filterByDate(agreementPromoApplsList,nowTimestamp);
    if (UtilValidate.isEmpty(agreementPromoApplsList)) {
      if (Debug.verboseOn())       Debug.logVerbose("Not doing promotions, none applied to agreement with ID " + agreementId,module);
    }
    Iterator<GenericValue> agreementPromoAppls=UtilMisc.toIterator(agreementPromoApplsList);
    while (agreementPromoAppls != null && agreementPromoAppls.hasNext()) {
      GenericValue agreementPromoAppl=agreementPromoAppls.next();
      GenericValue productPromo=agreementPromoAppl.getRelatedOneCache("ProductPromo");
      productPromoList.add(productPromo);
    }
  }
 catch (  GenericEntityException e) {
    Debug.logError(e,"Error looking up promotion data while doing promotions",module);
  }
  return productPromoList;
}
