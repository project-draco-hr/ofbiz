{
  Iterator<String> productCategoryIdIter=productCategoryIdSet.iterator();
  while (productCategoryIdIter.hasNext()) {
    String productCategoryId=productCategoryIdIter.next();
    List<GenericValue> productCategoryMembers=delegator.findByAndCache("ProductCategoryMember",UtilMisc.toMap("productCategoryId",productCategoryId));
    productCategoryMembers=EntityUtil.filterByDate(productCategoryMembers,nowTimestamp);
    Iterator<GenericValue> productCategoryMemberIter=productCategoryMembers.iterator();
    while (productCategoryMemberIter.hasNext()) {
      GenericValue productCategoryMember=productCategoryMemberIter.next();
      String productId=productCategoryMember.getString("productId");
      if (include) {
        productIdSet.add(productId);
      }
 else {
        productIdSet.remove(productId);
      }
    }
  }
}
