{
  Map tempGroup=new HashMap();
  Map group=new LinkedMap();
  String orderKey=(String)order.get(index);
  if (featureList == null) {
    throw new IllegalArgumentException("Cannot build feature tree: featureList is null");
  }
  if (index < 0) {
    throw new IllegalArgumentException("Invalid index '" + index + "' min index '0'");
  }
  if (index + 1 > order.size()) {
    throw new IllegalArgumentException("Invalid index '" + index + "' max index '"+ (order.size() - 1)+ "'");
  }
  Iterator itemIterator=items.iterator();
  while (itemIterator.hasNext()) {
    String thisItem=(String)itemIterator.next();
    if (Debug.verboseOn())     Debug.logVerbose("ThisItem: " + thisItem,module);
    List features=null;
    try {
      Map fields=UtilMisc.toMap("productId",thisItem,"productFeatureTypeId",orderKey,"productFeatureApplTypeId","STANDARD_FEATURE");
      List sort=UtilMisc.toList("sequenceNum");
      features=delegator.findByAndCache("ProductFeatureAndAppl",fields,sort);
      features=EntityUtil.filterByDate(features,true);
    }
 catch (    GenericEntityException e) {
      throw new IllegalStateException("Problem reading relation: " + e.getMessage());
    }
    if (Debug.verboseOn())     Debug.logVerbose("Features: " + features,module);
    Iterator featuresIterator=features.iterator();
    while (featuresIterator.hasNext()) {
      GenericValue item=(GenericValue)featuresIterator.next();
      Object itemKey=item.get("description");
      if (tempGroup.containsKey(itemKey)) {
        List itemList=(List)tempGroup.get(itemKey);
        if (!itemList.contains(thisItem))         itemList.add(thisItem);
      }
 else {
        List itemList=UtilMisc.toList(thisItem);
        tempGroup.put(itemKey,itemList);
      }
    }
  }
  if (Debug.verboseOn())   Debug.logVerbose("TempGroup: " + tempGroup,module);
  List orderFeatureList=(List)featureList.get(orderKey);
  if (orderFeatureList == null) {
    throw new IllegalArgumentException("Cannot build feature tree: orderFeatureList is null for orderKey=" + orderKey);
  }
  Iterator featureListIt=orderFeatureList.iterator();
  while (featureListIt.hasNext()) {
    String featureStr=(String)featureListIt.next();
    if (tempGroup.containsKey(featureStr))     group.put(featureStr,tempGroup.get(featureStr));
  }
  if (Debug.verboseOn())   Debug.logVerbose("Group: " + group,module);
  if (group.size() == 0) {
    return group;
  }
  if (index + 1 == order.size()) {
    return group;
  }
  Iterator groupIterator=group.keySet().iterator();
  while (groupIterator.hasNext()) {
    Object key=groupIterator.next();
    List itemList=(List)group.get(key);
    if (itemList != null && itemList.size() > 0) {
      Map subGroup=makeGroup(delegator,featureList,itemList,order,index + 1);
      group.put(key,subGroup);
    }
 else {
    }
  }
  return group;
}
