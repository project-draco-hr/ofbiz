{
  String dataResourceMimeTypeId=dataResource.getString("mimeTypeId");
  GenericDelegator delegator=dataResource.getDelegator();
  if (UtilValidate.isEmpty(dataResourceMimeTypeId)) {
    dataResourceMimeTypeId="text/html";
  }
  if (UtilValidate.isEmpty(targetMimeTypeId)) {
    targetMimeTypeId="text/html";
  }
  if (!targetMimeTypeId.startsWith("text")) {
    throw new GeneralException("Method writeText() only supports rendering text content : " + targetMimeTypeId + " is not supported");
  }
  if ("text/html".equals(targetMimeTypeId)) {
    GenericValue mimeTypeTemplate=delegator.findByPrimaryKeyCache("MimeTypeHtmlTemplate",UtilMisc.toMap("mimeTypeId",dataResourceMimeTypeId));
    if (mimeTypeTemplate != null && mimeTypeTemplate.get("templateLocation") != null) {
      Map mimeContext=FastMap.newInstance();
      mimeContext.putAll(context);
      mimeContext.put("dataResource",dataResource);
      mimeContext.put("textData",textData);
      String mimeString=DataResourceWorker.renderMimeTypeTemplate(mimeTypeTemplate,context);
      out.write(mimeString);
    }
 else {
      out.write(textData);
    }
  }
 else   if ("text/plain".equals(targetMimeTypeId)) {
    out.write(textData);
  }
}
