{
  PackingSession session=(PackingSession)context.get("packingSession");
  Locale locale=(Locale)context.get("locale");
  String orderId=(String)context.get("orderId");
  String shipmentId=(String)context.get("shipmentId");
  String invoiceId=(String)context.get("invoiceId");
  String instructions=(String)context.get("handlingInstructions");
  String pickerPartyId=(String)context.get("pickerPartyId");
  BigDecimal additionalShippingCharge=(BigDecimal)context.get("additionalShippingCharge");
  Map<String,String> packageWeights=UtilGenerics.checkMap(context.get("packageWeights"));
  String weightUomId=(String)context.get("weightUomId");
  session.setShipmentId(shipmentId);
  session.setInvoiceId(invoiceId);
  session.setHandlingInstructions(instructions);
  session.setPickerPartyId(pickerPartyId);
  session.setAdditionalShippingCharge(additionalShippingCharge);
  session.setWeightUomId(weightUomId);
  setSessionPackageWeights(session,packageWeights);
  Boolean force=(Boolean)context.get("forceComplete");
  if (force == null) {
    force=Boolean.FALSE;
  }
  try {
    shipmentId=session.complete(force,orderId,locale);
  }
 catch (  GeneralException e) {
    Debug.logError(e,module);
    return ServiceUtil.returnError(e.getMessage(),e.getMessageList());
  }
  Map<String,Object> resp;
  if ("EMPTY".equals(shipmentId)) {
    resp=ServiceUtil.returnError("No items currently set to be shipped. Cannot complete!");
  }
 else {
    resp=ServiceUtil.returnSuccess("Shipment #" + shipmentId + " created and marked as PACKED.");
  }
  resp.put("shipmentId",shipmentId);
  return resp;
}
