{
  PackingSession session=(PackingSession)context.get("packingSession");
  String instructions=(String)context.get("handlingInstructions");
  String pickerPartyId=(String)context.get("pickerPartyId");
  Double additionalShippingCharge=(Double)context.get("additionalShippingCharge");
  Map packageWeights=(Map)context.get("packageWeights");
  String weightUomId=(String)context.get("weightUomId");
  session.setHandlingInstructions(instructions);
  session.setPickerPartyId(pickerPartyId);
  session.setAdditionalShippingCharge(additionalShippingCharge);
  session.setWeightUomId(weightUomId);
  setSessionPackageWeights(session,packageWeights);
  Boolean force=(Boolean)context.get("forceComplete");
  if (force == null) {
    force=Boolean.FALSE;
  }
  String shipmentId=null;
  try {
    shipmentId=session.complete(force.booleanValue());
  }
 catch (  GeneralException e) {
    Debug.logError(e,module);
    return ServiceUtil.returnError(e.getMessage(),e.getMessageList());
  }
  Map resp;
  if ("EMPTY".equals(shipmentId)) {
    resp=ServiceUtil.returnError("No items currently set to be shipped. Cannot complete!");
  }
 else {
    resp=ServiceUtil.returnSuccess("Shipment #" + shipmentId + " created and marked as PACKED.");
  }
  resp.put("shipmentId",shipmentId);
  return resp;
}
