{
  String settingPrefix=isSalesTax ? "salestax" : "order";
  String decimalsPrefix=isSalesTax ? ".calc" : "";
  int decimals=UtilNumber.getBigDecimalScale(settingPrefix + decimalsPrefix + ".decimals");
  int rounding=UtilNumber.getBigDecimalRoundingMode(settingPrefix + ".rounding");
  int finalDecimals=isSalesTax ? UtilNumber.getBigDecimalScale(settingPrefix + ".final.decimals") : decimals;
  returnTotal=returnTotal.setScale(decimals,rounding);
  originalTotal=originalTotal.setScale(decimals,rounding);
  BigDecimal newAmount=returnTotal.divide(originalTotal,decimals,rounding).multiply(amount).setScale(finalDecimals,rounding);
  return new Double(newAmount.doubleValue());
}
