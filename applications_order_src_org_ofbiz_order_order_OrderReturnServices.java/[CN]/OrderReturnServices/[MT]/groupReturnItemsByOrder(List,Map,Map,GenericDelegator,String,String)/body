{
  Iterator itemIt=returnItems.iterator();
  while (itemIt.hasNext()) {
    GenericValue returnItem=(GenericValue)itemIt.next();
    String orderId=returnItem.getString("orderId");
    if (orderId != null) {
      if (returnItemsByOrderId != null) {
        Double totalForOrder=null;
        if (totalByOrder != null) {
          totalForOrder=(Double)totalByOrder.get(orderId);
        }
        List returnItemList=(List)returnItemsByOrderId.get(orderId);
        if (returnItemList == null) {
          returnItemList=new ArrayList();
        }
        if (totalForOrder == null) {
          totalForOrder=new Double(0.00);
        }
        returnItemList.add(returnItem);
        returnItemsByOrderId.put(orderId,returnItemList);
        if (totalByOrder != null) {
          Double quantity=returnItem.getDouble("returnQuantity");
          Double amount=returnItem.getDouble("returnPrice");
          if (quantity == null) {
            quantity=new Double(0);
          }
          if (amount == null) {
            amount=new Double(0.00);
          }
          double thisTotal=amount.doubleValue() * quantity.doubleValue();
          double existingTotal=totalForOrder.doubleValue();
          Map condition=UtilMisc.toMap("returnId",returnItem.get("returnId"),"returnItemSeqId",returnItem.get("returnItemSeqId"));
          Double newTotal=new Double(existingTotal + thisTotal + getReturnAdjustmentTotal(delegator,condition));
          totalByOrder.put(orderId,newTotal);
        }
      }
    }
  }
  if ((totalByOrder != null) && (totalByOrder.keySet() != null)) {
    Iterator orderIterator=totalByOrder.keySet().iterator();
    while (orderIterator.hasNext()) {
      String orderId=(String)orderIterator.next();
      Map condition=UtilMisc.toMap("returnId",returnId,"returnItemSeqId",org.ofbiz.common.DataModelConstants.SEQ_ID_NA,"returnTypeId",returnTypeId);
      double existingTotal=((Double)totalByOrder.get(orderId)).doubleValue() + getReturnAdjustmentTotal(delegator,condition);
      totalByOrder.put(orderId,new Double(existingTotal));
    }
  }
}
