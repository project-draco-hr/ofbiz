{
  PosTransaction trans=PosTransaction.getCurrentTx(this.getSession());
  if (trans == null) {
    updateOutput=false;
  }
  appFrame.requestFocus();
  this.lockScreenButton(this);
  if (!isLocked) {
    this.setEnabled(true);
    this.setVisible(true);
    journal.refresh(this);
    input.clearInput();
    operator.refresh();
    if (updateOutput) {
      if (input.isFunctionSet("PAID")) {
        output.print(UtilProperties.getMessage(PosTransaction.resource,"PosChange",defaultLocale) + UtilFormatOut.formatPrice(trans.getTotalDue().negate()));
      }
 else       if (input.isFunctionSet("TOTAL")) {
        if (trans.getTotalDue().compareTo(BigDecimal.ZERO) > 0) {
          output.print(UtilProperties.getMessage(PosTransaction.resource,"PosTotalD",defaultLocale) + " " + UtilFormatOut.formatPrice(trans.getTotalDue()));
        }
 else {
          output.print(UtilProperties.getMessage(PosTransaction.resource,"PosPayFin",defaultLocale));
        }
      }
 else {
        if (PosTransaction.getCurrentTx(session).isOpen()) {
          output.print(UtilProperties.getMessage(PosTransaction.resource,"PosIsOpen",defaultLocale));
        }
 else {
          output.print(UtilProperties.getMessage(PosTransaction.resource,"PosIsClosed",defaultLocale));
        }
      }
    }
 else {
      promoStatusBar.clear();
    }
  }
 else {
    output.print(UtilProperties.getMessage(PosTransaction.resource,"PosULogin",defaultLocale));
  }
  this.repaint();
}
