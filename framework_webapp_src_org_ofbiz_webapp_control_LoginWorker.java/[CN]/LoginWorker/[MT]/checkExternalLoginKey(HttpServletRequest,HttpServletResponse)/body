{
  HttpSession session=request.getSession();
  String externalKey=request.getParameter(LoginWorker.EXTERNAL_LOGIN_KEY_ATTR);
  if (externalKey == null)   return "success";
  GenericValue userLogin=LoginWorker.externalLoginKeys.get(externalKey);
  if (userLogin != null) {
    LocalDispatcher dispatcher=(LocalDispatcher)request.getAttribute("dispatcher");
    Delegator delegator=(Delegator)request.getAttribute("delegator");
    String oldDelegatorName=delegator.getDelegatorName();
    ServletContext servletContext=session.getServletContext();
    if (!oldDelegatorName.equals(userLogin.getDelegator().getDelegatorName())) {
      delegator=DelegatorFactory.getDelegator(userLogin.getDelegator().getDelegatorName());
      dispatcher=ContextFilter.makeWebappDispatcher(servletContext,delegator);
      setWebContextObjects(request,response,delegator,dispatcher,true);
    }
    GenericValue currentUserLogin=(GenericValue)session.getAttribute("userLogin");
    if (currentUserLogin != null) {
      if (currentUserLogin.getString("userLoginId").equals(userLogin.getString("userLoginId"))) {
        return "success";
      }
      logout(request,response);
    }
    doBasicLogin(userLogin,request);
  }
 else {
    Debug.logWarning("Could not find userLogin for external login key: " + externalKey,module);
  }
  return "success";
}
