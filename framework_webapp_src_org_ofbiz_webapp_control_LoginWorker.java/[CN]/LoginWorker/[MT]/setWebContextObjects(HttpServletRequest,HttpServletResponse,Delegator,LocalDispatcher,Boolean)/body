{
  HttpSession session=request.getSession();
  session.setAttribute("delegatorName",delegator.getDelegatorName());
  request.setAttribute("delegator",delegator);
  if (!persistSerialized) {
    session.setAttribute("delegator",null);
  }
 else {
    session.setAttribute("delegator",delegator);
  }
  request.setAttribute("dispatcher",dispatcher);
  if (!persistSerialized) {
    session.setAttribute("dispatcher",null);
  }
 else {
    session.setAttribute("dispatcher",dispatcher);
  }
  if (persistSerialized) {
    try {
      Security security=SecurityFactory.getInstance(delegator);
      request.setAttribute("security",security);
      session.setAttribute("security",security);
    }
 catch (    SecurityConfigurationException e) {
      Debug.logError(e,module);
    }
    try {
      Authorization authz=AuthorizationFactory.getInstance(delegator);
      request.setAttribute("authz",authz);
      session.setAttribute("authz",authz);
    }
 catch (    SecurityConfigurationException e) {
      Debug.logError(e,module);
    }
  }
  session.removeAttribute("visitor");
  session.removeAttribute("visit");
  VisitHandler.getVisitor(request,response);
  VisitHandler.getVisit(session);
}
