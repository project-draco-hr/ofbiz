{
  GenericDelegator delegator=ctx.getDelegator();
  Security security=ctx.getSecurity();
  GenericValue userLogin=(GenericValue)context.get("userLogin");
  Locale locale=(Locale)context.get("locale");
  String partyId=(String)context.get("partyId");
  String dataSourceId=(String)context.get("dataSourceId");
  Timestamp fromDate=(Timestamp)context.get("fromDate");
  if (fromDate == null)   fromDate=UtilDateTime.nowTimestamp();
  if (!security.hasEntityPermission("PARTYMGR","_SRC_CREATE",userLogin)) {
    String errorMsg=UtilProperties.getMessage(ServiceUtil.resource,"serviceUtil.no_permission_to_operation",locale) + ".";
    return ServiceUtil.returnError(errorMsg);
  }
  try {
    GenericValue party=delegator.findByPrimaryKey("Party",UtilMisc.toMap("partyId",partyId));
    GenericValue dataSource=delegator.findByPrimaryKey("DataSource",UtilMisc.toMap("dataSourceId",dataSourceId));
    if (party == null || dataSource == null) {
      List errorList=UtilMisc.toList("Cannot create PartyDataSource");
      if (party == null)       errorList.add("party with ID [" + partyId + "] was not found ");
      if (dataSource == null)       errorList.add("data source with ID [" + dataSourceId + "] was not found ");
      return ServiceUtil.returnError(errorList);
    }
    GenericValue partyDataSource=delegator.makeValue("PartyDataSource",UtilMisc.toMap("partyId",partyId,"dataSourceId",dataSourceId,"fromDate",fromDate));
    partyDataSource.create();
  }
 catch (  GenericEntityException e) {
    Debug.logError(e,e.getMessage(),module);
    return ServiceUtil.returnError(e.getMessage());
  }
  return ServiceUtil.returnSuccess();
}
