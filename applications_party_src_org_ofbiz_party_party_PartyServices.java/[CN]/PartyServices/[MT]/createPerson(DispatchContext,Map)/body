{
  Map result=new HashMap();
  GenericDelegator delegator=ctx.getDelegator();
  Timestamp now=UtilDateTime.nowTimestamp();
  List toBeStored=new LinkedList();
  Locale locale=(Locale)context.get("locale");
  GenericValue userLogin=(GenericValue)context.get("userLogin");
  String partyId=(String)context.get("partyId");
  String description=(String)context.get("description");
  if (partyId != null && partyId.length() > 0 && Character.isDigit(partyId.charAt(0))) {
    return ServiceUtil.returnError(UtilProperties.getMessage(resource,"party.id_is_digit",locale));
  }
  if (partyId == null || partyId.length() == 0) {
    try {
      partyId=delegator.getNextSeqId("Party");
    }
 catch (    IllegalArgumentException e) {
      return ServiceUtil.returnError(UtilProperties.getMessage(resource,"party.id_generation_failure",locale));
    }
  }
  GenericValue party=null;
  try {
    party=delegator.findByPrimaryKey("Party",UtilMisc.toMap("partyId",partyId));
  }
 catch (  GenericEntityException e) {
    Debug.logWarning(e.getMessage(),module);
  }
  if (party != null) {
    if (!"PERSON".equals(party.getString("partyTypeId"))) {
      return ServiceUtil.returnError(UtilProperties.getMessage(resource,"person.create.party_exists_not_person_type",locale));
    }
  }
 else {
    String statusId=(String)context.get("statusId");
    if (statusId == null) {
      statusId="PARTY_ENABLED";
    }
    Map newPartyMap=UtilMisc.toMap("partyId",partyId,"partyTypeId","PERSON","description",description,"createdDate",now,"lastModifiedDate",now,"statusId",statusId);
    if (userLogin != null) {
      newPartyMap.put("createdByUserLogin",userLogin.get("userLoginId"));
      newPartyMap.put("lastModifiedByUserLogin",userLogin.get("userLoginId"));
    }
    party=delegator.makeValue("Party",newPartyMap);
    toBeStored.add(party);
    GenericValue statusRec=delegator.makeValue("PartyStatus",UtilMisc.toMap("partyId",partyId,"statusId",statusId,"statusDate",now));
    toBeStored.add(statusRec);
  }
  GenericValue person=null;
  try {
    person=delegator.findByPrimaryKey("Person",UtilMisc.toMap("partyId",partyId));
  }
 catch (  GenericEntityException e) {
    Debug.logWarning(e.getMessage(),module);
  }
  if (person != null) {
    return ServiceUtil.returnError(UtilProperties.getMessage(resource,"person.create.person_exists",locale));
  }
  person=delegator.makeValue("Person",UtilMisc.toMap("partyId",partyId));
  person.setNonPKFields(context);
  toBeStored.add(person);
  try {
    delegator.storeAll(toBeStored);
  }
 catch (  GenericEntityException e) {
    Debug.logWarning(e.getMessage(),module);
    return ServiceUtil.returnError(UtilProperties.getMessage(resource,"person.create.db_error",new Object[]{e.getMessage()},locale));
  }
  result.put("partyId",partyId);
  result.put(ModelService.RESPONSE_MESSAGE,ModelService.RESPOND_SUCCESS);
  return result;
}
