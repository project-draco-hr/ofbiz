{
  Set<String> geoIdSet=FastSet.newInstance();
  if (shippingAddress != null) {
    if (UtilValidate.isNotEmpty(shippingAddress.getString("countryGeoId"))) {
      geoIdSet.add(shippingAddress.getString("countryGeoId"));
    }
    if (UtilValidate.isNotEmpty(shippingAddress.getString("stateProvinceGeoId"))) {
      geoIdSet.add(shippingAddress.getString("stateProvinceGeoId"));
    }
    if (UtilValidate.isNotEmpty(shippingAddress.getString("countyGeoId"))) {
      geoIdSet.add(shippingAddress.getString("countyGeoId"));
    }
    String postalCodeGeoId=ContactMechWorker.getPostalAddressPostalCodeGeoId(shippingAddress,delegator);
    if (UtilValidate.isNotEmpty(postalCodeGeoId)) {
      geoIdSet.add(postalCodeGeoId);
    }
  }
 else {
    Debug.logWarning("shippingAddress was null, adding nothing to taxAuthoritySet",module);
  }
  geoIdSet=GeoWorker.expandGeoRegionDeep(geoIdSet,delegator);
  List<GenericValue> taxAuthorityRawList=delegator.findList("TaxAuthority",EntityCondition.makeCondition("taxAuthGeoId",EntityOperator.IN,geoIdSet),null,null,null,true);
  taxAuthoritySet.addAll(taxAuthorityRawList);
}
