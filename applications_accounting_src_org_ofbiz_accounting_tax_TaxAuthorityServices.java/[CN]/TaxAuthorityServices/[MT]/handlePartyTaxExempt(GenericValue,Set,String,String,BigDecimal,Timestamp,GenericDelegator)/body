{
  Debug.logInfo("Checking for tax exemption : " + taxAuthGeoId + " / "+ taxAuthPartyId,module);
  List ptiConditionList=UtilMisc.toList(EntityCondition.makeCondition("partyId",EntityOperator.IN,billToPartyIdSet),EntityCondition.makeCondition("taxAuthGeoId",EntityOperator.EQUALS,taxAuthGeoId),EntityCondition.makeCondition("taxAuthPartyId",EntityOperator.EQUALS,taxAuthPartyId));
  ptiConditionList.add(EntityCondition.makeCondition("fromDate",EntityOperator.LESS_THAN_EQUAL_TO,nowTimestamp));
  ptiConditionList.add(EntityCondition.makeCondition(EntityCondition.makeCondition("thruDate",EntityOperator.EQUALS,null),EntityOperator.OR,EntityCondition.makeCondition("thruDate",EntityOperator.GREATER_THAN,nowTimestamp)));
  EntityCondition ptiCondition=EntityCondition.makeCondition(ptiConditionList,EntityOperator.AND);
  List partyTaxInfos=delegator.findList("PartyTaxAuthInfo",ptiCondition,null,UtilMisc.toList("-fromDate"),null,false);
  boolean foundExemption=false;
  if (partyTaxInfos.size() > 0) {
    GenericValue partyTaxInfo=(GenericValue)partyTaxInfos.get(0);
    adjValue.set("customerReferenceId",partyTaxInfo.get("partyTaxId"));
    if ("Y".equals(partyTaxInfo.getString("isExempt"))) {
      adjValue.set("amount",new Double(0));
      adjValue.set("exemptAmount",taxAmount);
      foundExemption=true;
    }
  }
  if (!foundExemption) {
    List taxAuthorityAssocList=delegator.findByAndCache("TaxAuthorityAssoc",UtilMisc.toMap("toTaxAuthGeoId",taxAuthGeoId,"toTaxAuthPartyId",taxAuthPartyId,"taxAuthorityAssocTypeId","EXEMPT_INHER"),UtilMisc.toList("-fromDate"));
    taxAuthorityAssocList=EntityUtil.filterByDate(taxAuthorityAssocList,true);
    GenericValue taxAuthorityAssoc=EntityUtil.getFirst(taxAuthorityAssocList);
    if (taxAuthorityAssoc != null) {
      handlePartyTaxExempt(adjValue,billToPartyIdSet,taxAuthorityAssoc.getString("taxAuthGeoId"),taxAuthorityAssoc.getString("taxAuthPartyId"),taxAmount,nowTimestamp,delegator);
    }
  }
}
