{
  Writer writer=new StringWriter();
  try {
    wrapper.render(page,request,response,writer,null,false);
  }
 catch (  Throwable t) {
    throw new ViewHandlerException("Problems with the response writer/output stream",t);
  }
  if (Debug.verboseOn()) {
    Debug.logVerbose("XSL-FO : " + writer.toString(),module);
  }
  ByteArrayOutputStream out=null;
  Reader reader=new StringReader(writer.toString());
  Source src=new StreamSource(reader);
  try {
    ApacheFopWorker.transform(src,out,null,contentType);
  }
 catch (  GeneralException e) {
    throw new ViewHandlerException(e.getMessage(),e.getNested());
  }
  response.setContentType(contentType);
  response.setContentLength(out.size());
  try {
    out.writeTo(response.getOutputStream());
    response.getOutputStream().flush();
  }
 catch (  IOException e) {
    throw new ViewHandlerException("Unable write to browser OutputStream",e);
  }
}
