{
  HttpSession session=request.getSession();
  Locale locale=UtilHttp.getLocale(request);
  Map<String,Object> syncServiceResult=checkMap(session.getAttribute("_RUN_SYNC_RESULT_"),String.class,Object.class);
  if (null == syncServiceResult) {
    String errMsg=UtilProperties.getMessage(CoreEvents.err_resource,"coreEvents.no_fields_in_session",locale);
    request.setAttribute("_ERROR_MESSAGE_","<li>" + errMsg);
    return "error";
  }
  if (null != request.getParameter("_CLEAR_PREVIOUS_PARAMS_") && request.getParameter("_CLEAR_PREVIOUS_PARAMS_").equalsIgnoreCase("on"))   session.removeAttribute("_SAVED_SYNC_RESULT_");
  Map<String,String[]> serviceFieldsToSave=checkMap(request.getParameterMap(),String.class,String[].class);
  Map<String,Object> savedFields=FastMap.newInstance();
  for (  String key : serviceFieldsToSave.keySet()) {
    if (null != serviceFieldsToSave.get(key) && request.getParameter(key).equalsIgnoreCase("on") && !key.equals("_CLEAR_PREVIOUS_PARAMS_")) {
      String[] servicePath=key.split("\\|\\|");
      String partialKey=servicePath[servicePath.length - 1];
      savedFields.put(partialKey,getObjectFromServicePath(key,syncServiceResult));
    }
  }
  if (null != session.getAttribute("_SAVED_SYNC_RESULT_")) {
    Map<String,Object> savedSyncResult=checkMap(session.getAttribute("_SAVED_SYNC_RESULT_"),String.class,Object.class);
    savedSyncResult.putAll(savedFields);
    savedFields=savedSyncResult;
  }
  session.setAttribute("_SAVED_SYNC_RESULT_",savedFields);
  return "success";
}
