{
  String delegatorName=request.getParameter("delegator");
  Security security=(Security)request.getAttribute("security");
  Locale locale=UtilHttp.getLocale(request);
  if (!security.hasPermission("ENTITY_MAINT",request.getSession())) {
    String errMsg=UtilProperties.getMessage(CoreEvents.err_resource,"coreEvents.not_authorized_use_fct",locale);
    request.setAttribute("_ERROR_MESSAGE_","<li>" + errMsg);
    return "error";
  }
  if (delegatorName == null) {
    String errMsg=UtilProperties.getMessage(CoreEvents.err_resource,"coreEvents.delegator_not_passed",locale);
    request.setAttribute("_ERROR_MESSAGE_","<li>" + errMsg);
    return "error";
  }
  GenericDelegator delegator=GenericDelegator.getGenericDelegator(delegatorName);
  if (delegator == null) {
    String errMsg=UtilProperties.getMessage(CoreEvents.err_resource,"coreEvents.no_delegator_name_defined",locale);
    request.setAttribute("_ERROR_MESSAGE_","<li>" + errMsg);
    return "error";
  }
  LocalDispatcher dispatcher=(LocalDispatcher)request.getAttribute("dispatcher");
  DispatchContext dctx=dispatcher.getDispatchContext();
  String dispatcherName=dispatcher.getName();
  if (dispatcherName == null) {
    String errMsg=UtilProperties.getMessage(CoreEvents.err_resource,"coreEvents.dispatcher_name_null",locale);
    request.setAttribute("_ERROR_MESSAGE_","<li>" + errMsg);
    return "error";
  }
  if (dctx == null) {
    String errMsg=UtilProperties.getMessage(CoreEvents.err_resource,"coreEvents.dispatcher_context_null",locale);
    request.setAttribute("_ERROR_MESSAGE_","<li>" + errMsg);
    return "error";
  }
  dispatcher=GenericDispatcher.getLocalDispatcher(dispatcherName,delegator);
  request.getSession().setAttribute("delegator",delegator);
  request.getSession().setAttribute("dispatcher",dispatcher);
  return "success";
}
