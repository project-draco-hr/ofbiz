{
  Delegator delegator=(Delegator)pageContext.getRequest().getAttribute("delegator");
  GenericValue userLogin=(GenericValue)pageContext.getSession().getAttribute("userLogin");
  String projectWorkEffortId=pageContext.getRequest().getParameter("projectWorkEffortId");
  if (projectWorkEffortId == null)   projectWorkEffortId=(String)pageContext.getRequest().getAttribute("projectWorkEffortId");
  Collection<GenericValue> relatedWorkEfforts=null;
  if (userLogin != null && userLogin.get("partyId") != null) {
    try {
      EntityConditionList<EntityExpr> ecl=EntityCondition.makeCondition(UtilMisc.toList(EntityCondition.makeCondition("workEffortIdFrom",EntityOperator.EQUALS,projectWorkEffortId),EntityCondition.makeCondition("workEffortAssocTypeId",EntityOperator.EQUALS,"WORK_EFF_BREAKDOWN")),EntityOperator.AND);
      relatedWorkEfforts=delegator.findList("WorkEffortAssoc",ecl,null,null,null,false);
    }
 catch (    GenericEntityException e) {
      Debug.logWarning(e,module);
    }
  }
  Collection<GenericValue> validWorkEfforts=FastList.newInstance();
  if (relatedWorkEfforts != null) {
    try {
      for (      GenericValue workEffortAssoc : relatedWorkEfforts) {
        GenericValue workEffort=workEffortAssoc.getRelatedOne("ToWorkEffort");
        if ("TASK".equals(workEffort.getString("workEffortTypeId")) && ("WEPT_PHASE".equals(workEffort.getString("workEffortPurposeTypeId")))) {
          validWorkEfforts.add(workEffort);
        }
      }
    }
 catch (    GenericEntityException e) {
      Debug.logWarning(e,module);
    }
  }
  if (validWorkEfforts == null || validWorkEfforts.size() <= 0)   return;
  pageContext.setAttribute(phasesAttrName,validWorkEfforts);
}
