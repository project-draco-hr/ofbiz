{
  List<String> granted=getAutoGrantPermissions(userId,expandedPermission,context);
  if (granted != null && granted.size() > 0) {
    List<String> alreadyGranted=autoGrant.get();
    if (alreadyGranted == null) {
      alreadyGranted=FastList.newInstance();
    }
    for (    String toGrant : granted) {
      if (UtilValidate.isNotEmpty(toGrant)) {
        String grantExpanded=FlexibleStringExpander.expandString(toGrant,context);
        if (Debug.verboseOn())         Debug.logVerbose("Adding auto-grant permission -- " + grantExpanded,module);
        alreadyGranted.add(grantExpanded);
      }
    }
    autoGrant.set(granted);
  }
}
