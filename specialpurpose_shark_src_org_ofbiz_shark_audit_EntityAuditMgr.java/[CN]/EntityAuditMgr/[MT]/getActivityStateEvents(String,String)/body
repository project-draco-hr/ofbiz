{
  if (Debug.verboseOn())   Debug.log(":: getActivityStateEvents ::",module);
  GenericDelegator delegator=SharkContainer.getDelegator();
  List stateEvents=new ArrayList();
  List lookupList=null;
  try {
    lookupList=delegator.findByAnd(org.ofbiz.shark.SharkConstants.WfEventAudit,UtilMisc.toMap(org.ofbiz.shark.SharkConstants.auditType,"activityStateChanged",org.ofbiz.shark.SharkConstants.processId,processId,org.ofbiz.shark.SharkConstants.activityId,activityId));
  }
 catch (  GenericEntityException e) {
    Debug.logError(e,module);
    throw new EventAuditException(e);
  }
  if (UtilValidate.isNotEmpty(lookupList)) {
    Iterator i=lookupList.iterator();
    while (i.hasNext()) {
      GenericValue v=(GenericValue)i.next();
      if (v != null) {
        stateEvents.add(new StateEventAudit(this,delegator,v.getString(org.ofbiz.shark.SharkConstants.eventAuditId)));
      }
    }
  }
  return stateEvents;
}
