{
  if (cart != null) {
    BigDecimal taxAmount=cart.getTotalSalesTax();
    BigDecimal total=cart.getGrandTotal();
    List<GenericValue> adjustments=cart.getAdjustments();
    BigDecimal itemsAdjustmentsAmount=BigDecimal.ZERO;
    Iterator<?> i=cart.iterator();
    while (i.hasNext()) {
      ShoppingCartItem item=(ShoppingCartItem)i.next();
      BigDecimal adjustment=item.getOtherAdjustments();
      if (adjustment.compareTo(BigDecimal.ZERO) != 0) {
        itemsAdjustmentsAmount=itemsAdjustmentsAmount.add(adjustment);
      }
    }
    for (    GenericValue orderAdjustment : adjustments) {
      BigDecimal amount=orderAdjustment.getBigDecimal("amount");
      BigDecimal sourcePercentage=orderAdjustment.getBigDecimal("sourcePercentage");
      XModel adjustmentLine=Journal.appendNode(new JournalLineParams(model,"tr","adjustment",""));
      JournalLineParams[] journalLineParamses=new JournalLineParams[5];
      journalLineParamses[0]=new JournalLineParams(adjustmentLine,"td","sku","");
      journalLineParamses[1]=new JournalLineParams(adjustmentLine,"td","desc",UtilProperties.getMessage(resource,"PosSalesDiscount",locale));
      if (UtilValidate.isNotEmpty(amount)) {
        journalLineParamses[2]=new JournalLineParams(adjustmentLine,"td","qty","");
        journalLineParamses[3]=new JournalLineParams(adjustmentLine,"td","price",UtilFormatOut.formatPrice(amount));
      }
 else       if (UtilValidate.isNotEmpty(sourcePercentage)) {
        BigDecimal percentage=sourcePercentage.movePointLeft(2).negate();
        journalLineParamses[2]=new JournalLineParams(adjustmentLine,"td","qty",UtilFormatOut.formatPercentage(percentage));
        amount=cart.getItemTotal().add(itemsAdjustmentsAmount).multiply(percentage);
        journalLineParamses[3]=new JournalLineParams(adjustmentLine,"td","price",UtilFormatOut.formatPrice(amount.negate()));
      }
      journalLineParamses[4]=new JournalLineParams(adjustmentLine,"td","index","-1");
      appendJouralLine(journalLineParamses);
    }
    XModel taxLine=Journal.appendNode(new JournalLineParams(model,"tr","tax",""));
    JournalLineParams[] journalTaxLineParamses=new JournalLineParams[5];
    journalTaxLineParamses[0]=new JournalLineParams(taxLine,"td","sku","");
    journalTaxLineParamses[1]=new JournalLineParams(taxLine,"td","desc",UtilProperties.getMessage(resource,"PosSalesTax",locale));
    journalTaxLineParamses[2]=new JournalLineParams(taxLine,"td","qty","");
    journalTaxLineParamses[3]=new JournalLineParams(taxLine,"td","price",UtilFormatOut.formatPrice(taxAmount));
    journalTaxLineParamses[4]=new JournalLineParams(taxLine,"td","index","-1");
    appendJouralLine(journalTaxLineParamses);
    XModel totalLine=Journal.appendNode(new JournalLineParams(model,"tr","total",""));
    JournalLineParams[] journalTotalLineParamses=new JournalLineParams[5];
    journalTotalLineParamses[0]=new JournalLineParams(totalLine,"td","sku","");
    journalTotalLineParamses[1]=new JournalLineParams(totalLine,"td","desc",UtilProperties.getMessage(resource,"PosGrandTotal",locale));
    journalTotalLineParamses[2]=new JournalLineParams(totalLine,"td","qty","");
    journalTotalLineParamses[3]=new JournalLineParams(totalLine,"td","price",UtilFormatOut.formatPrice(total));
    journalTotalLineParamses[4]=new JournalLineParams(totalLine,"td","index","-1");
    appendJouralLine(journalTotalLineParamses);
  }
}
