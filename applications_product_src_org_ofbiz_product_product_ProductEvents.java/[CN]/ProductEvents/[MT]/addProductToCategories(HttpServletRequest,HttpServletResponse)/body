{
  GenericDelegator delegator=(GenericDelegator)request.getAttribute("delegator");
  String productId=request.getParameter("productId");
  String fromDate=request.getParameter("fromDate");
  if ((fromDate == null) || (fromDate.trim().length() == 0)) {
    fromDate=UtilDateTime.nowTimestamp().toString();
  }
  String[] categoryId=request.getParameterValues("categoryId");
  if (categoryId != null) {
    for (int i=0; i < categoryId.length; i++) {
      try {
        List catMembs=delegator.findByAnd("ProductCategoryMember",UtilMisc.toMap("productCategoryId",categoryId[i],"productId",productId));
        catMembs=EntityUtil.filterByDate(catMembs);
        if (catMembs.size() == 0) {
          delegator.create("ProductCategoryMember",UtilMisc.toMap("productCategoryId",categoryId[i],"productId",productId,"fromDate",fromDate));
        }
      }
 catch (      GenericEntityException e) {
        String errMsg="Error adding to category: " + e.toString();
        request.setAttribute("_ERROR_MESSAGE_",errMsg);
        return "error";
      }
    }
  }
  return "success";
}
