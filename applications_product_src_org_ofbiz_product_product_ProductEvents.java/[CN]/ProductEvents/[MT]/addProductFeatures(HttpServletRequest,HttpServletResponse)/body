{
  GenericDelegator delegator=(GenericDelegator)request.getAttribute("delegator");
  String productId=request.getParameter("productId");
  String productFeatureApplTypeId=request.getParameter("productFeatureApplTypeId");
  String fromDate=request.getParameter("fromDate");
  if ((fromDate == null) || (fromDate.trim().length() == 0)) {
    fromDate=UtilDateTime.nowTimestamp().toString();
  }
  String[] productFeatureIdArray=request.getParameterValues("productFeatureId");
  if (productFeatureIdArray != null && productFeatureIdArray.length > 0) {
    try {
      for (int i=0; i < productFeatureIdArray.length; i++) {
        if (!productFeatureIdArray[i].equals("~~any~~")) {
          List featureAppls=delegator.findByAnd("ProductFeatureAppl",UtilMisc.toMap("productId",productId,"productFeatureId",productFeatureIdArray[i],"productFeatureApplTypeId",productFeatureApplTypeId));
          if (featureAppls.size() == 0) {
            delegator.create("ProductFeatureAppl",UtilMisc.toMap("productId",productId,"productFeatureId",productFeatureIdArray[i],"productFeatureApplTypeId",productFeatureApplTypeId,"fromDate",fromDate));
          }
        }
      }
    }
 catch (    GenericEntityException e) {
      String errMsg="Error adding feature: " + e.toString();
      request.setAttribute("_ERROR_MESSAGE_",errMsg);
      return "error";
    }
  }
  return "success";
}
