{
  GenericValue productFeatureType=delegator.findOne("ProductFeatureType",UtilMisc.toMap("productFeatureTypeId",productFeatureTypeId),false);
  GenericValue uom=delegator.findOne("Uom",UtilMisc.toMap("uomId",uomId),false);
  Timestamp nowTimestamp=UtilDateTime.nowTimestamp();
  List<GenericValue> typeUomProductFeatureAndApplList=EntityUtil.filterByAnd(currentProductFeatureAndAppls,UtilMisc.toMap("productFeatureTypeId",productFeatureTypeId,"uomId",uomId));
  boolean foundOneEqual=false;
  for (  GenericValue typeUomProductFeatureAndAppl : typeUomProductFeatureAndApplList) {
    if ((numberSpecified != null) && (numberSpecified.compareTo(typeUomProductFeatureAndAppl.getBigDecimal("numberSpecified")) == 0)) {
      foundOneEqual=true;
    }
 else {
      GenericValue productFeatureAppl=delegator.makeValidValue("ProductFeatureAppl",typeUomProductFeatureAndAppl);
      productFeatureAppl.remove();
    }
  }
  if (numberSpecified != null && !foundOneEqual) {
    String productFeatureId=null;
    List<GenericValue> existingProductFeatureList=delegator.findByAnd("ProductFeature",UtilMisc.toMap("productFeatureTypeId",productFeatureTypeId,"numberSpecified",numberSpecified,"uomId",uomId),null,false);
    if (existingProductFeatureList.size() > 0) {
      GenericValue existingProductFeature=existingProductFeatureList.get(0);
      productFeatureId=existingProductFeature.getString("productFeatureId");
    }
 else {
      productFeatureId=delegator.getNextSeqId("ProductFeature");
      GenericValue prodFeature=delegator.makeValue("ProductFeature",UtilMisc.toMap("productFeatureId",productFeatureId,"productFeatureTypeId",productFeatureTypeId));
      if (uomId != null) {
        prodFeature.set("uomId",uomId);
      }
      prodFeature.set("numberSpecified",numberSpecified);
      prodFeature.set("description",numberSpecified.toString() + (uom == null ? "" : (" " + uom.getString("description"))));
      if (delegator.findOne("ProductFeatureCategory",UtilMisc.toMap("productFeatureCategoryId",productFeatureTypeId),false) == null) {
        GenericValue productFeatureCategory=delegator.makeValue("ProductFeatureCategory");
        productFeatureCategory.set("productFeatureCategoryId",productFeatureTypeId);
        productFeatureCategory.set("description",productFeatureType.get("description"));
        productFeatureCategory.create();
      }
      prodFeature.set("productFeatureCategoryId",productFeatureTypeId);
      prodFeature.create();
    }
    delegator.create("ProductFeatureAppl",UtilMisc.toMap("productId",productId,"productFeatureId",productFeatureId,"productFeatureApplTypeId","STANDARD_FEATURE","fromDate",nowTimestamp));
  }
}
