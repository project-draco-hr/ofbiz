{
  Collection tools=getToolObjs(trans,activity);
  List toolList=null;
  if (tools != null) {
    toolList=new ArrayList();
    Iterator i=tools.iterator();
    while (i.hasNext()) {
      Tool tool=(Tool)i.next();
      String toolId=tool.getID();
      Application app=(Application)((XMLComplexChoice)tool.get("Application")).getChoosen();
      ApplicationMap appMap=null;
      try {
        appMap=getApplicationMap(app,toolId);
      }
 catch (      Exception e) {
        throw new BaseException(e);
      }
      AppParameter[] params=null;
      try {
        params=makeParameters(trans,tool,app);
      }
 catch (      Exception e) {
        throw new BaseException(e);
      }
      ToolContext ctx=new ToolContext(tool,app,appMap,packageKey,processKey,activityKey,resource,params);
      toolList.add(ctx);
    }
  }
  return toolList;
}
