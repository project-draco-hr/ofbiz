{
  List parameters=new ArrayList();
  String appPStr=app.getExtendedAttributesString();
  AppParameter param=new AppParameter("ExtendedAttributes","ExtendedAttributes",AppParameter.MODE_IN,appPStr,String.class);
  parameters.add(param);
  ActualParameters aps=(ActualParameters)tool.get("ActualParameters");
  FormalParameters fps=(FormalParameters)((XMLComplexChoice)app.get("Choice")).getChoosen();
  Map ctxMap=SharkUtilities.createContextMap(transaction,context,aps,fps,packageKey,packageVer);
  Iterator itFps=fps.toCollection().iterator();
  Iterator itAps=aps.toCollection().iterator();
  while (itFps.hasNext() && itAps.hasNext()) {
    FormalParameter fp=(FormalParameter)itFps.next();
    ActualParameter ap=(ActualParameter)itAps.next();
    String fpMode=fp.get("Mode").toValue().toString();
    String fpId=fp.getID();
    Object paramVal=ctxMap.get(fpId);
    param=new AppParameter(ap.toValue().toString(),fpId,fpMode,paramVal,SharkUtilities.getJavaClass(fp));
    parameters.add(param);
  }
  return (AppParameter[])parameters.toArray(new AppParameter[parameters.size()]);
}
