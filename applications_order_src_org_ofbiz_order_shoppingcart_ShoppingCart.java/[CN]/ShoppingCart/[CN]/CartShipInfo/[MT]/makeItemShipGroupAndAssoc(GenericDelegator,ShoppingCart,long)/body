{
  shipGroupSeqId=UtilFormatOut.formatPaddedNumber(groupIndex,5);
  List values=new LinkedList();
  if (this.internalContactMechId != null) {
    GenericValue orderCm=delegator.makeValue("OrderContactMech");
    orderCm.set("contactMechPurposeTypeId","SHIPPING_LOCATION");
    orderCm.set("contactMechId",this.internalContactMechId);
    values.add(orderCm);
  }
  GenericValue shipGroup=delegator.makeValue("OrderItemShipGroup");
  shipGroup.set("shipmentMethodTypeId",shipmentMethodTypeId);
  shipGroup.set("carrierRoleTypeId",carrierRoleTypeId);
  shipGroup.set("carrierPartyId",carrierPartyId);
  shipGroup.set("supplierPartyId",supplierPartyId);
  shipGroup.set("shippingInstructions",shippingInstructions);
  shipGroup.set("giftMessage",giftMessage);
  shipGroup.set("contactMechId",this.internalContactMechId);
  shipGroup.set("maySplit",maySplit);
  shipGroup.set("isGift",isGift);
  shipGroup.set("shipGroupSeqId",shipGroupSeqId);
  shipGroup.set("vendorPartyId",vendorPartyId);
  shipGroup.set("facilityId",facilityId);
  if ((shipBeforeDate == null) && (cart.getDefaultShipBeforeDate() != null)) {
    shipGroup.set("shipByDate",cart.getDefaultShipBeforeDate());
  }
 else {
    shipGroup.set("shipByDate",shipBeforeDate);
  }
  if ((shipAfterDate == null) && (cart.getDefaultShipAfterDate() != null)) {
    shipGroup.set("shipAfterDate",cart.getDefaultShipAfterDate());
  }
 else {
    shipGroup.set("shipAfterDate",shipAfterDate);
  }
  values.add(shipGroup);
  FastList estimatedShipDates=FastList.newInstance();
  for (  Map.Entry<Object,Object> entry : shipItemInfo.entrySet()) {
    ShoppingCartItem item=(ShoppingCartItem)entry.getKey();
    Timestamp estimatedShipDate=item.getEstimatedShipDate();
    if (estimatedShipDate != null) {
      estimatedShipDates.add(estimatedShipDate);
    }
  }
  if (estimatedShipDates.size() > 0) {
    Collections.sort(estimatedShipDates);
    Timestamp estimatedShipDate=(Timestamp)estimatedShipDates.getLast();
    shipGroup.set("estimatedShipDate",estimatedShipDate);
  }
  FastList estimatedDeliveryDates=FastList.newInstance();
  for (  Map.Entry<Object,Object> entry : shipItemInfo.entrySet()) {
    ShoppingCartItem item=(ShoppingCartItem)entry.getKey();
    Timestamp estimatedDeliveryDate=item.getDesiredDeliveryDate();
    if (estimatedDeliveryDate != null) {
      estimatedDeliveryDates.add(estimatedDeliveryDate);
    }
  }
  if (UtilValidate.isNotEmpty(estimatedDeliveryDates)) {
    Collections.sort(estimatedDeliveryDates);
    Timestamp estimatedDeliveryDate=(Timestamp)estimatedDeliveryDates.getLast();
    shipGroup.set("estimatedDeliveryDate",estimatedDeliveryDate);
  }
  if (shipEstimate.compareTo(BigDecimal.ZERO) != 0) {
    GenericValue shipAdj=delegator.makeValue("OrderAdjustment");
    shipAdj.set("orderAdjustmentTypeId","SHIPPING_CHARGES");
    shipAdj.set("amount",shipEstimate);
    shipAdj.set("shipGroupSeqId",shipGroupSeqId);
    values.add(shipAdj);
  }
  Iterator ti=shipTaxAdj.iterator();
  while (ti.hasNext()) {
    GenericValue taxAdj=(GenericValue)ti.next();
    taxAdj.set("shipGroupSeqId",shipGroupSeqId);
    values.add(taxAdj);
  }
  Iterator i=shipItemInfo.keySet().iterator();
  while (i.hasNext()) {
    ShoppingCartItem item=(ShoppingCartItem)i.next();
    CartShipItemInfo itemInfo=(CartShipItemInfo)shipItemInfo.get(item);
    GenericValue assoc=delegator.makeValue("OrderItemShipGroupAssoc");
    assoc.set("orderItemSeqId",item.getOrderItemSeqId());
    assoc.set("shipGroupSeqId",shipGroupSeqId);
    assoc.set("quantity",itemInfo.quantity);
    values.add(assoc);
    Iterator iti=itemInfo.itemTaxAdj.iterator();
    while (iti.hasNext()) {
      GenericValue taxAdj=(GenericValue)iti.next();
      taxAdj.set("orderItemSeqId",item.getOrderItemSeqId());
      taxAdj.set("shipGroupSeqId",shipGroupSeqId);
      values.add(taxAdj);
    }
  }
  return values;
}
