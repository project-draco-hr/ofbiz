{
  GenericValue valueObj=this.getValueObject(delegator);
  List values=new LinkedList();
  if (valueObj != null) {
    if ("PaymentMethod".equals(valueObj.getEntityName())) {
      String billingAddressId=null;
      GenericValue billingAddress=this.getBillingAddress(delegator);
      if (billingAddress != null) {
        billingAddressId=billingAddress.getString("contactMechId");
      }
      if (UtilValidate.isNotEmpty(billingAddressId)) {
        GenericValue orderCm=delegator.makeValue("OrderContactMech",null);
        orderCm.set("contactMechPurposeTypeId","BILLING_LOCATION");
        orderCm.set("contactMechId",billingAddressId);
        values.add(orderCm);
      }
    }
    GenericValue opp=delegator.makeValue("OrderPaymentPreference",new HashMap());
    opp.set("paymentMethodTypeId",valueObj.getString("paymentMethodTypeId"));
    opp.set("presentFlag",isPresent ? "Y" : "N");
    opp.set("overflowFlag",overflow ? "Y" : "N");
    opp.set("paymentMethodId",paymentMethodId);
    opp.set("finAccountId",finAccountId);
    opp.set("billingPostalCode",postalCode);
    opp.set("maxAmount",amount);
    if (refNum != null) {
      opp.set("manualRefNum",refNum[0]);
      opp.set("manualAuthCode",refNum[1]);
    }
    if (securityCode != null) {
      opp.set("securityCode",securityCode);
    }
    if (paymentMethodId != null || "FIN_ACCOUNT".equals(paymentMethodTypeId)) {
      opp.set("statusId","PAYMENT_NOT_AUTH");
    }
 else     if (paymentMethodTypeId != null) {
      if (paymentMethodTypeId.startsWith("EXT_")) {
        opp.set("statusId","PAYMENT_NOT_RECEIVED");
      }
 else {
        opp.set("statusId","PAYMENT_RECEIVED");
      }
    }
    Debug.log("Creating OrderPaymentPreference - " + opp,module);
    values.add(opp);
  }
  return values;
}
