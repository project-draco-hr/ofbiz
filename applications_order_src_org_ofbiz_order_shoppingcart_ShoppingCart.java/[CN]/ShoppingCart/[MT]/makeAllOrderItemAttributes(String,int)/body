{
synchronized (cartLines) {
    List result=FastList.newInstance();
    for (    ShoppingCartItem item : cartLines) {
      Map orderItemAttributes=item.getOrderItemAttributes();
      Iterator attributesIter=orderItemAttributes.keySet().iterator();
      while (attributesIter.hasNext()) {
        String key=(String)attributesIter.next();
        String value=(String)orderItemAttributes.get(key);
        GenericValue orderItemAttribute=getDelegator().makeValue("OrderItemAttribute");
        if (UtilValidate.isNotEmpty(orderId)) {
          orderItemAttribute.set("orderId",orderId);
        }
        orderItemAttribute.set("orderItemSeqId",item.getOrderItemSeqId());
        orderItemAttribute.set("attrName",key);
        orderItemAttribute.set("attrValue",value);
switch (mode) {
case ALL:
          result.add(orderItemAttribute);
        break;
case FILLED_ONLY:
      if (UtilValidate.isNotEmpty(value)) {
        result.add(orderItemAttribute);
      }
    break;
case EMPTY_ONLY:
  if (UtilValidate.isEmpty(value)) {
    result.add(orderItemAttribute);
  }
break;
default :
result.add(orderItemAttribute);
break;
}
}
}
return result;
}
}
