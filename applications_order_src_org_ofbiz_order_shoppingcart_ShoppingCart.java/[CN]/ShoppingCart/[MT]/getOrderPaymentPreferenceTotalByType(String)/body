{
  BigDecimal total=BigDecimal.ZERO;
  String thisPaymentMethodTypeId=null;
  for (Iterator<CartPaymentInfo> iter=paymentInfo.iterator(); iter.hasNext(); ) {
    CartPaymentInfo payment=iter.next();
    if (payment.amount == null)     continue;
    if (payment.paymentMethodId != null) {
      try {
        GenericValue paymentMethod=this.getDelegator().findByPrimaryKeyCache("PaymentMethod",UtilMisc.toMap("paymentMethodId",payment.paymentMethodId));
        if (paymentMethod != null) {
          thisPaymentMethodTypeId=paymentMethod.getString("paymentMethodTypeId");
        }
      }
 catch (      GenericEntityException e) {
        Debug.logError(e,e.getMessage(),module);
      }
    }
 else {
      thisPaymentMethodTypeId=payment.paymentMethodTypeId;
    }
    if (paymentMethodTypeId == null || paymentMethodTypeId.equals(thisPaymentMethodTypeId)) {
      total=total.add(payment.amount);
    }
  }
  return total;
}
