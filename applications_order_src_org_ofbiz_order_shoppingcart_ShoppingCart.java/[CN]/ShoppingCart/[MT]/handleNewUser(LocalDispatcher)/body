{
  String partyId=this.getPartyId();
  if (UtilValidate.isNotEmpty(partyId)) {
    Iterator cartItemIter=this.iterator();
    while (cartItemIter.hasNext()) {
      ShoppingCartItem cartItem=(ShoppingCartItem)cartItemIter.next();
      cartItem.updatePrice(dispatcher,this);
    }
    Iterator promoCodeIter=this.productPromoCodes.iterator();
    while (promoCodeIter.hasNext()) {
      String promoCode=(String)promoCodeIter.next();
      String checkResult=ProductPromoWorker.checkCanUsePromoCode(promoCode,partyId,this.getDelegator(),locale);
      if (checkResult != null) {
        promoCodeIter.remove();
        Debug.logWarning(UtilProperties.getMessage(resource_error,"OrderOnUserChangePromoCodeWasRemovedBecause",UtilMisc.toMap("checkResult",checkResult),locale),module);
      }
    }
    ProductPromoWorker.doPromotions(this,dispatcher);
  }
}
