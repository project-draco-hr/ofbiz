{
  String invItemId=res.getString("inventoryItemId");
  double resQty=res.getDouble("quantity").doubleValue();
  PackingSessionLine line=this.findLine(orderId,orderItemSeqId,shipGroupSeqId,invItemId,packageSeqId);
  double packedQty=this.getPackedQuantity(orderId,orderItemSeqId,shipGroupSeqId);
  Debug.log("Packed quantity [" + packedQty + "] + ["+ quantity+ "]",module);
  if (line == null) {
    double checkQty=packedQty + quantity;
    Debug.log("No current line found testing [" + invItemId + "] R: "+ resQty+ " / Q: "+ checkQty,module);
    if (resQty < checkQty) {
      return 0;
    }
 else {
      return 2;
    }
  }
 else {
    double checkQty=update ? ((packedQty - line.getQuantity()) + quantity) : packedQty + quantity;
    double newQty=update ? quantity : (line.getQuantity() + quantity);
    Debug.log("Existing line found testing [" + invItemId + "] R: "+ resQty+ " / Q: "+ newQty,module);
    if (resQty < checkQty) {
      return 0;
    }
 else {
      line.setQuantity(newQty);
      return 1;
    }
  }
}
