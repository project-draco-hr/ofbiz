{
  GenericDelegator delegator=(GenericDelegator)request.getAttribute("delegator");
  Map results=new HashMap();
  boolean tryEntity=true;
  if (request.getAttribute("_ERROR_MESSAGE_") != null)   tryEntity=false;
  String donePage=request.getParameter("DONE_PAGE");
  if (donePage == null || donePage.length() <= 0)   donePage="viewprofile";
  results.put("donePage",donePage);
  String paymentMethodId=request.getParameter("paymentMethodId");
  if (request.getAttribute("paymentMethodId") != null) {
    paymentMethodId=(String)request.getAttribute("paymentMethodId");
  }
  results.put("paymentMethodId",paymentMethodId);
  GenericValue paymentMethod=null;
  GenericValue creditCard=null;
  GenericValue giftCard=null;
  GenericValue eftAccount=null;
  if (UtilValidate.isNotEmpty(paymentMethodId)) {
    try {
      paymentMethod=delegator.findByPrimaryKey("PaymentMethod",UtilMisc.toMap("paymentMethodId",paymentMethodId));
      creditCard=delegator.findByPrimaryKey("CreditCard",UtilMisc.toMap("paymentMethodId",paymentMethodId));
      giftCard=delegator.findByPrimaryKey("GiftCard",UtilMisc.toMap("paymentMethodId",paymentMethodId));
      eftAccount=delegator.findByPrimaryKey("EftAccount",UtilMisc.toMap("paymentMethodId",paymentMethodId));
    }
 catch (    GenericEntityException e) {
      Debug.logWarning(e,module);
    }
  }
  if (paymentMethod != null) {
    results.put("paymentMethod",paymentMethod);
  }
 else {
    tryEntity=false;
  }
  if (creditCard != null) {
    results.put("creditCard",creditCard);
  }
  if (giftCard != null) {
    results.put("giftCard",giftCard);
  }
  if (eftAccount != null) {
    results.put("eftAccount",eftAccount);
  }
  String curContactMechId=null;
  if (creditCard != null) {
    curContactMechId=UtilFormatOut.checkNull(tryEntity ? creditCard.getString("contactMechId") : request.getParameter("contactMechId"));
  }
 else   if (giftCard != null) {
    curContactMechId=UtilFormatOut.checkNull(tryEntity ? giftCard.getString("contactMechId") : request.getParameter("contactMechId"));
  }
 else   if (eftAccount != null) {
    curContactMechId=UtilFormatOut.checkNull(tryEntity ? eftAccount.getString("contactMechId") : request.getParameter("contactMechId"));
  }
  if (curContactMechId != null) {
    results.put("curContactMechId",curContactMechId);
  }
  results.put("tryEntity",new Boolean(tryEntity));
  return results;
}
