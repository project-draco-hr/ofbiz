{
  if (delegator == null) {
    throw new IllegalArgumentException("The delgator passed to countHit cannot be null");
  }
  ServerHitBin bin=null;
  LinkedList binList=null;
switch (type) {
case REQUEST:
    binList=(LinkedList)requestHistory.get(id);
  break;
case EVENT:
binList=(LinkedList)eventHistory.get(id);
break;
case VIEW:
binList=(LinkedList)viewHistory.get(id);
break;
case ENTITY:
binList=(LinkedList)entityHistory.get(id);
break;
case SERVICE:
binList=(LinkedList)serviceHistory.get(id);
break;
}
if (binList == null) {
synchronized (ServerHitBin.class) {
switch (type) {
case REQUEST:
binList=(LinkedList)requestHistory.get(id);
break;
case EVENT:
binList=(LinkedList)eventHistory.get(id);
break;
case VIEW:
binList=(LinkedList)viewHistory.get(id);
break;
case ENTITY:
binList=(LinkedList)entityHistory.get(id);
break;
case SERVICE:
binList=(LinkedList)serviceHistory.get(id);
break;
}
if (binList == null) {
binList=new LinkedList();
switch (type) {
case REQUEST:
requestHistory.put(id,binList);
break;
case EVENT:
eventHistory.put(id,binList);
break;
case VIEW:
viewHistory.put(id,binList);
break;
case ENTITY:
entityHistory.put(id,binList);
break;
case SERVICE:
serviceHistory.put(id,binList);
break;
}
}
}
}
if (binList.size() > 0) {
bin=(ServerHitBin)binList.getFirst();
}
if (bin == null) {
synchronized (ServerHitBin.class) {
if (binList.size() > 0) {
bin=(ServerHitBin)binList.getFirst();
}
if (bin == null) {
bin=new ServerHitBin(id,type,true,delegator);
binList.addFirst(bin);
}
}
}
bin.addHit(startTime,runningTime);
if (isOriginal && !"GLOBAL".equals(id)) {
bin.saveHit(request,startTime,runningTime,userLogin);
}
if (!"GLOBAL".equals(id)) countHitSinceStart(id,type,startTime,runningTime,isOriginal,delegator);
if (id.indexOf('.') > 0) {
countHit(id.substring(0,id.lastIndexOf('.')),type,request,startTime,runningTime,userLogin,delegator,false);
}
if (isOriginal && !"GLOBAL".equals(id)) countHit("GLOBAL",type,request,startTime,runningTime,userLogin,delegator,true);
}
