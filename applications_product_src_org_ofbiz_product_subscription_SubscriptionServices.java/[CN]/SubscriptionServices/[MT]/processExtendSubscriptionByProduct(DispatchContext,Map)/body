{
  GenericDelegator delegator=dctx.getDelegator();
  LocalDispatcher dispatcher=dctx.getDispatcher();
  String productId=(String)context.get("productId");
  Integer qty=(Integer)context.get("quantity");
  if (qty == null) {
    qty=Integer.valueOf(1);
  }
  Timestamp orderCreatedDate=(Timestamp)context.get("orderCreatedDate");
  if (orderCreatedDate == null) {
    orderCreatedDate=UtilDateTime.nowTimestamp();
  }
  try {
    List productSubscriptionResourceList=delegator.findByAndCache("ProductSubscriptionResource",UtilMisc.toMap("productId",productId));
    productSubscriptionResourceList=EntityUtil.filterByDate(productSubscriptionResourceList,orderCreatedDate,null,null,true);
    productSubscriptionResourceList=EntityUtil.filterByDate(productSubscriptionResourceList,orderCreatedDate,"purchaseFromDate","purchaseThruDate",true);
    if (productSubscriptionResourceList.size() == 0) {
      String msg="No ProductSubscriptionResource found for productId: " + productId;
      Debug.logError(msg,module);
      return ServiceUtil.returnError(msg);
    }
    Iterator productSubscriptionResourceIter=productSubscriptionResourceList.iterator();
    while (productSubscriptionResourceIter.hasNext()) {
      GenericValue productSubscriptionResource=(GenericValue)productSubscriptionResourceIter.next();
      Long useTime=(Long)productSubscriptionResource.get("useTime");
      Integer newUseTime=Integer.valueOf(0);
      if (useTime != null) {
        newUseTime=Integer.valueOf(useTime.intValue() * qty.intValue());
      }
      context.put("useTime",newUseTime);
      context.put("useTimeUomId",productSubscriptionResource.get("useTimeUomId"));
      context.put("useRoleTypeId",productSubscriptionResource.get("useRoleTypeId"));
      context.put("subscriptionResourceId",productSubscriptionResource.get("subscriptionResourceId"));
      context.put("automaticExtend",productSubscriptionResource.get("automaticExtend"));
      context.put("canclAutmExtTime",productSubscriptionResource.get("canclAutmExtTime"));
      context.put("canclAutmExtTimeUomId",productSubscriptionResource.get("canclAutmExtTimeUomId"));
      Map ctx=dctx.getModelService("processExtendSubscription").makeValid(context,ModelService.IN_PARAM);
      Map processExtendSubscriptionResult=dispatcher.runSync("processExtendSubscription",ctx);
      if (ServiceUtil.isError(processExtendSubscriptionResult)) {
        return ServiceUtil.returnError("Error processing subscriptions for Product with ID [" + productId + "]",null,null,processExtendSubscriptionResult);
      }
    }
  }
 catch (  GenericEntityException e) {
    Debug.logError(e,e.toString(),module);
    return ServiceUtil.returnError(e.toString());
  }
  return ServiceUtil.returnSuccess();
}
