{
  LocalDispatcher dispatcher=dctx.getDispatcher();
  String shipmentId=(String)context.get("shipmentId");
  Locale locale=(Locale)context.get("locale");
  List invoicesCreated=new ArrayList();
  Map serviceContext=UtilMisc.toMap("shipmentIds",UtilMisc.toList(shipmentId),"userLogin",context.get("userLogin"));
  try {
    Map result=dispatcher.runSync("createInvoicesFromShipments",serviceContext);
    invoicesCreated=(List)result.get("invoicesCreated");
  }
 catch (  GenericServiceException e) {
    Debug.logError(e,"Trouble calling createInvoicesFromShipment service; invoice not created for shipment [" + shipmentId + "]",module);
    return ServiceUtil.returnError(UtilProperties.getMessage(resource,"AccountingTroubleCallingCreateInvoicesFromShipmentService",UtilMisc.toMap("shipmentId",shipmentId),locale));
  }
  Map response=ServiceUtil.returnSuccess();
  response.put("invoicesCreated",invoicesCreated);
  return response;
}
