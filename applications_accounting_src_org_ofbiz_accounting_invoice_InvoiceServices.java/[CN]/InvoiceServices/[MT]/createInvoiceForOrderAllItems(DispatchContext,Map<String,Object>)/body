{
  Delegator delegator=dctx.getDelegator();
  LocalDispatcher dispatcher=dctx.getDispatcher();
  Locale locale=(Locale)context.get("locale");
  try {
    List<GenericValue> orderItems=delegator.findByAnd("OrderItem",UtilMisc.toMap("orderId",(String)context.get("orderId")),UtilMisc.toList("orderItemSeqId"));
    if (orderItems.size() > 0) {
      context.put("billItems",orderItems);
    }
    GenericValue userLogin=delegator.findOne("UserLogin",UtilMisc.toMap("userLoginId","system"),false);
    if (userLogin != null) {
      context.put("userLogin",userLogin);
    }
    Map<String,Object> result=dispatcher.runSync("createInvoiceForOrder",context);
    result.remove("invoiceTypeId");
    return result;
  }
 catch (  GenericServiceException e) {
    Debug.logError(e,"Entity/data problem creating invoice from order items: " + e.toString(),module);
    return ServiceUtil.returnError(UtilProperties.getMessage(resource,"AccountingEntityDataProblemCreatingInvoiceFromOrderItems",UtilMisc.toMap("reason",e.toString()),locale));
  }
catch (  GenericEntityException e) {
    Debug.logError(e,"Entity/data problem creating invoice from order items: " + e.toString(),module);
    return ServiceUtil.returnError(UtilProperties.getMessage(resource,"AccountingEntityDataProblemCreatingInvoiceFromOrderItems",UtilMisc.toMap("reason",e.toString()),locale));
  }
}
