{
  JcrTextHelper jackrabbit=new JcrTextHelperJackrabbit(request);
  String language=UtilValidate.isNotEmpty(request.getParameter("language")) ? request.getParameter("language") : (String)request.getAttribute("language");
  String version=UtilValidate.isNotEmpty(request.getParameter("version")) ? request.getParameter("version") : (String)request.getAttribute("version");
  try {
    String textContent=null;
    if (UtilValidate.isEmpty(language)) {
      textContent=jackrabbit.getTextData();
    }
 else {
      if (UtilValidate.isEmpty(version)) {
        textContent=jackrabbit.getTextData(language);
      }
 else {
        textContent=jackrabbit.getTextData(language,version);
      }
    }
    request.setAttribute("message",textContent);
    List<String> availableLanguages=jackrabbit.getAvailableLanguages();
    List<Map<String,String>> langMap=new ArrayList<Map<String,String>>();
    for (    String lang : availableLanguages) {
      Map<String,String> tmp=new HashMap<String,String>();
      tmp.put("localeId",lang);
      langMap.add(tmp);
    }
    List<String> availableVersions=jackrabbit.getAllLanguageVersions();
    List<Map<String,String>> versMap=new ArrayList<Map<String,String>>();
    for (    String v : availableVersions) {
      Map<String,String> tmp=new HashMap<String,String>();
      tmp.put("version",v);
      versMap.add(tmp);
    }
    request.setAttribute("languageList",langMap);
    request.setAttribute("versionList",versMap);
    request.setAttribute("selectedLanguage",jackrabbit.getSelctedLanguage());
    request.setAttribute("currentLanguageVersion",jackrabbit.getCurrentLanguageVersion());
    request.setAttribute("currentBaseNodeVersion",jackrabbit.getCurrentBaseVersion());
  }
 catch (  PathNotFoundException e) {
    Debug.logError(e,module);
    request.setAttribute("_ERROR_MESSAGE_",e.getMessage());
    return "error";
  }
catch (  RepositoryException e) {
    Debug.logError(e,module);
    request.setAttribute("_ERROR_MESSAGE_",e.getMessage());
    return "error";
  }
 finally {
    jackrabbit.closeSession();
  }
  return "success";
}
