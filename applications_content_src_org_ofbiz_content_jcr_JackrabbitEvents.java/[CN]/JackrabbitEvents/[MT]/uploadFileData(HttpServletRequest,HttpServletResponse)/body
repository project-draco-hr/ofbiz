{
  GenericValue userLogin=(GenericValue)request.getSession().getAttribute("userLogin");
  ServletFileUpload fu=new ServletFileUpload(new DiskFileItemFactory(10240,FileUtil.getFile("runtime/tmp")));
  List<FileItem> list=null;
  Map<String,String> passedParams=FastMap.newInstance();
  try {
    list=UtilGenerics.checkList(fu.parseRequest(request));
  }
 catch (  FileUploadException e) {
    Debug.logError(e,module);
    request.setAttribute("_ERROR_MESSAGE_",e.toString());
    return "error";
  }
  byte[] file=null;
  for (  FileItem fi : list) {
    String fieldName=fi.getFieldName();
    if (fi.isFormField()) {
      String fieldStr=fi.getString();
      passedParams.put(fieldName,fieldStr);
    }
 else     if (fieldName.startsWith("fileData")) {
      passedParams.put("completeFileName",fi.getName());
      file=fi.get();
    }
  }
  OfbizRepositoryMappingJackrabbitResource ormResource=new OfbizRepositoryMappingJackrabbitResource();
  ormResource.setData(new ByteArrayInputStream(file));
  ormResource.setMimeType(getMimeTypeFromInputStream(new ByteArrayInputStream(file)));
  ormResource.setLastModified(new GregorianCalendar());
  OfbizRepositoryMappingJackrabbitFile ormFile=new OfbizRepositoryMappingJackrabbitFile();
  ormFile.setCreationDate(new GregorianCalendar());
  ormFile.setResource(ormResource);
  ormFile.setPath(passedParams.get("completeFileName"));
  OfbizRepositoryMappingJackrabbitFolder ormFolder=new OfbizRepositoryMappingJackrabbitFolder();
  ormFolder.addChild(ormFile);
  ormFolder.setPath(passedParams.get("path"));
  RepositoryAccess repositoryAcces=new RepositoryAccessJackrabbit(userLogin);
  try {
    repositoryAcces.storeContentObject(ormFolder);
  }
 catch (  ObjectContentManagerException e) {
    Debug.logError(e,module);
    request.setAttribute("_ERROR_MESSAGE_",e.toString());
  }
catch (  ItemExistsException e) {
    Debug.logError(e,module);
    request.setAttribute("_ERROR_MESSAGE_",e.toString());
  }
  return "success";
}
