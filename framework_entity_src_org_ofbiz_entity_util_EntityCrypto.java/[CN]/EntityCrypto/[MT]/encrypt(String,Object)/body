{
  try {
    SecretKey key=this.findKey(keyName,false);
    if (key == null) {
      EntityCryptoException caught=null;
      try {
        this.createKey(keyName);
      }
 catch (      EntityCryptoException e) {
        caught=e;
      }
 finally {
        try {
          key=this.findKey(keyName,false);
        }
 catch (        EntityCryptoException e) {
          throw caught != null ? caught : e;
        }
        if (key == null) {
          throw caught != null ? caught : new EntityCryptoException("could not lookup key (" + keyName + ") after creation");
        }
      }
    }
    return StringUtil.toHexString(DesCrypt.encrypt(key,UtilObject.getBytes(obj)));
  }
 catch (  GeneralException e) {
    throw new EntityCryptoException(e);
  }
}
