{
  Map<String,Object> result;
  Map<String,Object> serviceInMap=FastMap.newInstance();
  HttpSession session=request.getSession();
  GenericValue userLogin=(GenericValue)session.getAttribute("userLogin");
  serviceInMap.put("userLogin",userLogin);
  LocalDispatcher dispatcher=(LocalDispatcher)request.getAttribute("dispatcher");
  Map<String,Object> paramMap=UtilHttp.getParameterMap(request);
  String siteId=(String)paramMap.get("contentId");
  serviceInMap.put("contentId",siteId);
  try {
    result=dispatcher.runSync("indexTree",serviceInMap);
  }
 catch (  GenericServiceException e) {
    String errorMsg="Error calling the indexTree service." + e.toString();
    Debug.logError(e,errorMsg,module);
    request.setAttribute("_ERROR_MESSAGE_",errorMsg + e.toString());
    return "error";
  }
  String errMsg=ServiceUtil.getErrorMessage(result);
  if (Debug.infoOn())   Debug.logInfo("errMsg:" + errMsg,module);
  if (Debug.infoOn())   Debug.logInfo("result:" + result,module);
  if (UtilValidate.isEmpty(errMsg)) {
    List<String> badIndexList=UtilGenerics.checkList(result.get("badIndexList"));
    if (Debug.infoOn())     Debug.logInfo("badIndexList:" + badIndexList,module);
    String badIndexMsg=StringUtil.join(badIndexList,"\n") + badIndexList.size() + " entities not indexed";
    Integer goodIndexCount=(Integer)result.get("goodIndexCount");
    String goodIndexMsg=goodIndexCount + " entities indexed.";
    if (Debug.infoOn())     Debug.logInfo("goodIndexCount:" + goodIndexCount,module);
    ServiceUtil.setMessages(request,badIndexMsg,goodIndexMsg,null);
    return "success";
  }
 else {
    ServiceUtil.setMessages(request,errMsg,null,null);
    return "error";
  }
}
