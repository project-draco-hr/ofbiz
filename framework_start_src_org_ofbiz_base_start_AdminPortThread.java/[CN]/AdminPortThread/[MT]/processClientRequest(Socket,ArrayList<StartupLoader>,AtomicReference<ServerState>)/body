{
  BufferedReader reader=null;
  PrintWriter writer=null;
  try {
    reader=new BufferedReader(new InputStreamReader(client.getInputStream()));
    String request=reader.readLine();
    writer=new PrintWriter(client.getOutputStream(),true);
    OfbizSocketCommand control;
    if (request != null && !request.isEmpty() && request.contains(":")) {
      String key=request.substring(0,request.indexOf(':'));
      if (key.equals(config.adminKey)) {
        control=OfbizSocketCommand.valueOf(request.substring(request.indexOf(':') + 1));
        if (control == null) {
          control=OfbizSocketCommand.FAIL;
        }
      }
 else {
        control=OfbizSocketCommand.FAIL;
      }
    }
 else {
      control=OfbizSocketCommand.FAIL;
    }
switch (control) {
case SHUTDOWN:
      if (serverState.get() == ServerState.STOPPING) {
        writer.println("IN-PROGRESS");
      }
 else {
        writer.println("OK");
        writer.flush();
        StartupControlPanel.stopServer(loaders,serverState,this);
      }
    break;
case STATUS:
  writer.println(serverState.get());
break;
case FAIL:
writer.println("FAIL");
break;
}
}
  finally {
if (reader != null) {
reader.close();
}
if (writer != null) {
writer.flush();
writer.close();
}
}
}
