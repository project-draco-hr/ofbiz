{
synchronized (cache) {
    Object instance=cache.get(obj);
    if (instance == null && obj instanceof Reference) {
      Reference reference=(Reference)obj;
      String repHomeDir=reference.get(JCRJndi.ADDR_TYPE_FOR_REPOSITORY_HOME_DIR).getContent().toString();
      File lock=new File(repHomeDir);
      if (lock.exists()) {
        instance=JcrUtils.getRepository(lock.toURI().toString());
      }
 else {
        instance=new TransientRepository(reference.get(JCRContainer.DEFAULT_JCR_CONFIG_PATH).getContent().toString(),repHomeDir);
      }
      cache.put(obj,instance);
    }
    return instance;
  }
}
