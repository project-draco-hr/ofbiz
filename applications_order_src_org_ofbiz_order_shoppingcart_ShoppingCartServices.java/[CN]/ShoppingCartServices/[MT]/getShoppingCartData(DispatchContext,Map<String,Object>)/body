{
  Map<String,Object> result=ServiceUtil.returnSuccess();
  Locale locale=(Locale)context.get("locale");
  ShoppingCart shoppingCart=(ShoppingCart)context.get("shoppingCart");
  if (shoppingCart != null) {
    String isoCode=shoppingCart.getCurrency();
    result.put("totalQuantity",shoppingCart.getTotalQuantity());
    result.put("currencyIsoCode",isoCode);
    result.put("subTotal",shoppingCart.getSubTotal());
    result.put("subTotalCurrencyFormatted",org.ofbiz.base.util.UtilFormatOut.formatCurrency(shoppingCart.getSubTotal(),isoCode,locale));
    result.put("totalShipping",shoppingCart.getTotalShipping());
    result.put("totalShippingCurrencyFormatted",org.ofbiz.base.util.UtilFormatOut.formatCurrency(shoppingCart.getTotalShipping(),isoCode,locale));
    result.put("totalSalesTax",shoppingCart.getTotalSalesTax());
    result.put("totalSalesTaxCurrencyFormatted",org.ofbiz.base.util.UtilFormatOut.formatCurrency(shoppingCart.getTotalSalesTax(),isoCode,locale));
    result.put("displayGrandTotal",shoppingCart.getDisplayGrandTotal());
    result.put("displayGrandTotalCurrencyFormatted",org.ofbiz.base.util.UtilFormatOut.formatCurrency(shoppingCart.getDisplayGrandTotal(),isoCode,locale));
    BigDecimal orderAdjustmentsTotal=OrderReadHelper.calcOrderAdjustments(OrderReadHelper.getOrderHeaderAdjustments(shoppingCart.getAdjustments(),null),shoppingCart.getSubTotal(),true,true,true);
    result.put("displayOrderAdjustmentsTotalCurrencyFormatted",org.ofbiz.base.util.UtilFormatOut.formatCurrency(orderAdjustmentsTotal,isoCode,locale));
    Iterator<ShoppingCartItem> i=shoppingCart.iterator();
    Map<String,Object> cartItemData=FastMap.newInstance();
    while (i.hasNext()) {
      ShoppingCartItem cartLine=i.next();
      int cartLineIndex=shoppingCart.getItemIndex(cartLine);
      cartItemData.put("displayItemQty_" + cartLineIndex,cartLine.getQuantity());
      cartItemData.put("displayItemPrice_" + cartLineIndex,org.ofbiz.base.util.UtilFormatOut.formatCurrency(cartLine.getDisplayPrice(),isoCode,locale));
      cartItemData.put("displayItemSubTotal_" + cartLineIndex,cartLine.getDisplayItemSubTotal());
      cartItemData.put("displayItemSubTotalCurrencyFormatted_" + cartLineIndex,org.ofbiz.base.util.UtilFormatOut.formatCurrency(cartLine.getDisplayItemSubTotal(),isoCode,locale));
      cartItemData.put("displayItemAdjustment_" + cartLineIndex,org.ofbiz.base.util.UtilFormatOut.formatCurrency(cartLine.getOtherAdjustments(),isoCode,locale));
    }
    result.put("cartItemData",cartItemData);
  }
  return result;
}
